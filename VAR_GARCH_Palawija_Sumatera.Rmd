---
title: "Analisis dampak curah hujan pada produksi Palawija Sumatera dengan VAR dan GARCH"
author: "Fitria"
date: "2023-11-09"
output: pdf_document
---

# Memangil Library

```{r}
library(dplyr)
library(ggplot2)
library(lubridate)
library(summarytools)
library(readxl)
library(cluster)
library(scales)
library(vars)
library(rugarch)
library(caTools)
library(fGarch)
library(tseries)
library(tidyverse)
library(Metrics)
library(caret)
library(tsutils) # for time series manipulation and decomposition
library(forecast) # for GARCH model implementation
library(stats) # for statistical tests
library(MASS)
library(nortest)
library(forecast)
```

# 1. Load dataset Palawija Sumatera 1993-2022

```{r}
Sumatera_palawija <- read_excel("D:/OneDrive - mikroskil.ac.id/Skripsi/dataset penelitian/CURAH HUJAN dan Palawija SUMATERA 1993-2022.xlsx")
Sumatera_palawija
```

```{r}
#Merubah type data dari cdouble menjadi numeric agar mudah di operasikan
Sumatera_palawija$Produksi<-as.numeric(Sumatera_palawija$Produksi)
Sumatera_palawija$Produktivitas<-as.numeric(Sumatera_palawija$Produktivitas)
Sumatera_palawija$Luas_Panen<-as.numeric(Sumatera_palawija$Luas_Panen)
Sumatera_palawija$avg_rainfall<-as.numeric(Sumatera_palawija$avg_rainfall)
Sumatera_palawija
```

```{r}
#merubah type data tahun dari double menjadi date
Sumatera_palawija$Tahun<-make_date(Sumatera_palawija$Tahun)
Sumatera_palawija
```

```{r}
tail(Sumatera_palawija)
```

```{r}
head(Sumatera_palawija)
```

```{r}
# Menampikan variabel dengan baris kosong
colSums(is.na(Sumatera_palawija))
```

## Menghapus Data Kosong

```{r}
# Menghapus data NA's
Palawija_CLEAN <- na.omit(Sumatera_palawija)
summary(Palawija_CLEAN)
```

```{r}
#menampilkan kembali data yang kosong
colSums(is.na(Palawija_CLEAN))
```

## Eksplorasi Data Analisis (EDA)

### Jumlah Produksi Tanaman Palawija per Provinsi

```{r}
# Hitung total produksi semua tanaman palawija per provinsi di setiap tahun
totproduksi_palawija <- Palawija_CLEAN %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi)) %>%
  arrange(desc(total_produksi))

totproduksi_palawija
```

```{r}
# Hitung total produksi semua tanaman pangan per setiap provinsi dan di urutkan dari total produksi terbanyak
totproduksi_provinsi <- Palawija_CLEAN %>% 
  group_by(Provinsi) %>% 
  summarise(total_produksi = sum(Produksi))%>%
  arrange(desc(total_produksi))
  
totproduksi_provinsi
```

Total Produksi terbanyak ada di Provinsi Lampung sebanyak 205226881

```{r}
# Hitung total produksi semua tanaman pangan per setiap provinsi dan di urutkan dari total produksi terbanyak
totproduktivitas_provinsi <- Palawija_CLEAN %>% 
  group_by(Provinsi) %>% 
  summarise(total_produktivitas= sum(Produktivitas))%>%
  arrange(desc(total_produktivitas))
  
totproduktivitas_provinsi
```

### Tren Produksi Tanaman Palawija per Provinsi

```{r}
# Visualisasi Tren Produksi palawija per Provinsi di setiap tahun
plot_palawija1 <- ggplot(totproduksi_palawija, aes(x = Tahun, y = total_produksi, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Palawija Sumatera ", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_palawija1
```

```{r}

# Visualisasi dengan barplot
plot_palawija2 <- ggplot(totproduksi_provinsi, aes(x = Provinsi, y = total_produksi, fill = Provinsi)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Palawija antara Provinsi di Sumatera", x = "Provinsi", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_palawija2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Hitung total produksi semua tanaman palawija per provinsi di setiap tahun
totproduktivitas_palawija <- Palawija_CLEAN %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produktivitas = sum(Produktivitas)) %>%
  arrange(desc(total_produktivitas))

totproduktivitas_palawija
```

```{r}
# Visualisasi Tren Produksi palawija per Provinsi di setiap tahun
plot_palawija_produktivitas <- ggplot(totproduktivitas_palawija, aes(x = Tahun, y = total_produktivitas, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produktivitas Palawija Sumatera ", x = "Tahun", y = "Total Produktivitas") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_palawija_produktivitas
```

## Jagung

```{r}
# Filter data Palawija "Jagung" berdasarkan jenis komonditi
Sumatera_jagung<- Palawija_CLEAN %>%
  filter(Jenis_Komoditi == "Jagung")
Sumatera_jagung
```

## EDA Jagung

### Jumlah Produksi Jagung per Provinsi

```{r}
# Hitung total produksi Jagung per Provinsi di setiap tahun
totproduksi_jagung_palawija <-Sumatera_jagung %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi))

totproduksi_jagung_palawija
```

```{r}
# Hitung total produksi Jagung per setiap Provinsi
totproduksi_provinsi_Jagung <- Sumatera_jagung %>% 
  group_by(Provinsi) %>% 
  summarise(total_produksi = sum(Produksi))%>%
  arrange(desc(total_produksi))
  
totproduksi_provinsi_Jagung
```

### Tren Produksi Jagung per Provinsi

```{r}
# Visualisasi Tren Produksi tanaman pangan per Provinsi di setiap tahun
plot_Jagung_11 <- ggplot(totproduksi_jagung_palawija, aes(x = Tahun, y = total_produksi, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Jagung", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_Jagung_11
```

```{r}

# Visualisasi dengan barplot total produksi padi di setiap Provinsi
plot_Jagung_2<- ggplot(totproduksi_provinsi_Jagung, aes(x = Provinsi, y = total_produksi, fill = Provinsi)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Jagung antara Provinsi", x = "Provinsi", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_Jagung_2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Perbandingan produksi Jagung dalam kurun waktu 1993 - 2022 adalah dari Provinsi Lampung yang terbanyak dengan Jumlah Produksi 45986395 ton

## Kacang kedelai

```{r}
# Filter data Palawija "Kedelai" berdasarkan jenis komonditi
Sumatera_Kedelai<- Palawija_CLEAN %>%
  filter(Jenis_Komoditi == "Kedelai")
Sumatera_Kedelai
```

## EDA Kacang Kedelai

### Jumlah Produksi Kacang Kedelai per Provinsi

```{r}
# Hitung total produksi Kacang_Kedelai per Provinsi di setiap tahun
totproduksi_Kedelai <- Sumatera_Kedelai %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi))

totproduksi_Kedelai
```

```{r}
# Hitung total produksi Kacang Kedelai  per setiap Provinsi
totproduksi_provinsi_Kedelai <- Sumatera_Kedelai %>% 
  group_by(Provinsi) %>% 
  summarise(total_produksi = sum(Produksi))%>%
  arrange(desc(total_produksi))
  
totproduksi_provinsi_Kedelai
```

### Tren Produksi Kacang Kedelai per Provinsi

```{r}
# Visualisasi Tren Produksi Kacang Kedelai  per Provinsi di setiap tahun
plot_Kedelai_1 <- ggplot(totproduksi_Kedelai, aes(x = Tahun, y = total_produksi, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Kacang Kedelai ", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_Kedelai_1
```

```{r}

# Visualisasi dengan barplot total produksi Kacang Kedelai  di setiap Provinsi
plot_Kedelai_2<- ggplot(totproduksi_provinsi_Kedelai, aes(x = Provinsi, y = total_produksi, fill = Provinsi)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Kacang Kedelai  antara Provinsi", x = "Provinsi", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_Kedelai_2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Perbandingan produksi Kacang Kedelai dalam kurun waktu 1992 - 2022 adalah Provinsi Aceh yang terbanyak dengan Jumlah Produksi 1650031

## Kacang_hijau

```{r}
# Filter data Palawija "Kacang Hijau" berdasarkan jenis komonditi
Sumatera_kacang_hijau<- Palawija_CLEAN %>%
  filter(Jenis_Komoditi == "Kacang Hijau")
Sumatera_kacang_hijau
```

## EDA Kacang Hijau

### Jumlah Produksi Kacang Hijau per Provinsi

```{r}
# Hitung total produksi Kacang Hijau per Provinsi di setiap tahun
totproduksi_KacangHijau <- Sumatera_kacang_hijau %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi))

totproduksi_KacangHijau
```

```{r}
# Hitung total produksi Kacang Hijau per setiap Provinsi
totproduksi_provinsi_KacangHijau <- Sumatera_kacang_hijau %>% 
  group_by(Provinsi) %>% 
  summarise(total_produksi = sum(Produksi))%>%
  arrange(desc(total_produksi))
  
totproduksi_provinsi_KacangHijau
```

### Tren Produksi Kacang Hijau per Provinsi

```{r}
# Visualisasi Tren Produksi Kacang Hijau per Provinsi di setiap tahun
plot_KacangHijau_1 <- ggplot(totproduksi_KacangHijau, aes(x = Tahun, y = total_produksi, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Kacang Hijau", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_KacangHijau_1
```

```{r}

# Visualisasi dengan barplot total produksi Kacang Hijau di setiap Provinsi
plot_KacangHijau_2<- ggplot(totproduksi_provinsi_KacangHijau, aes(x = Provinsi, y = total_produksi, fill = Provinsi)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Kacang Hijau antara Provinsi", x = "Provinsi", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_KacangHijau_2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Perbandingan produksi Kacang Hijau dalam kurun waktu 1993 - 2022 adalah Sumatera Utara yang terbanyak dengan Jumlah Produksi 144423 Ton

## EDA Kacang Tanah

```{r}
# Filter data Palawija "Jagung" berdasarkan jenis komonditi
Sumatera_kacang_tanah<- Palawija_CLEAN %>%
  filter(Jenis_Komoditi == "Kacang Tanah")
Sumatera_kacang_tanah
```

### Jumlah Produksi Kacang Tanah per Provinsi

```{r}
# Hitung total produksi Kacang Tanah per Provinsi di setiap tahun
totproduksi_KacangTanah <- Sumatera_kacang_tanah %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi))

totproduksi_KacangTanah
```

```{r}
# Hitung total produksi Kacang Tanah per setiap Provinsi
totproduksi_provinsi_KacangTanah <- Sumatera_kacang_tanah %>% 
  group_by(Provinsi) %>% 
  summarise(total_produksi = sum(Produksi))%>%
  arrange(desc(total_produksi))
  
totproduksi_provinsi_KacangTanah
```

### Tren Produksi Kacang Tanah per Provinsi

```{r}
# Visualisasi Tren Produksi Kacang Tanah per Provinsi di setiap tahun
plot_KacangTanah_1 <- ggplot(totproduksi_KacangTanah, aes(x = Tahun, y = total_produksi, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Kacang Tanah", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_KacangTanah_1
```

```{r}

# Visualisasi dengan barplot total produksi Kacang Tanah di setiap Provinsi
plot_KacangTanah_2<- ggplot(totproduksi_provinsi_KacangTanah, aes(x = Provinsi, y = total_produksi, fill = Provinsi)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Kacang Tanah antara Provinsi", x = "Provinsi", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_KacangTanah_2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Perbandingan produksi Kacang Tanah dalam kurun waktu 1993 - 2022 adalah dari Sumatera Utara yang terbanyak dengan Jumlah Produksi 518192

## Ubi Jalar

```{r}
# Filter data Palawija "Jagung" berdasarkan jenis komonditi
Sumatera_ubi_jalar<- Palawija_CLEAN %>%
  filter(Jenis_Komoditi == "Ubi Jalar")
Sumatera_ubi_jalar
```

## EDA Ubi Jalar

### Jumlah Produksi Ubi Jalar per Provinsi

```{r}
# Hitung total produksi Ubi Jalar per Provinsi di setiap tahun
totproduksi_UbiJalar <- Sumatera_ubi_jalar %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi))

totproduksi_UbiJalar
```

```{r}
# Hitung total produksi padi per setiap Provinsi
totproduksi_provinsi_UbiJalar <- Sumatera_ubi_jalar %>% 
  group_by(Provinsi) %>% 
  summarise(total_produksi = sum(Produksi))%>%
  arrange(desc(total_produksi))
  
totproduksi_provinsi_UbiJalar
```

### Tren Produksi Ubi Jalar per Provinsi

```{r}
# Visualisasi Tren Produksi   Ubi Jalar per Provinsi di setiap tahun
plot_UbiJalar_1 <- ggplot(totproduksi_UbiJalar, aes(x = Tahun, y = total_produksi, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Ubi Jalar", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_UbiJalar_1
```

```{r}

# Visualisasi dengan barplot total produksi Ubi Jalar di setiap Provinsi
plot_UbiJalar_2<- ggplot(totproduksi_provinsi_UbiJalar, aes(x = Provinsi, y = total_produksi, fill = Provinsi)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Ubi Jalar antara Provinsi", x = "Provinsi", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_UbiJalar_2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Perbandingan produksi Ubi Jalar dalam kurun waktu 1993 - 2022 adalah dari Sumatera Utara yang terbanyak dengan Jumlah Produksi 3653240 Ton

## Ubi Kayu

```{r}
# Filter data Palawija "ubikayu" berdasarkan jenis komonditi
Sumatera_ubi_kayu<- Palawija_CLEAN %>%
  filter(Jenis_Komoditi == "Ubi Kayu")
Sumatera_ubi_kayu
```

## EDA Ubi Kayu

```{r}
# Turn off dplyr summarise() warning
options(dplyr.summarise.inform = FALSE)
```

### Jumlah Produksi Ubi Kayu per Provinsi

```{r}
# Hitung total produksi Ubi Kayu per Provinsi di setiap tahun
totproduksi_UbiKayu <- Sumatera_ubi_kayu %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi))

totproduksi_UbiKayu
```

```{r}
# Hitung total produksi Ubi Kayu per setiap Provinsi
totproduksi_provinsi_UbiKayu <- Sumatera_ubi_kayu %>% 
  group_by(Provinsi) %>% 
  summarise(total_produksi = sum(Produksi))%>%
  arrange(desc(total_produksi))
  
totproduksi_provinsi_UbiKayu
```

### Tren Produksi Ubi Kayu per Provinsi

```{r}
# Visualisasi Tren Ubi Kayu per Provinsi di setiap tahun
plot_UbiKayu_1 <- ggplot(totproduksi_UbiKayu, aes(x = Tahun, y = total_produksi, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Ubi Kayu ", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_UbiKayu_1
```

```{r}

# Visualisasi dengan barplot total produksi Ubi Kayu di setiap Provinsi
plot_UbiKayu_2<- ggplot(totproduksi_provinsi_UbiKayu, aes(x = Provinsi, y = total_produksi, fill = Provinsi)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Ubi Kayu antara Provinsi", x = "Provinsi", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_UbiKayu_2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Perbandingan produksi Ubi kayu dalam kurun waktu 1993 - 2022 adalah dari Lampung yang terbanyak dengan Jumlah Produksi 156729879 Ton

# 3. VAR tanaman palawija

## a. VAR terhadap jagung Sumatera

```{r}
# Pilih variabel yang akan diprediksi
data_var_jagung <- Sumatera_jagung[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_jagung
```

Untuk mendukung prediksi dengan Model VAR, data harus dirubah kedalam format time series (ts)

```{r}
#Format time series
ts_data_jagung_Sumatera <- ts(data_var_jagung, start = c(1993,1), frequency = 1)
ts_data_jagung_Sumatera
```

```{r}
best_lag_jagung_Sumatera<- VARselect(ts_data_jagung_Sumatera, lag.max = 5, type = "both")
best_lag_jagung_Sumatera
```

### VAR Model terhadap jagung Sumatera

```{r}
var_model_jagung_Sumatera <- VAR(ts_data_jagung_Sumatera, p = best_lag_jagung_Sumatera$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_jagung_Sumatera)
```

Estimation results for equation Produksi: avg_rainfall.l1 -3.674e+04 1.162e+04 -3.161 0.00176 \*\* avg_rainfall.l4 2.745e+04 1.207e+04 2.275 0.02375 \* F-statistic: 115.1 on 16 and 258 DF, p-value: \< 2.2e-16

Estimation results for equation avg_rainfall: Produktivitas.l4 3.193e-02 1.174e-02 2.720 0.00697 **Produktivitas.l5 -4.793e-02 9.219e-03 -5.199 4.08e-07** \* F-statistic: 63.7 on 16 and 258 DF, p-value: \< 2.2e-16

Estimation results for equation Produktivitas: avg_rainfall.l1 -1.945e+00 4.242e-01 -4.586 7.05e-06 ***avg_rainfall.l4 2.014e+00 4.404e-01 4.574 7.44e-06*** F-statistic: 63.7 on 16 and 258 DF, p-value: \< 2.2e-16

### Uji Kolersi Pearson Jagung

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_jagung_Sumatera1 <- cor(data_var_jagung$Produksi, data_var_jagung$avg_rainfall)
cat ("Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi:",kolerasi_jagung_Sumatera1)
```

Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi: 0.05

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_jagung_Sumatera2 <- cor(data_var_jagung$avg_rainfall, data_var_jagung$Produktivitas)
cat ("Koefisien Korelasi Pearson Rata-rata curah hujan dan Produksi:", kolerasi_jagung_Sumatera2)
```

Koefisien Korelasi Pearson Rata-rata curah hujan dan Produksi: 0.1976596

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_jagung_Sumatera3 <- cor(data_var_jagung$Produksi, data_var_jagung$Produktivitas)
cat ("Koefisien Korelasi Pearson Produksi dan Produktivitas:", kolerasi_jagung_Sumatera3)
```

Koefisien Korelasi Pearson Produksi dan Produksi: 0.49

### Uji Granger Causality Jagung

```{r}
# Melakukan uji Granger Causality 
granger_jagung_Sumatera1 <- causality(var_model_jagung_Sumatera, cause = "avg_rainfall")
granger_jagung_Sumatera1

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger :p-value = 9.94e-08 Instant : p-value = 0.1456 berdarkan p-value Uji Grager dan isntast Jadi dapat disimpulkan bahwa terdapat bukti statisktik bahwa curah hujan memiilki hubungan sebab akibat jangka penjang dengan Produktivitas.

### Uji regresi linier jagung

```{r}
# Membuat model regresi linier
regresi_produksi_jagung <- lm(Produksi ~ avg_rainfall , data = data_var_jagung)

# Ringkasan hasil model
summary(regresi_produksi_jagung)
```

Hasil: avg_rainfall p-valuenya adalah 0.398. nilai intercept adalah 166846\
f-statistik 0.7161 p-valuenya adalah 0.3982 Multiple R-squared: 0.002569 Dapat disimpulkan bahwa Rata-rata curah hujan tidak mempergaruhi produksi jagung.

```{r}
# Membuat model regresi linier
regresi_produktivitas_jagung<- lm(Produktivitas ~ avg_rainfall , data = data_var_jagung)

# Ringkasan hasil model
summary(regresi_produktivitas_jagung)
```

Hasil analisis regresi linear dari model regresi yang mencoba memprediksi variabel "Produktivitas" berdasarkan variabel prediktor, yaitu "rata-rata urah_hujan," Berikut adalah interpretasi hasil dari model ini: *Intercept:* 15.3966 *avg_rainfall:* koefisien: 2.8064 dan p-valuenya: 0.000882 \*\*F-statistic:\* 11.3 p-value: 0.0008824 *Kesimpulan* menunjukan bahwa avg_rainfall secara signifikan mempengaruhi produktivitas Jagung

### Interpretasi Jagung

Berdasarkan hasil analisis dengan model VAR, analisis kausalitas, dan regresi linear ini, kita dapat menyimpulkan bahwa:

1.  Dalam model VAR, bahwa variabel avg_rainfall berdampak pada produktivitas jagung karena nilai P-Value dari 2 lag yaitu Lag1 dan lag4lebih rendah dari 0,05. dan avg_rainfall berdampak pada produksi jagung karena nilai P-Value di lag 1 dan lag 4 lebih besar dari 0,05

2.  Berdasarkan hasil uji Granger Causality dan Instantaneous Causality, ada bukti statistik yang kuat untuk mendukung adanya hubungan sebab-akibat antara "avg_rainfall", "produksi" dan "Produktivitas" dalam model VAR dalam jangka waktu lag tetapi bukan dalam jangka waktu instan.

3.  Berdasarkan hasil analisis regresi didapatkan bahwa variabel "avg_rainfall"memiliki pengaruh yang signifikan terhadap variabel "Produktivitas," tetapi tidak berpegaruh pada produksi.


### ANALISIS PREDIKSI DENGAN GARCH

```{r}
# Menghitung residual dari model VAR
residuals_var_jagung <- residuals(var_model_jagung_Sumatera)
residuals_var_jagung
```

```{r}
# karena model garch mengunakan distribusi normal, maka perlu mengecek data berdistribusi normal atau tidak
shapiro.test(data_var_jagung$Produksi)
shapiro.test(data_var_jagung$Produktivitas)
shapiro.test(data_var_jagung$avg_rainfall)
```

```{r}
# Mengecek outlier dari residu var
boxplot(residuals_var_jagung, main = "Boxplot of Residuals", ylab = "Residuals")
# Mengecek normalitas data
shapiro.test(residuals_var_jagung)
```

data: residuals_var W = 0.3585, p-value < 2.2e-16
Hasil dari uji Shapiro-Wilk menunjukkan nilai p-value yang rendah,yang menunjukkan bahwa data residual tidak normal. Hal ini dapat menyebabkan kesalahan pada proses pemodelan, karena model GARCH mengasumsikan bahwa data residual normal.

```{r}
# Buat data frame baru dari nilai residu
residu_var_SJ <- data.frame(residuals_var_jagung)
residu_var_SJ
```
```{r}
# Transformasi residual menggunakan transformasi logaritma
residu_var_SJ$Produksi_log <- log(abs(residu_var_SJ$Produksi) + 1)
```

```{r}
shapiro.test(residu_var_kk$Produksi_log)
```

```{r}
# Memodelkan GARCH pada residu VAR
garch_model <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1)),
                           mean.model = list(armaOrder = c(0, 0)))
```

```{r}
# Estimasi parameter GARCH
garch_pt_jagung <- ugarchfit(spec = garch_model, data = residu_var_SJ$Produktivitas)
# Menampilkan ringkasan model GARCH
show(garch_pt_jagung)
```
```{r}
# Menyimpan hasil prediksi
prediksi_garch_ptj <- ugarchforecast(garch_pt_jagung, n.ahead = 10)
prediksi_garch_ptj
```

```{r}
# Estimasi parameter GARCH
garch_avg_jagung <- ugarchfit(spec = garch_model, data = residu_var_SJ$avg_rainfall)
# Menampilkan ringkasan model GARCH
show(garch_avg_jagung)
```
```{r}
# Menyimpan hasil prediksi
prediksi_garch_avg <- ugarchforecast(garch_avg_jagung, n.ahead = 10)
prediksi_garch_avg
```

```{r}
# Estimasi parameter GARCH
garch_produksi_jagung <- ugarchfit(spec = garch_model, data = residu_var_SJ$Produksi_log)
# Menampilkan ringkasan model GARCH
show(garch_produksi_jagung)
```
```{r}
# Menyimpan hasil prediksi
prediksi_garch_produksi_j <- ugarchforecast(garch_produksi_jagung, n.ahead = 10)
prediksi_garch_produksi_j
```
                                                                                                          
```{r}
# Mengambil nilai prediksi GARCH dan membuat menjadi data frame
prediksi_garch_jagung <- data.frame(Produksi = as.numeric(prediksi_garch_ptj@forecast$seriesFor[, 1]),
                                    Avg_Rainfall = as.numeric(prediksi_garch_avg@forecast$seriesFor[, 1]),
                                    Produktivitas = as.numeric(prediksi_garch_produksi_j@forecast$seriesFor[, 1]))
prediksi_garch_jagung
```

```{r}
# Menambahkan kolom tahun
prediksi_garch_jagung$Tahun <- seq(2023, 2032)
# Menampilkan data frame
prediksi_garch_jagung
```

```{r}
# Visualisasi tren produksi Jagung
plot_predik_produksi <- ggplot(prediksi_garch_jagung
                             , aes(x = Tahun, y = Produksi, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi Jagung Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi Jagung",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_tren_produksi)
```

```{r}
# Visualisasi tren produktivitas jagung
plot_predik_produksi <- ggplot(prediksi_garch_jagung
                             , aes(x = Tahun, y = Produktivitas, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produktivitas Jagung Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi Jagung",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_tren_produksi)
```

```{r}
# Visualisasi tren produksi kedelai
plot_predik_produksi <- ggplot(prediksi_garch_jagung
                             , aes(x = Tahun, y = avg_rainfall, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi Jagung Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi Jagung",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_tren_produksi)
```

### Evaluasi Model

```{r}
# Mengambil data produksi jagung selama 10 tahun terakhir
data_aktual_j <- Sumatera_jagung[format(Sumatera_jagung$Tahun, "%Y") >= "2013", "Produksi"]
data_aktual_j
```

```{r}
data_aktual_j<- as.numeric(data_aktual_j$Produksi)
```

```{r}
prediksi_produksi_j <- as.numeric(prediksi_garch_jagung$Produksi)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_j <- sqrt(mean((data_aktual_j - prediksi_produksi_j)^2))
mape_garch_j <- mean(abs((data_aktual_j - prediksi_produksi_j) / data_aktual_j) * 100)
mae_garch_j <- mean(abs(data_aktual_j - prediksi_produksi_j))
mse_garch_j <- mean((data_aktual_j - prediksi_produksi_j)^2)

cat("MAPE from garch:", mape_garch_j, "%\n")
cat("RMSE:", rmse_garch_j, "\n")
cat("MAE:", mae_garch_j, "\n")
cat("MSE:", mse_garch_j, "\n")
```

```{r}
# Mengambil data produktivitas jagung selama 10 tahun terakhir
data_aktual_ptj <- Sumatera_jagung[format(Sumatera_jagung$Tahun, "%Y") >= "2013", "Produktivitas"]
data_aktual_ptj
```

```{r}
data_aktual_ptj<- as.numeric(data_aktual_ptj$Produktivitas)
```

```{r}
prediksi_produksi_ptj <- as.numeric(prediksi_garch_jagung$Produktivitas)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_ptj <- sqrt(mean((data_aktual_ptj - prediksi_produksi_ptj)^2))
mape_garch_ptj <- mean(abs((data_aktual_ptj - prediksi_produksi_ptj) / data_aktual_ptj) * 100)
mae_garch_ptj <- mean(abs(data_aktual_ptj - prediksi_produksi_ptj))
mse_garch_ptj <- mean((data_aktual_ptj - prediksi_produksi_ptj)^2)

cat("MAPE from garch:", mape_garch_ptj, "%\n")
cat("RMSE:", rmse_garch_ptj, "\n")
cat("MAE:", mae_garch_ptj, "\n")
cat("MSE:", mse_garch_ptj, "\n")
```
```{r}
# Mengambil data avg rainfall jagung selama 10 tahun terakhir
data_aktual_rainfal <- Sumatera_jagung[format(Sumatera_jagung$Tahun, "%Y") >= "2013", "avg_rainfall"]
data_aktual_rainfal
```

```{r}
data_aktual_rainfal<- as.numeric(data_aktual_rainfal$avg_rainfall)
```

```{r}
prediksi_produksi_rainfal <- as.numeric(prediksi_garch_jagung$Avg_Rainfall)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_rainfall <- sqrt(mean((data_aktual_rainfal - prediksi_produksi_rainfal)^2))
mape_garch_rainfall <- mean(abs((data_aktual_rainfal - prediksi_produksi_rainfal) / data_aktual_rainfal) * 100)
mae_garch_rainfall <- mean(abs(data_aktual_rainfal - prediksi_produksi_rainfal))
mse_garch_rainfall <- mean((data_aktual_rainfal - prediksi_produksi_rainfal)^2)

cat("MAPE from garch:", mape_garch_rainfall, "%\n")
cat("RMSE:", rmse_garch_rainfall, "\n")
cat("MAE:", mae_garch_rainfall, "\n")
cat("MSE:", mse_garch_rainfall, "\n")
```


## b.VAR terhadap Kacang Kedelai Sumatera

```{r}
# Pilih variabel yang akan diprediksi

data_var_kedelai_Sumatera <- Sumatera_Kedelai[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_kedelai_Sumatera
```

```{r}
#Format time series
ts_data_kedelai_Sumatera <- ts(data_var_kedelai_Sumatera, start = c(1993,1), frequency = 1)
ts_data_kedelai_Sumatera
```

```{r}
best_lag_kedelai_Sumatera<- VARselect(ts_data_kedelai_Sumatera, lag.max = 5, type = "both")
best_lag_kedelai_Sumatera
```

### VAR Model terhadap produksi Kacang Kedelai Sumatera

```{r}

var_model_kedelai_Sumatera <- VAR(ts_data_kedelai_Sumatera, p = best_lag_kedelai_Sumatera$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_kedelai_Sumatera)
```

Estimation results for equation Produksi: Produktivitas.l3 1.133e+03 4.960e+02 2.283 0.02329 \* Multiple R-Squared: 0.6857, F-statistic: 32.99 p-value: \< 2.2e-16

Estimation results for equation avg_rainfall: Produktivitas.l1 7.732e-02 3.726e-02 2.075 0.039016 *Produksi.l4 -1.369e-05 6.630e-06 -2.065 0.039980* \
avg_rainfall.l4 1.732e-01 6.236e-02 2.777 0.005915 **Produktivitas.l5 -1.423e-01 3.986e-02 -3.569 0.000432** \* Multiple R-Squared: 0.1746,\
F-statistic: 3.198 , p-value: 5.224e-05

Estimation results for equation Produkivitas: Produktivitas.l1 5.199e-01 6.532e-02 7.960 6.66e-14 \*\*\* Multiple R-Squared: 0.3855, F-statistic: 9.487, p-value: \< 2.2e-16

Berdasarkan hasil Model VAR Porduksi dan produktivitas tidak di pengaruhi oleh avg_rainfall

### Uji Kolersi Pearson Kacang Kedelai

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_kedelai_Sumatera1 <- cor(data_var_kedelai_Sumatera$Produksi, data_var_kedelai_Sumatera$avg_rainfall)
cat ("Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi:",kolerasi_kedelai_Sumatera1)
```

Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi: -0.16

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_kedelai_Sumatera2 <- cor(data_var_kedelai_Sumatera$avg_rainfall, data_var_kedelai_Sumatera$Produktivitas)
cat ("Koefisien Korelasi Pearson Rata-rata curah hujan dan Produktivitas:", kolerasi_kedelai_Sumatera2)
```

Koefisien Korelasi Pearson Rata-rata curah hujan dan Produktivitas: 0.1206918

### Uji Granger Causality Kacang Kedelai

```{r}
# Melakukan uji Granger Causality 
granger_kedelai_Sumatera1 <- causality(var_model_kedelai_Sumatera, cause = "avg_rainfall")
granger_kedelai_Sumatera1

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger= p-value = 0.4478 dan instant = p-value = 0.07575 *kesimpulan* Berdasarkan hasil uji Granger Causality, tidak terdapat bukti yang cukup untuk menyatakan bahwa avg_rainfall secara signifikan menyebabkan Granger dan instant untuk Produksi dan Produktivitas.

### Uji regresi linier kedelai

```{r}
# Membuat model regresi linier
regresi_kedelai_produktivitas <- lm(Produktivitas ~ avg_rainfall , data = data_var_kedelai_Sumatera)

# Ringkasan hasil model
summary(regresi_kedelai_produktivitas)
```

(Intercept) 10.1633 0.9620 10.565 \<2e-16 \*\* *avg_rainfall 0.2434 0.1237 1.968 0.0501 . F-statistic: 3.873 , p-value: 0.05013 Multiple R-squared: 0.01457* Kesimpulan\* Terdapat bukti yang cukup (p-value sekitar 0.0501) bahwa curah hujan (avg_rainfall) mungkin memiliki dampak pada Produktivitas. Namun, R-squared yang rendah menunjukkan bahwa model mungkin tidak memberikan penjelasan yang kuat

```{r}
# Membuat model regresi linier
regresi_kedelai_produksi <- lm(Produksi ~ avg_rainfall , data = data_var_kedelai_Sumatera)

# Ringkasan hasil model
summary(regresi_kedelai_produksi)
```

Estimate Std. Error t value Pr(\>\|t\|)\
(Intercept) 46518 11764 3.954 9.88e-05 ***avg_rainfall -4114 1513 -2.720 0.00697** Multiple R-squared: 0.02746 F-statistic: 7.398 p-value: 0.006966* Kesimpulan\* Terdapat bukti yang cukup (p-value sekitar 0.00697) bahwa curah hujan (avg_rainfall) memiliki dampak yang signifikan pada Produksi. Namun, R-squared yang rendah menunjukkan bahwa model mungkin tidak memberikan penjelasan yang kuat.

## Interpretasi kacang kedelai

Berdasarkan hasil analisis dengan model VAR, analisis kausalitas, dan regresi linear ini, kita dapat menyimpulkan bahwa avg_rainfall tidak mempergaruhi produksi dan produktivitas Kacang Kedelai di Sumatera.

### ANALISIS PREDIKSI KACANG KEDELAI DENGAN GARCH

```{r}
# Menghitung residual dari model VAR
residuals_var_kedelai <- residuals(var_model_kedelai_Sumatera)
residuals_var_kedelai
```

```{r}
# karena model garch mengunakan distribusi normal, maka perlu mengecek data berdistribusi normal atau tidak
shapiro.test(data_var_kedelai_Sumatera$Produksi)
shapiro.test(data_var_kedelai_Sumatera$Produktivitas)
shapiro.test(data_var_kedelai_Sumatera$avg_rainfall)
```

```{r}
# Mengecek outlier dari residu var
boxplot(residuals_var_kedelai, main = "Boxplot of Residuals", ylab = "Residuals")
# Mengecek normalitas data
shapiro.test(residuals_var_kedelai)
```


```{r}
# Buat data frame baru dari nilai residu
residu_var_SK <- data.frame(residuals_var_kedelai)
residu_var_SK
```
```{r}
# Transformasi residual menggunakan transformasi logaritma
residu_var_SK$Produksi_log <- log(abs(residu_var_SK$Produksi) + 1)
```

```{r}
shapiro.test(residu_var_SK$Produksi_log)
```

```{r}
# Memodelkan GARCH pada residu VAR
garch_model <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1)),
                           mean.model = list(armaOrder = c(0, 0)))
```

```{r}
# Estimasi parameter GARCH
garch_pt_kedelai <- ugarchfit(spec = garch_model, data = residu_var_SK$Produktivitas)
# Menampilkan ringkasan model GARCH
show(garch_pt_kedelai)
```
```{r}
# Menyimpan hasil prediksi
Prediksi_garch_pt_kedelai <- ugarchforecast(garch_pt_kedelai, n.ahead = 10)
Prediksi_garch_pt_kedelai
```

```{r}
# Estimasi parameter GARCH
garch_avg_kedelai <- ugarchfit(spec = garch_model, data = residu_var_SK$avg_rainfall)
garch_avg_kedelai
```
```{r}
# Menyimpan hasil prediksi
prediksi_garch_avgkk <- ugarchforecast(garch_avg_kedelai, n.ahead = 10)
prediksi_garch_avgkk
```

```{r}
# Estimasi parameter GARCH
garch_produksi_kedelai <- ugarchfit(spec = garch_model, data = residu_var_SK$Produksi_log)
# Menampilkan ringkasan model GARCH
show(garch_produksi_kedelai)
```
```{r}
# Menyimpan hasil prediksi
prediksi_garch_produksi_kk <- ugarchforecast(garch_produksi_kedelai, n.ahead = 10)
prediksi_garch_produksi_kk
```
                                                                                                          
```{r}
# Mengambil nilai prediksi GARCH dan membuat menjadi data frame
prediksi_garch_kedelai <- data.frame(Produksi = as.numeric(Prediksi_garch_pt_kedelai@forecast$seriesFor[, 1]),
                                    Avg_Rainfall = as.numeric(prediksi_garch_avgkk@forecast$seriesFor[, 1]),
                                    Produktivitas = as.numeric(prediksi_garch_produksi_kk@forecast$seriesFor[, 1]))
prediksi_garch_kedelai
```

```{r}
# Menambahkan kolom tahun
prediksi_garch_kedelai$Tahun <- seq(2023, 2032)
# Menampilkan data frame
prediksi_garch_kedelai
```

```{r}
# Visualisasi tren produksi kedelai
plot_predik_produksi_kedelai <- ggplot(prediksi_garch_kedelai
                             , aes(x = Tahun, y = Produksi, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi kedelai Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi kedelai",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_tren_produksi_kedelai)
```

```{r}
# Visualisasi tren produktivitas kedelai
plot_predik_produktivitas_kedelai <- ggplot(prediksi_garch_kedelai
                             , aes(x = Tahun, y = Produktivitas, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produktivitas kedelai Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi kedelai",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_predik_produktivitas_kedelai)
```

```{r}
# Visualisasi tren avg rainfall
plot_predik_avgkk<- ggplot(prediksi_garch_kedelai
                             , aes(x = Tahun, y = avg_rainfall, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi kedelai Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi kedelai",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_predik_avgkk)
```

### Evaluasi Model

```{r}
# Mengambil data produksi kedelai selama 10 tahun terakhir
data_aktual_kk <- Sumatera_kedelai[format(Sumatera_kedelai$Tahun, "%Y") >= "2013", "Produksi"]
data_aktual_kk
```

```{r}
data_aktual_kk<- as.numeric(data_aktual_kk$Produksi)
```

```{r}
prediksi_produksi_kk <- as.numeric(prediksi_garch_kedelai$Produksi)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_kk <- sqrt(mean((data_aktual_kk - prediksi_produksi_kk)^2))
mape_garch_kk <- mean(abs((data_aktual_kk - prediksi_produksi_kk) / data_aktual_kk) * 100)
mae_garch_kk <- mean(abs(data_aktual_kk - prediksi_produksi_kk))
mse_garch_kk <- mean((data_aktual_kk - prediksi_produksi_kk)^2)

cat("MAPE from garch:", mape_garch_kk, "%\n")
cat("RMSE:", rmse_garch_kk, "\n")
cat("MAE:", mae_garch_kk, "\n")
cat("MSE:", mse_garch_kk, "\n")
```

```{r}
# Mengambil data produktivitas kedelai selama 10 tahun terakhir
data_aktual_ptkk <- Sumatera_kedelai[format(Sumatera_kedelai$Tahun, "%Y") >= "2013", "Produktivitas"]
data_aktual_ptkk
```

```{r}
data_aktual_ptkk<- as.numeric(data_aktual_ptkk$Produktivitas)
```

```{r}
prediksi_produksi_ptkk <- as.numeric(prediksi_garch_kedelai$Produktivitas)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_ptkk <- sqrt(mean((data_aktual_ptkk - prediksi_produksi_ptkk)^2))
mape_garch_ptkk <- mean(abs((data_aktual_ptkk - prediksi_produksi_ptkk) / data_aktual_ptkk) * 100)
mae_garch_ptkk <- mean(abs(data_aktual_ptkk - prediksi_produksi_ptkk))
mse_garch_ptkk <- mean((data_aktual_ptkk - prediksi_produksi_ptkk)^2)

cat("MAPE from garch:", mape_garch_ptkk, "%\n")
cat("RMSE:", rmse_garch_ptkk, "\n")
cat("MAE:", mae_garch_ptkk, "\n")
cat("MSE:", mse_garch_ptkk, "\n")
```
```{r}
# Mengambil data avg rainfall kedelai selama 10 tahun terakhir
data_aktual_rainfal <- Sumatera_kedelai[format(Sumatera_kedelai$Tahun, "%Y") >= "2013", "avg_rainfall"]
data_aktual_rainfal
```

```{r}
data_aktual_rainfal<- as.numeric(data_aktual_rainfal$avg_rainfall)
```

```{r}
prediksi_produksi_rainfal <- as.numeric(prediksi_garch_kedelai$Avg_Rainfall)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_rainfall_kk <- sqrt(mean((data_aktual_kk - prediksi_produksi_kk)^2))
mape_rainfall_kk <- mean(abs((data_aktual_kk - prediksi_produksi_kk) / data_aktual_kk) * 100)
mae_rainfall_kk <- mean(abs(data_aktual_kk - prediksi_produksi_kk))
mse_rainfall_kk <- mean((data_aktual_kedelai - prediksi_produksi_kk)^2)

cat("MAPE from :", mape_rainfall_kk, "%\n")
cat("RMSE:", rmse_rainfall_kk, "\n")
cat("MAE:", mae_rainfall_kk, "\n")
cat("MSE:", mse_rainfall_kk, "\n")
```



## VAR terhadap Produksi Kacang Hijau Sumatera

```{r}
# Pilih variabel yang akan diprediksi

data_var_kacang_hijau <- Sumatera_kacang_hijau[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_kacang_hijau
```

Untuk mendukung prediksi dengan Model VAR, data harus dirubah kedalam format time series (ts)

```{r}
#Format time series
ts_data_kacang_hijau <- ts(data_var_kacang_hijau, start = c(1993,1), frequency = 1)
ts_data_kacang_hijau
```

```{r}
best_lag_kacang_hijau <- VARselect(ts_data_kacang_hijau, lag.max = 5, type = "both")
best_lag_kacang_hijau
```

### VAR Model terhadap produksi kacang hijau Sumatera

```{r}

var_model_kacanghijau_Sumatera <- VAR(ts_data_kacang_hijau, p = best_lag_kacang_hijau$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_kacanghijau_Sumatera)
```

Estimation results for equation Produksi: avg_rainfall.l4 -143.02969 71.42177 -2.003 0.04660 \* F-statistic: 50.22 on 16 and 195 DF, p-value: \< 2.2e-16

Estimation results for equation avg_raifall: Produktivitas.l4 2.141e-01 4.567e-02 4.687 5.19e-06 \*\*\* F-statistic: 3.52 on 16 and 195 DF, p-value: 1.474e-05

Estimation results for equation Produktivitas: avg_rainfall.l4 3.388e-01 1.292e-01 2.622 0.009439 \*\* avg_rainfall.l5 2.879e-01 1.308e-01 2.202 0.028834 \* F-statistic: 8.312 on 16 and 195 DF, p-value: 4.24e-15

### Uji Kolersi Pearson kacang hijau

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_kacang_hijau1 <- cor(data_var_kacang_hijau$Produksi, data_var_kacang_hijau$avg_rainfall)
cat ("Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi:",kolerasi_kacang_hijau1)
```

Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi: -0.13

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_kacang_hijau2 <- cor(data_var_kacang_hijau$Produksi, data_var_kacang_hijau$Produktivitas)
cat ("Koefisien Korelasi Pearson Produksi dan Produktivitas:", kolerasi_kacang_hijau2)
```

Koefisien Korelasi Pearson Luas panen dan Produksi: 0.071

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_kacang_hijau3 <- cor(data_var_kacang_hijau$avg_rainfall, data_var_kacang_hijau$Produktivitas)
cat ("Koefisien Korelasi Pearson rata-rata curah hujan dan Produktivitas:", kolerasi_kacang_hijau3)
```

Koefisien Korelasi Pearson rata-rata curah hujan dan Produktivitas: 0.2239226

### Uji Granger Causality kacang hijau

```{r}
# Melakukan uji Granger Causality 
granger_kacang_hijau1 <- causality(var_model_kacanghijau_Sumatera, cause = "avg_rainfall")
granger_kacang_hijau1

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger dengan p-value = 0.009568 dan Instant dengan p-value = 0.01516. Kesimpulan terdapat bukti statistik bahwa avg_rainfaal memiliki hubungan jangka panjang dan jangka pendek terhadap produksi dan produktivitas Kacang Hijau.

```{r}
# Melakukan uji Granger Causality 
granger_kacang_hijau2 <- causality(var_model_kacanghijau_Sumatera, cause = "Produksi")
granger_kacang_hijau2

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger dgn p-value = 0.5597 dan Instant dgn p-value 0.003417

### Uji regresi linier kacang hijau

```{r}
# Membuat model regresi linier
regresi_kacang_hijau_produksi <- lm(Produksi ~ avg_rainfall , data = data_var_kacang_hijau)

# Ringkasan hasil model
summary(regresi_kacang_hijau_produksi)
```

avg_rainfall setimate: -274.4 p-value: 0.051246 Multiple R-squared: 0.01756 F-statistic: 3.843, p-value: 0.05125 *Kesimpulan* terdapat bukti bahwa curah tidak mempergaruhi mempergaruhi produksi kacang hijau

```{r}
# Membuat model regresi linier
regresi_kacang_hijau_produktivitas2 <- lm(Produktivitas ~ avg_rainfall , data = data_var_kacang_hijau)

# Ringkasan hasil model
summary(regresi_kacang_hijau_produktivitas2)
```

Estimate Std. Error t value Pr(\>\|t\|)\
(Intercept) 6.5065 1.1116 5.853 1.78e-08 ***avg_rainfall 0.4755 0.1411 3.369 0.000894*** Multiple R-squared: 0.05014, Adjusted R-squared: 0.04572 F-statistic: 11.35 on 1 and 215 DF, p-value: 0.0008943

## Interpretasi

Berdasarkan hasil analisis dengan model VAR, analisis kausalitas, dan regresi linear ini, kita dapat menyimpulkan bahwa:

1.  Dalam model VAR, bahwa variabel avg_rainfall berdampak pada produktivitas kacang karena nilai P-Value dari 2 lag yaitu Lag4 dan lag5 lebih rendah dari 0,05. tetapi avg_rainfall tidak berdampak pada produksi jagung karena nilai P-Value lebih besar dari 0,05

2.  Berdasarkan hasil uji Granger Causality dan Instantaneous Causality, ada bukti statistik yang kuat untuk mendukung adanya hubungan sebab-akibat antara "avg_rainfall" dan "Produktivitas" dalam model VAR dalam jangka waktu lag tetapi bukan dalam jangka waktu instan.

3.  Berdasarkan hasil analisis regresi didapatkan bahwa variabel "avg_rainfall"memiliki pengaruh yang signifikan terhadap variabel "Produktivitas," kacang hijau

### ANALISIS PREDIKSI KACANG HIJAU DENGAN GARCH

```{r}
# Menghitung residual dari model VAR
residuals_var_kacanghijau <- residuals(var_model_kacanghijau_Sumatera)
residuals_var_kacanghijau
```

```{r}
# karena model garch mengunakan distribusi normal, maka perlu mengecek data berdistribusi normal atau tidak
shapiro.test(data_var_kacang_hijau$Produksi)
shapiro.test(data_var_kacang_hijau$Produktivitas)
shapiro.test(data_var_kacang_hijau$avg_rainfall)
```

```{r}
# Mengecek outlier dari residu var
boxplot(residuals_var_kacanghijau, main = "Boxplot of Residuals", ylab = "Residuals")
# Mengecek normalitas data
shapiro.test(residuals_var_kacanghijau)
```

```{r}
# Buat data frame baru dari nilai residu
residu_var_KK <- data.frame(residuals_var_kacanghijau)
residu_var_KK
```

```{r}
# Transformasi residual menggunakan transformasi logaritma
residu_var_KK$Produksi_log <- log(abs(residu_var_KK$Produksi) + 1)
```

```{r}
shapiro.test(residu_var_KK$Produksi_log)
```

```{r}
# Memodelkan GARCH pada residu VAR
garch_model <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1)),
                           mean.model = list(armaOrder = c(0, 0)))
```

```{r}
# Estimasi parameter GARCH
garch_pt_kacanghijau <- ugarchfit(spec = garch_model, data = residu_var_KK$Produktivitas)
# Menampilkan ringkasan model GARCH
show(garch_pt_kacanghijau)
```
```{r}
# Menyimpan hasil prediksi
Prediksi_pt_kh <- ugarchforecast(garch_pt_kacanghijau, n.ahead = 10)
Prediksi_pt_kh
```

```{r}
# Estimasi parameter GARCH
garch_avg_kacanghijau <- ugarchfit(spec = garch_model, data = residu_var_KK$avg_rainfall)
garch_avg_kacanghijau
```
```{r}
# Menyimpan hasil prediksi
prediksi_avg_kh <- ugarchforecast(garch_avg_kacanghijau, n.ahead = 10)
prediksi_avg_kh
```

```{r}
# Estimasi parameter GARCH
garch_produksi_kacanghijau <- ugarchfit(spec = garch_model, data = residu_var_KK$Produksi_log)
# Menampilkan ringkasan model GARCH
show(garch_produksi_kacanghijau)
```
```{r}
# Menyimpan hasil prediksi
prediksi_produksi_kh <- ugarchforecast(garch_produksi_kacanghijau, n.ahead = 10)
prediksi_produksi_kh
```
                                                                                                          
```{r}
# Mengambil nilai prediksi GARCH dan membuat menjadi data frame
prediksi_garch_kacanghijau <- data.frame(Produksi = as.numeric(Prediksi_garch_pt_kh@forecast$seriesFor[, 1]),
                                    Avg_Rainfall = as.numeric(prediksi_avg_kh@forecast$seriesFor[, 1]),
                                    Produktivitas = as.numeric(prediksi_produksi_kh@forecast$seriesFor[, 1]))
prediksi_garch_kacanghijau
```

```{r}
# Menambahkan kolom tahun
prediksi_garch_kacanghijau$Tahun <- seq(2023, 2032)
# Menampilkan data frame
prediksi_garch_kacanghijau
```

```{r}
# Visualisasi tren produksi kacanghijau
plot_predik_produksi_kacanghijau <- ggplot(prediksi_garch_kacanghijau
                             , aes(x = Tahun, y = Produksi, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi kacanghijau Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi kacanghijau",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_tren_produksi_kacanghijau)
```

```{r}
# Visualisasi tren produktivitas kacanghijau
plot_predik_produktivitas_kacanghijau <- ggplot(prediksi_garch_kacanghijau
                             , aes(x = Tahun, y = Produktivitas, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produktivitas kacanghijau Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi kacanghijau",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_predik_produktivitas_kacanghijau)
```

```{r}
# Visualisasi tren avg rainfall
plot_predik_avgkk<- ggplot(prediksi_garch_kacanghijau
                             , aes(x = Tahun, y = avg_rainfall, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi kacanghijau Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi kacanghijau",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_predik_avgkk)
```

### Evaluasi Model

```{r}
# Mengambil data produksi kacanghijau selama 10 tahun terakhir
data_aktual_kh <- Sumatera_kacang_hijau[format(Sumatera_kacang_hijau$Tahun, "%Y") >= "2013", "Produksi"]
data_aktual_kh
```

```{r}
data_aktual_kh<- as.numeric(data_aktual_kh$Produksi)
```

```{r}
prediksi_produksi_kh <- as.numeric(prediksi_garch_kacanghijau$Produksi)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_kh <- sqrt(mean((data_aktual_kh - prediksi_produksi_kh)^2))
mape_garch_kh <- mean(abs((data_aktual_kh - prediksi_produksi_kh) / data_aktual_kh) * 100)
mae_garch_kh <- mean(abs(data_aktual_kh - prediksi_produksi_kh))
mse_garch_kh <- mean((data_aktual_kh - prediksi_produksi_kh)^2)

cat("MAPE from garch:", mape_garch_kh, "%\n")
cat("RMSE:", rmse_garch_kh, "\n")
cat("MAE:", mae_garch_kh, "\n")
cat("MSE:", mse_garch_kh, "\n")
```

```{r}
# Mengambil data produktivitas kacanghijau selama 10 tahun terakhir
data_aktual_ptkh <- Sumatera_kacanghijau[format(Sumatera_kacanghijau$Tahun, "%Y") >= "2013", "Produktivitas"]
data_aktual_ptkh
```

```{r}
data_aktual_ptkh<- as.numeric(data_aktual_ptkh$Produktivitas)
```

```{r}
prediksi_produksi_ptkh <- as.numeric(prediksi_garch_kacanghijau$Produktivitas)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_ptkh <- sqrt(mean((data_aktual_ptkh - prediksi_produksi_ptkh)^2))
mape_garch_ptkh <- mean(abs((data_aktual_ptkh - prediksi_produksi_ptkh) / data_aktual_ptkh) * 100)
mae_garch_ptkh <- mean(abs(data_aktual_ptkh - prediksi_produksi_ptkh))
mse_garch_ptkh <- mean((data_aktual_ptkh - prediksi_produksi_ptkh)^2)

cat("MAPE from garch:", mape_garch_ptkh, "%\n")
cat("RMSE:", rmse_garch_ptkh, "\n")
cat("MAE:", mae_garch_ptkh, "\n")
cat("MSE:", mse_garch_ptkh, "\n")
```
```{r}
# Mengambil data avg rainfall kacanghijau selama 10 tahun terakhir
data_aktual_rainfal <- Sumatera_kacanghijau[format(Sumatera_kacanghijau$Tahun, "%Y") >= "2013", "avg_rainfall"]
data_aktual_rainfal
```

```{r}
data_aktual_rainfal<- as.numeric(data_aktual_rainfal$avg_rainfall)
```

```{r}
prediksi_produksi_rainfal <- as.numeric(prediksi_garch_kacanghijau$Avg_Rainfall)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_rainfall_kh <- sqrt(mean((data_aktual_kh - prediksi_produksi_kh)^2))
mape_rainfall_kh <- mean(abs((data_aktual_kh - prediksi_produksi_kh) / data_aktual_kh) * 100)
mae_rainfall_kh <- mean(abs(data_aktual_kh - prediksi_produksi_kh))
mse_rainfall_kh <- mean((data_aktual_kacanghijau - prediksi_produksi_kh)^2)

cat("MAPE from :", mape_rainfall_kh, "%\n")
cat("RMSE:", rmse_rainfall_kh, "\n")
cat("MAE:", mae_rainfall_kh, "\n")
cat("MSE:", mse_rainfall_kh, "\n")
```


## d.VAR terhadap produksi kacang Tanah Sumatera

```{r}
# Pilih variabel yang akan diprediks
data_var_kacang_tanah <- Sumatera_kacang_tanah[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_kacang_tanah
```

Untuk mendukung prediksi dengan Model VAR, data harus dirubah kedalam format time series (ts)

```{r}
#Format time series
ts_data_kacang_tanah <- ts(data_var_kacang_tanah, start = c(1993,1), frequency = 1)
ts_data_kacang_tanah
```

```{r}
best_lag_kacang_tanah <- VARselect(ts_data_kacang_tanah, lag.max = 5, type = "both")
best_lag_kacang_tanah
```

### VAR Model terhadap produksi kacang tanah Sumatera

```{r}

var_model_kacangtanah_Sumatera <- VAR(ts_data_kacang_tanah, p = best_lag_kacang_tanah$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_kacangtanah_Sumatera)
```

Estimation results for equation Produksi: avg_rainfall.l1 368.63397 153.31163 2.404 0.016904 *avg_rainfall.l4 -504.09274 149.84054 -3.364 0.000885* \*\* Multiple R-Squared: 0.8454, F-statistic: 87.82 on 16 and 257 DF, p-value: \< 2.2e-16

Estimation results for equation avg_rainfall: Produksi.l1 -6.662e-05 2.474e-05 -2.692 0.00756 \*\* Produktivitas.l3 1.770e-01 5.960e-02 2.969 0.00327 \*\* Produksi.l4 -7.044e-05 2.895e-05 -2.434 0.01563 \*\
Produksi.l5 6.455e-05 2.245e-05 2.875 0.00437 \*\* Multiple R-Squared: 0.2155, F-statistic: 4.411 on 16 and 257 DF, p-value: 1.086e-07

Estimation results for equation Produktivitas: avg_rainfall.l2 -1.734e-01 7.489e-02 -2.315 0.02138 \* Multiple R-Squared: 0.6028, F-statistic: 24.38 on 16 and 257 DF, p-value: \< 2.2e-16

### Uji Kolersi Pearson kacang tanah

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_kacang_tanah1 <- cor(data_var_kacang_tanah$avg_rainfall, data_var_kacang_tanah$Produksi)
cat ("Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi:",kolerasi_kacang_tanah1)
```

Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi: -0.085

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_kacang_tanah2 <- cor(data_var_kacang_tanah$avg_rainfall, data_var_kacang_tanah$Produktivitas)
cat ("Koefisien Korelasi Pearson rata-rata curah hujan dan Produktivitas:", kolerasi_kacang_tanah2)
```

Koefisien Korelasi Pearson rata-rata curah hujan dan Produktivitas : 0.13

### Uji Granger Causality Kacang Tanah

```{r}
# Melakukan uji Granger Causality 
granger_kacang_tanah1 <- causality(var_model_kacangtanah_Sumatera, cause = "avg_rainfall")
granger_kacang_tanah1

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger p-value = 0.004093 Instant p-value = 0.9764

```{r}
# Melakukan uji Granger Causality 
granger_kacang_tanah2 <- causality(var_model_kacangtanah_Sumatera, cause = "Produksi")
granger_kacang_tanah2

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger p-value = 0.007193 Instant p-value =0.08421 *Kesimpulan* Terdapat pengaruh jangka panjang produksi terhadap Porduktivitas dan avg_rainfall

### Uji regresi linier Kacang Tanah

```{r}
# Membuat model regresi linier
regresi_kacang_tanah_produksi<- lm(Produksi ~ avg_rainfall , data = data_var_kacang_tanah)

# Ringkasan hasil model
summary(regresi_kacang_tanah_produksi)
```

Coefficients: Estimate Std. Error t value Pr(\>\|t\|)\
(Intercept) 10645.5 2810.6 3.788 0.000187 \*\* *avg_rainfall -513.0 361.1 -1.420 0.156629 Multiple R-squared: 0.00723, Adjusted R-squared: 0.003646 F-statistic: 2.017 on 1 and 277 DF, p-value: 0.1566* Kesimpulan\* produksi kacang tanah tidak di perngaruhi oleh avg_rainfall. R-squared yang kecil menunjukan model tidak baik menjelaskan hubungan ini.

```{r}
# Membuat model regresi linier
regresi_kacang_tanah_produktivitas<- lm(Produktivitas ~ avg_rainfall , data = data_var_kacang_tanah)

# Ringkasan hasil model
summary(regresi_kacang_tanah_produktivitas)
```

Estimate Std. Error t value Pr(\>\|t\|)\
(Intercept) 9.7845 0.7911 12.37 \<2e-16 \*\* *avg_rainfall 0.2256 0.1017 2.22 0.0272* \
Multiple R-squared: 0.01748, Adjusted R-squared: 0.01393 F-statistic: 4.928 on 1 and 277 DF, p-value: 0.02724 *Kesimpulan* Terdapat pengaruh curah hujan terhadap produktivitas kacang tanah.

## Interpretasi

Terdapat pengaruh avg_rainfall terhadap produksi dan produktivitas Berdasarkan hasil analisis dengan model VAR, analisis kausalitas, dan regresi linear ini:

1.  Dalam model VAR, bahwa variabel avg_rainfall berdampak pada produktivitas kacang tanah karena nilai P-Value dari lag2 yg lebih rendah dari 0,05. serta avg_rainfall berdampak pada produksi kacang tanah karena nilai P-Value dari lag1 dan lag4 lebih keceil dari 0,05 dan nilai r-squared yang tinggi.

2.  Berdasarkan hasil uji Granger Causality dan Instantaneous Causality, ada bukti statistik yang kuat untuk mendukung adanya hubungan sebab-akibat antara "avg_rainfall" terhadap "Produksi" dan "Produktivitas" dalam model VAR dalam jangka waktu lag tetapi bukan dalam jangka waktu instan.

3.  Berdasarkan hasil analisis regresi didapatkan bahwa variabel "avg_rainfall"memiliki pengaruh yang signifikan terhadap variabel "Produktivitas," dan avg_ranfall tidak signifikan terhadap produksi tetapi memiliki r-squared yang kecil.


### ANALISIS PREDIKSI KACANG TANAH DENGAN GARCH 

```{r}
# Menghitung residual dari model VAR
residuals_var_kacangtanah <- residuals(var_model_kacangtanah_Sumatera)
residuals_var_kacangtanah
```

```{r}
# karena model garch mengunakan distribusi normal, maka perlu mengecek data berdistribusi normal atau tidak
shapiro.test(data_var_kacangtanah$Produksi)
shapiro.test(data_var_kacangtanah$Produktivitas)
shapiro.test(data_var_kacangtanah$avg_rainfall)
```

```{r}
# Mengecek outlier dari residu var
boxplot(residuals_var_kacangtanah, main = "Boxplot of Residuals", ylab = "Residuals")
# Mengecek normalitas data
shapiro.test(residuals_var_kacangtanah)
```

```{r}
# Buat data frame baru dari nilai residu
residu_var_KT <- data.frame(residuals_var_kacangtanah)
residu_var_KT
```
```{r}
# Transformasi residual menggunakan transformasi logaritma
residu_var_SJ$Produksi_log <- log(abs(residu_var_KT$Produksi) + 1)
```

```{r}
shapiro.test(residu_var_KT$Produksi_log)
```

```{r}
# Memodelkan GARCH pada residu VAR
garch_model <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1)),
                           mean.model = list(armaOrder = c(0, 0)))
```

```{r}
# Estimasi parameter GARCH
garch_pt_kacangtanah <- ugarchfit(spec = garch_model, data = residu_var_KT$Produktivitas)
# Menampilkan ringkasan model GARCH
show(garch_pt_kacangtanah)
```
```{r}
# Menyimpan hasil prediksi
Prediksi_pt_kt <- ugarchforecast(garch_pt_kacangtanah, n.ahead = 10)
Prediksi_pt_kt
```

```{r}
# Estimasi parameter GARCH
garch_avg_kacangtanah <- ugarchfit(spec = garch_model, data = residu_var_KT$avg_rainfall)
# Menampilkan ringkasan model GARCH
show(garch_avg_kacangtanah)
```
```{r}
# Menyimpan hasil prediksi
prediksi_avg_kt <- ugarchforecast(garch_avg_kacangtanah, n.ahead = 10)
prediksi_avg_kt
```

```{r}
# Estimasi parameter GARCH
garch_produksi_kacangtanah <- ugarchfit(spec = garch_model, data = residu_var_KT$Produksi_log)
# Menampilkan ringkasan model GARCH
show(garch_produksi_kacangtanah)
```
```{r}
# Menyimpan hasil prediksi
prediksi_produksi_kt <- ugarchforecast(garch_produksi_kacangtanah, n.ahead = 10)
prediksi_produksi_kt
```
                                                                                                          
```{r}
# Mengambil nilai prediksi GARCH dan membuat menjadi data frame
prediksi_kacangtanah <- data.frame(Produksi = as.numeric(Prediksi_pt_kt@forecast$seriesFor[, 1]),
                                    Avg_Rainfall = as.numeric(prediksi_avg_kt@forecast$seriesFor[, 1]),
                                    Produktivitas = as.numeric(prediksi_produksi_kt@forecast$seriesFor[, 1]))
prediksi_garch_kacangtanah
```

```{r}
# Menambahkan kolom tahun
prediksi_garch_kacangtanah$Tahun <- seq(2023, 2032)
# Menampilkan data frame
prediksi_garch_kacangtanah
```

```{r}
# Visualisasi tren produksi kacangtanah
plot_predik_produksi <- ggplot(prediksi_garch_kacangtanah
                             , aes(x = Tahun, y = Produksi, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi kacang tanah Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi kacang tanah",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_tren_produksi)
```

```{r}
# Visualisasi tren produktivitas kacang tanah
plot_predik_produksi <- ggplot(prediksi_garch_kacangtanah
                             , aes(x = Tahun, y = Produktivitas, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produktivitas kacang tanah Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi kacang tanah",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_tren_produksi)
```

```{r}
# Visualisasi tren produksi kedelai
plot_predik_produksi <- ggplot(prediksi_garch_kacangtanah
                             , aes(x = Tahun, y = avg_rainfall, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi kacang tanah Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi kacangtanah",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_tren_produksi)
```

### Evaluasi Model

```{r}
# Mengambil data produksi kacangtanah selama 10 tahun terakhir
data_aktual_kt <- Sumatera_kacang_tanah[format(Sumatera_kacang_tanah$Tahun, "%Y") >= "2013", "Produksi"]
data_aktual_kt
```

```{r}
data_aktual_kt<- as.numeric(data_aktual_kt$Produksi)
```

```{r}
prediksi_produksi_kt <- as.numeric(prediksi_garch_kacangtanah$Produksi)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_kt <- sqrt(mean((data_aktual_kt - prediksi_produksi_kt)^2))
mape_garch_kt <- mean(abs((data_aktual_kt - prediksi_produksi_kt) / data_aktual_kt) * 100)
mae_garch_kt <- mean(abs(data_aktual_kt - prediksi_produksi_kt))
mse_garch_kt <- mean((data_aktual_kt - prediksi_produksi_kt)^2)

cat("MAPE from garch:", mape_garch_kt, "%\n")
cat("RMSE:", rmse_garch_kt, "\n")
cat("MAE:", mae_garch_kt, "\n")
cat("MSE:", mse_garch_kt, "\n")
```

```{r}
# Mengambil data produktivitas kacangtanah selama 10 tahun terakhir
data_aktual_ptkt <- Sumatera_kacang_tanah[format(Sumatera_kacang_tanah$Tahun, "%Y") >= "2013", "Produktivitas"]
data_aktual_ptkt
```

```{r}
data_aktual_ptkt<- as.numeric(data_aktual_ptkt$Produktivitas)
```

```{r}
prediksi_produksi_ptkt <- as.numeric(prediksi_garch_kacangtanah$Produktivitas)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_ptkt <- sqrt(mean((data_aktual_ptkt - prediksi_produksi_ptkt)^2))
mape_garch_ptkt <- mean(abs((data_aktual_ptkt - prediksi_produksi_ptkt) / data_aktual_ptkt) * 100)
mae_garch_ptkt <- mean(abs(data_aktual_ptkt - prediksi_produksi_ptkt))
mse_garch_ptkt <- mean((data_aktual_ptkt - prediksi_produksi_ptkt)^2)

cat("MAPE from garch:", mape_garch_ptkt, "%\n")
cat("RMSE:", rmse_garch_ptkt, "\n")
cat("MAE:", mae_garch_ptkt, "\n")
cat("MSE:", mse_garch_ptkt, "\n")
```
```{r}
# Mengambil data avg rainfall kacangtanah selama 10 tahun terakhir
data_rainfal_kt <- Sumatera_kacang_tanah[format(Sumatera_kacang_tanah$Tahun, "%Y") >= "2013", "avg_rainfall"]
data_rainfal_kt
```

```{r}
data_rainfal_kt<- as.numeric(data_rainfal_kt$avg_rainfall)
```

```{r}
prediksi_rainfall_kt <- as.numeric(prediksi_garch_kacangtanah$avg_rainfall)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_rainfall <- sqrt(mean((data_rainfal_kt - prediksi_rainfall_kt)^2))
mape_garch_rainfall <- mean(abs((data_rainfal_kt - prediksi_rainfall_kt) / data_rainfal_kt) * 100)
mae_garch_rainfall <- mean(abs(data_rainfal_kt - prediksi_rainfall_kt))
mse_garch_rainfall <- mean((data_rainfal_kt - prediksi_rainfall_kt)^2)

cat("MAPE from garch:", mape_garch_rainfall, "%\n")
cat("RMSE:", rmse_garch_rainfall, "\n")
cat("MAE:", mae_garch_rainfall, "\n")
cat("MSE:", mse_garch_rainfall, "\n")
```


## e. VAR terhadap Ubi Jalar Sumatera

```{r}
# Pilih variabel yang akan diprediksi

data_var_ubijalar <- Sumatera_ubi_jalar[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_ubijalar
```

Untuk mendukung prediksi dengan Model VAR, data harus dirubah kedalam format time series (ts)

```{r}
#Format time series
ts_data_ubijalar_Sumatera<- ts(data_var_ubijalar, start = c(1993,1), frequency = 1)
ts_data_ubijalar_Sumatera
```

```{r}
best_lag_ubijalar_Sumatera<- VARselect(ts_data_ubijalar_Sumatera, lag.max = 5, type = "both")
best_lag_ubijalar_Sumatera
```

### VAR Model terhadap produksi Ubi Jalar Sumatera

```{r}

var_model_ubijalar_Sumatera <- VAR(ts_data_ubijalar_Sumatera, p = best_lag_ubijalar_Sumatera$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_ubijalar_Sumatera)
```

Estimation results for equation Produksi: avg_rainfall.l1 1.814e+03 8.695e+02 2.086 0.0380 \* avg_rainfall.l5 -1.897e+03 8.822e+02 -2.151 0.0324 \* F-statistik p-value: \< 2.2e-16

Estimation results for equation avg_rainfall: Produksi.l1 -1.413e-05 4.270e-06 -3.309 0.001070 **Produksi.l2 1.830e-05 5.834e-06 3.136 0.001908** Produktivitas.l3 -6.053e-03 2.781e-03 -2.176 0.030453 \*\
Produktivitas.l4 1.063e-02 2.784e-03 3.818 0.000169 ***Produksi.l5 1.097e-05 4.361e-06 2.516 0.012485*** **\
Produktivitas.l5 -8.982e-03 1.994e-03 -4.505 1.01e-05** \* F-statistik p-value:2.831e-08

Estimation results for equation produktivitas: avg_rainfall.l1 -4.457e+00 1.832e+00 -2.433 0.015670 \* avg_rainfall.l4 6.654e+00 1.825e+00 3.645 0.000323 \*\*\* F-statistik p-value: \< 2.2e-16

```{r}
irf_plot2 <- irf(var_model_ubijalar_Sumatera, impulse = "avg_rainfall", response = c("Produktivitas"), n.ahead = 15)
plot(irf_plot2)
```

```{r}
irf_plot2 <- irf(var_model_ubijalar_Sumatera, impulse = "avg_rainfall", response = c("Produksi"), n.ahead = 15)
plot(irf_plot2)
```

### Uji Kolersi Pearson Ubi Jalar

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_ubijalar_Sumatera1 <- cor(data_var_ubijalar$Produksi, data_var_ubijalar$avg_rainfall)
cat ("Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi:",kolerasi_ubijalar_Sumatera1)
```

Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi: 0.1016382

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_ubijalar_Sumatera2 <- cor(data_var_ubijalar$avg_rainfall, data_var_ubijalar$Produktivitas)
cat ("Koefisien Korelasi Pearson Rata-rata curah hujan dan produksi:", kolerasi_ubijalar_Sumatera2)
```

Koefisien Korelasi Pearson Rata-rata curah hujan dan produksi: 0.1584551

### Uji Granger Causality ubi jalar

```{r}
# Melakukan uji Granger Causality 
granger_ubijalar_Sumatera1 <- causality(var_model_ubijalar_Sumatera, cause = "avg_rainfall")
granger_ubijalar_Sumatera1

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger p-value = 0.0003156 Instant p-value = 0.7472 terdapat bukti signifikan sebab akibat avg-rainfall terhadap produksi dan produksivitas dalam jangkah panjang tetapi tidak di jangka instant

```{r}
# Melakukan uji Granger Causality 
granger_ubijalar_Sumatera2 <- causality(var_model_ubijalar_Sumatera, cause = "Produksi")
granger_ubijalar_Sumatera2

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger p-value =0.0006602 dan Instant p-value 0.02525 terdapat bukti signifikan sebab akibat produksi terhadap avg_rainfall dan produksivitas baik jangkah panjang dan di jangka instant

### Uji regresi linier Ubi jalar

```{r}
# Membuat model regresi linier
regresi_ubijalar_produktivitas <- lm(Produktivitas ~ avg_rainfall, data = data_var_ubijalar)

# Ringkasan hasil model
summary(regresi_ubijalar_produktivitas)
```

Coefficients: Estimate Std. Error t value Pr(\>\|t\|)\
(Intercept) 49.338 27.533 1.792 0.0742 . avg_rainfall 9.460 3.536 2.676 0.0079 \*\* Multiple R-squared: 0.02511, Adjusted R-squared: 0.0216 F-statistic: 7.16 on 1 and 278 DF, p-value: 0.007898

```{r}
# Membuat model regresi linier
regresi_ubijalar_produksi <- lm(Produksi ~ avg_rainfall, data = data_var_ubijalar)

# Ringkasan hasil model
summary(regresi_ubijalar_produksi)
```

oefficients: Estimate Std. Error t value Pr(\>\|t\|)\
(Intercept) 12092 17239 0.701 0.4836\
avg_rainfall 3771 2214 1.703 0.0896 . Multiple R-squared: 0.01033,\
F-statistic: 2.902 on 1 and 278 DF, p-value: 0.0896

## Interpretasi

Terdapat dapat avg_Rainfall terhadap produksi dan produktivitas, Berdasarkan hasil analisis dengan model VAR, analisis kausalitas, dan regresi linear ini, kita dapat menyimpulkan bahwa:

1.  Dalam model VAR, bahwa variabel avg_rainfall berdampak pada variabel *produksi* karena p-valuen dari 2 lag yaitu lag1 dan lag5 lbih kecil dari 0,05. dan variabel avg_rainfall berdampak pada *produktivitas* karena nilai p-value di lag berdampak pada produktivitas kacang karena nilai P-Value dari 2 lag yaitu Lag1 dan lag4 lebih rendah dari 0,05.

2.  Berdasarkan hasil uji Granger Causality dan Instantaneous Causality, ada bukti statistik yang kuat untuk mendukung adanya hubungan sebab-akibat antara "avg_rainfall" pada "produksi" dan "Produktivitas" dalam model VAR dalam jangka waktu lag tetapi bukan dalam jangka waktu instan.

3.  Berdasarkan hasil analisis regresi didapatkan bahwa variabel "avg_rainfall"memiliki pengaruh yang signifikan terhadap variabel "Produktivitas," tetapi avg_rainfall tidak memiliki dampak kepada produksi.

### ANALISIS PREDIKSI UBI JALAR DENGAN GARCH

```{r}
# Menghitung residual dari model VAR
residuals_var_ubijalar <- residuals(var_model_ubijalar_Sumatera)
residuals_var_ubijalar
```

```{r}
# karena model garch mengunakan distribusi normal, maka perlu mengecek data berdistribusi normal atau tidak
shapiro.test(data_var_ubijalar$Produksi)
shapiro.test(data_var_ubijalar$Produktivitas)
shapiro.test(data_var_ubijalar$avg_rainfall)
```

```{r}
# Mengecek outlier dari residu var
boxplot(residuals_var_ubijalar, main = "Boxplot of Residuals", ylab = "Residuals")
# Mengecek normalitas data
shapiro.test(residuals_var_ubijalar)
```

```{r}
# Buat data frame baru dari nilai residu
residu_var_UJ <- data.frame(residuals_var_ubijalar)
residu_var_UJ
```
```{r}
# Transformasi residual menggunakan transformasi logaritma
residu_var_UJ$Produksi_log <- log(abs(residu_var_UJ$Produksi) + 1)
```

```{r}
shapiro.test(residu_var_kk$Produksi_log)
```

```{r}
# Memodelkan GARCH pada residu VAR
garch_model <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1)),
                           mean.model = list(armaOrder = c(0, 0)))
```

```{r}
# Estimasi parameter GARCH
garch_pt_ubijalar <- ugarchfit(spec = garch_model, data = residu_var_UJ$Produktivitas)
# Menampilkan ringkasan model GARCH
show(garch_pt_ubijalar)
```
```{r}
# Menyimpan hasil prediksi
prediksi_pt_uj <- ugarchforecast(garch_pt_ubijalar, n.ahead = 10)
prediksi_pt_uj
```

```{r}
# Estimasi parameter GARCH
garch_avg_ubijalar <- ugarchfit(spec = garch_model, data = residu_var_UJ$avg_rainfall)
# Menampilkan ringkasan model GARCH
show(garch_avg_ubijalar)
```
```{r}
# Menyimpan hasil prediksi
prediksi_avg_uj <- ugarchforecast(garch_avg_ubijalar, n.ahead = 10)
prediksi_avg_uj
```

```{r}
# Estimasi parameter GARCH
garch_produksi_ubijalar <- ugarchfit(spec = garch_model, data = residu_var_UJ$Produksi_log)
# Menampilkan ringkasan model GARCH
show(garch_produksi_ubijalar)
```
```{r}
# Menyimpan hasil prediksi
prediksi_produksi_uj <- ugarchforecast(garch_produksi_ubijalar, n.ahead = 10)
prediksi_produksi_uj
```
                                                                                                          
```{r}
# Mengambil nilai prediksi GARCH dan membuat menjadi data frame
prediksi_garch_ubijalar <- data.frame(Produksi = as.numeric(prediksi_pt_uj@forecast$seriesFor[, 1]),
                                    Avg_Rainfall = as.numeric(prediksi_avg_uj@forecast$seriesFor[, 1]),
                                    Produktivitas = as.numeric(prediksi_produksi_uj@forecast$seriesFor[, 1]))
prediksi_garch_ubijalar
```

```{r}
# Menambahkan kolom tahun
prediksi_garch_ubijalar$Tahun <- seq(2023, 2032)
# Menampilkan data frame
prediksi_garch_ubijalar
```

```{r}
# Visualisasi tren produksi ubijalar
plot_predik_produksi <- ggplot(prediksi_garch_ubijalar
                             , aes(x = Tahun, y = Produksi, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi ubijalar Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi ubijalar",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_tren_produksi)
```

```{r}
# Visualisasi tren produktivitas ubijalar
plot_predik_produksi <- ggplot(prediksi_garch_ubijalar
                             , aes(x = Tahun, y = Produktivitas, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produktivitas ubijalar Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi ubijalar",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_tren_produksi)
```

```{r}
# Visualisasi tren produksi kedelai
plot_predik_produksi <- ggplot(prediksi_garch_ubijalar
                             , aes(x = Tahun, y = avg_rainfall, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi ubijalar Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi ubijalar",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_tren_produksi)
```

### Evaluasi Model

```{r}
# Mengambil data produksi ubijalar selama 10 tahun terakhir
data_aktual_uj <- Sumatera_ubi_jalar[format(Sumatera_ubi_jalar$Tahun, "%Y") >= "2013", "Produksi"]
data_aktual_uj
```

```{r}
data_aktual_uj<- as.numeric(data_aktual_uj$Produksi)
```

```{r}
prediksi_produksi_uj <- as.numeric(prediksi_garch_ubijalar$Produksi)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_uj <- sqrt(mean((data_aktual_uj - prediksi_produksi_uj)^2))
mape_garch_uj <- mean(abs((data_aktual_uj - prediksi_produksi_uj) / data_aktual_uj) * 100)
mae_garch_uj <- mean(abs(data_aktual_uj - prediksi_produksi_uj))
mse_garch_uj <- mean((data_aktual_uj - prediksi_produksi_uj)^2)

cat("MAPE from garch:", mape_garch_uj, "%\n")
cat("RMSE:", rmse_garch_uj, "\n")
cat("MAE:", mae_garch_uj, "\n")
cat("MSE:", mse_garch_uj, "\n")
```

```{r}
# Mengambil data produktivitas ubijalar selama 10 tahun terakhir
data_aktual_ptj <- Sumatera_ubi_jalar[format(Sumatera_ubi_jalar$Tahun, "%Y") >= "2013", "Produktivitas"]
data_aktual_ptj
```

```{r}
data_aktual_ptj<- as.numeric(data_aktual_ptj$Produktivitas)
```

```{r}
prediksi_produksi_ptj <- as.numeric(prediksi_garch_ubijalar$Produktivitas)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_ptj <- sqrt(mean((data_aktual_ptj - prediksi_produksi_ptj)^2))
mape_garch_ptj <- mean(abs((data_aktual_ptj - prediksi_produksi_ptj) / data_aktual_ptj) * 100)
mae_garch_ptj <- mean(abs(data_aktual_ptj - prediksi_produksi_ptj))
mse_garch_ptj <- mean((data_aktual_ptj - prediksi_produksi_ptj)^2)

cat("MAPE from garch:", mape_garch_ptj, "%\n")
cat("RMSE:", rmse_garch_ptj, "\n")
cat("MAE:", mae_garch_ptj, "\n")
cat("MSE:", mse_garch_ptj, "\n")
```
```{r}
# Mengambil data avg rainfall ubijalar selama 10 tahun terakhir
data_aktual_rainfal <- Sumatera_ubi_jalar[format(Sumatera_ubi_jalar$Tahun, "%Y") >= "2013", "avg_rainfall"]
data_aktual_rainfal
```

```{r}
data_aktual_rainfal<- as.numeric(data_aktual_rainfal$avg_rainfall)
```

```{r}
prediksi_produksi_rainfal <- as.numeric(prediksi_garch_ubijalar$avg_rainfall)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_rainfall <- sqrt(mean((data_aktual_uj - prediksi_produksi_uj)^2))
mape_garch_rainfall <- mean(abs((data_aktual_uj - prediksi_produksi_uj) / data_aktual_uj) * 100)
mae_garch_rainfall <- mean(abs(data_aktual_uj - prediksi_produksi_uj))
mse_garch_rainfall <- mean((data_aktual_kedelai - prediksi_produksi_uj)^2)

cat("MAPE from garch:", mape_garch_rainfall, "%\n")
cat("RMSE:", rmse_garch_rainfall, "\n")
cat("MAE:", mae_garch_rainfall, "\n")
cat("MSE:", mse_garch_rainfall, "\n")
```



## f. VAR terhadap Ubi Kayu Sumatera

```{r}
# Pilih variabel yang akan diprediksi

data_var_ubikayu <- Sumatera_ubi_kayu[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_ubikayu
```

Untuk mendukung prediksi dengan Model VAR, data harus dirubah kedalam format time series (ts)

```{r}
#Format time series
ts_data_ubikayu_Sumatera <- ts(data_var_ubikayu, start = c(1993,1), frequency = 1)
ts_data_ubikayu_Sumatera
```

```{r}
best_lag_ubikayu_Sumatera<- VARselect(ts_data_ubikayu_Sumatera, lag.max = 5, type = "both")
best_lag_ubikayu_Sumatera
```

### VAR Model terhadap produksi ubi kayu Sumatera

```{r}

var_model_ubikayu_Sumatera <- VAR(ts_data_ubikayu_Sumatera, p = best_lag_ubikayu_Sumatera$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_ubikayu_Sumatera)
```

Estimation results for equation avg_rainfall: Produktivitas.l1 4.090e-03 1.371e-03 2.982 0.00314 \*\* Produksi.l2 4.111e-07 1.843e-07 2.231 0.02657 \*\
Produktivitas.l2 -4.196e-03 1.782e-03 -2.355 0.01927 \*\
Produktivitas.l4 4.892e-03 1.773e-03 2.760 0.00620 \*\* Produktivitas.l5 -6.183e-03 1.388e-03 -4.454 1.26e-05 \*\*\* F-statistic: 4.292 on 16 and 258 DF, p-value: 1.973e-07

Estimation results for equation Produktivitas: avg_rainfall.l1 -1.274e+01 2.695e+00 -4.727 3.75e-06 ***avg_rainfall.l4 9.707e+00 2.726e+00 3.560 0.000441*** avg_rainfall.l5 6.822e+00 2.780e+00 2.454 0.014797 \* p-value: \< 2.2e-16

### Uji Kolersi Pearson ubikayu

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_ubikayu_Sumatera1 <- cor(data_var_ubikayu$Produksi, data_var_ubikayu$avg_rainfall)
cat ("Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi:",kolerasi_ubikayu_Sumatera1)
```

Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi: -0.04974876

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_ubikayu_Sumatera2 <- cor(data_var_ubikayu$avg_rainfall, data_var_ubikayu$Produktivitas)
cat ("Koefisien Korelasi Pearson rata-rata curah hujan dan Produktivitas:", kolerasi_ubikayu_Sumatera2)
```

Koefisien Korelasi Pearson rata-rata curah hujan dan Produktivitas: 0.1527877

### Uji Granger Causality ubikayu

```{r}
# Melakukan uji Granger Causality 
granger_ubikayu_Sumatera1 <- causality(var_model_ubikayu_Sumatera, cause = "avg_rainfall")
granger_ubikayu_Sumatera1

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger p-value = 9.184e-07 dan Instant p-value = 0.4729. terdapat bukti statistik hubungan jangka lag maupun instant antara avg_rainfal, produksi, produktivitas.

```{r}
# Melakukan uji Granger Causality 
granger_ubikayu_Sumatera2 <- causality(var_model_ubikayu_Sumatera, cause = "Produksi")
granger_ubikayu_Sumatera2

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger = p-value = 0.6661 Instant = p-value = 0.5903

```{r}
granger_ubikayu_sumatera3<- causality(var_model_ubikayu_Sumatera, cause = "Produktivitas")
granger_ubikayu_sumatera3
```

### Uji regresi linier ubikayu

```{r}
# Membuat model regresi linier
regresi_ubikayu_produksi<- lm(Produksi ~ avg_rainfall, data = data_var_ubikayu)

# Ringkasan hasil model
summary(regresi_ubikayu_produksi)
```

Coefficients: Estimate Std. Error t value Pr(\>\|t\|)\
(Intercept) 1311158 719490 1.822 0.0695 . avg_rainfall -76732 92392 -0.831 0.4070 Multiple R-squared: 0.002475,\
F-statistic: 0.6897 on 1 and 278 DF, p-value: 0.407

```{r}
# Membuat model regresi linier
regresi_ubikayu_Sumatera_produktivitas <- lm(Produktivitas~ avg_rainfall , data = data_var_ubikayu)

# Ringkasan hasil model
summary(regresi_ubikayu_Sumatera_produktivitas)
```

Coefficients: Estimate Std. Error t value Pr(\>\|t\|)\
(Intercept) 89.982 40.405 2.227 0.0267 *avg_rainfall 13.375 5.188 2.578 0.0105* Multiple R-squared: 0.02334,\
F-statistic: 6.645 on 1 and 278 DF, p-value: 0.01046

## Interpretasi

Berdasarkan hasil analisis dengan model VAR, analisis kausalitas, dan regresi linear ini, kita dapat menyimpulkan bahwa:

1.  Dalam model VAR, bahwa variabel avg_rainfall berdampak pada *produktivitas* ubi kayu karena nilai P-Value dari 3 lag yaitu Lag1, Lag4 dan lag5 lebih rendah dari 0,05. tetapi avg_rainfall tidak berdampak pada produksi jagung karena nilai P-Value lebih besar dari 0,05

2.  Berdasarkan hasil uji Granger Causality dan Instantaneous Causality, ada bukti statistik yang kuat untuk mendukung adanya hubungan sebab-akibat antara "avg_rainfall" dan "Produktivitas" dalam model VAR dalam jangka waktu lag tetapi bukan dalam jangka waktu instan. dan tidak terdapat sebab-akibat anatar avg_rainfal dan Produksi ubi kayu baik kangak waktu lag maupun isntant

3.  Berdasarkan hasil analisis regresi didapatkan bahwa variabel "avg_rainfall"memiliki pengaruh yang signifikan terhadap variabel "Produktivitas," Ubi kayu tetapi avg_rainfall tidak memiliki pengaruh terhadap produksi Ubi kayu.

### ANALISIS PREDIKSI UBI KAYU DENGAN GARCH

```{r}
# Menghitung residual dari model VAR
residuals_var_ubikayu <- residuals(var_model_ubikayu_Sumatera)
residuals_var_ubikayu
```

```{r}
# karena model garch mengunakan distribusi normal, maka perlu mengecek data berdistribusi normal atau tidak
shapiro.test(data_var_ubikayu$Produksi)
shapiro.test(data_var_ubikayu$Produktivitas)
shapiro.test(data_var_ubikayu$avg_rainfall)
```

```{r}
# Mengecek outlier dari residu var
boxplot(residuals_var_ubikayu, main = "Boxplot of Residuals", ylab = "Residuals")
# Mengecek normalitas data
shapiro.test(residuals_var_ubikayu)
```

data: residuals_var W = 0.3585, p-value < 2.2e-16
Hasil dari uji Shapiro-Wilk menunjukkan nilai p-value yang rendah,yang menunjukkan bahwa data residual tidak normal. Hal ini dapat menyebabkan kesalahan pada proses pemodelan, karena model GARCH mengasumsikan bahwa data residual normal.

```{r}
# Buat data frame baru dari nilai residu
residu_var_UK <- data.frame(residuals_var_ubikayu)
residu_var_UK
```
```{r}
# Transformasi residual menggunakan transformasi logaritma
residu_var_UK$Produksi_log <- log(abs(residu_var_UK$Produksi) + 1)
```

```{r}
shapiro.test(residu_var_UK$Produksi_log)
```

```{r}
# Memodelkan GARCH pada residu VAR
garch_model <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1)),
                           mean.model = list(armaOrder = c(0, 0)))
```

```{r}
# Estimasi parameter GARCH
garch_pt_ubikayu <- ugarchfit(spec = garch_model, data = residu_var_UK$Produktivitas)
# Menampilkan ringkasan model GARCH
show(garch_pt_ubikayu)
```
```{r}
# Menyimpan hasil prediksi
prediksi_pt_uk <- ugarchforecast(garch_pt_ubikayu, n.ahead = 10)
prediksi_pt_uk
```

```{r}
# Estimasi parameter GARCH
garch_avg_ubikayu <- ugarchfit(spec = garch_model, data = residu_var_UK$avg_rainfall)
# Menampilkan ringkasan model GARCH
show(garch_avg_ubikayu)
```
```{r}
# Menyimpan hasil prediksi
prediksi_avg_uk<- ugarchforecast(garch_avg_ubikayu, n.ahead = 10)
prediksi_avg_uk
```

```{r}
# Estimasi parameter GARCH
garch_produksi_ubikayu <- ugarchfit(spec = garch_model, data = residu_var_UK$Produksi_log)
# Menampilkan ringkasan model GARCH
show(garch_produksi_ubikayu)
```
```{r}
# Menyimpan hasil prediksi
prediksi_produksi_uk <- ugarchforecast(garch_produksi_ubikayu, n.ahead = 10)
prediksi_produksi_uk
```
                                                                                                          
```{r}
# Mengambil nilai prediksi GARCH dan membuat menjadi data frame
prediksi_garch_ubikayu <- data.frame(Produksi = as.numeric(prediksi_pt_uk@forecast$seriesFor[, 1]),
                                    Avg_Rainfall = as.numeric(prediksi_avg_uk@forecast$seriesFor[, 1]),
                                    Produktivitas = as.numeric(prediksi_produksi_uk@forecast$seriesFor[, 1]))
prediksi_garch_ubikayu
```

```{r}
# Menambahkan kolom tahun
prediksi_garch_ubikayu$Tahun <- seq(2023, 2032)
# Menampilkan data frame
prediksi_garch_ubikayu
```

```{r}
# Visualisasi tren produksi ubikayu
plot_predik_produksi <- ggplot(prediksi_garch_ubikayu
                             , aes(x = Tahun, y = Produksi, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi ubikayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi ubikayu",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_tren_produksi)
```

```{r}
# Visualisasi tren produktivitas ubikayu
plot_predik_produksi <- ggplot(prediksi_garch_ubikayu
                             , aes(x = Tahun, y = Produktivitas, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produktivitas ubikayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi ubikayu",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_tren_produksi)
```

```{r}
# Visualisasi tren produksi kedelai
plot_predik_produksi <- ggplot(prediksi_garch_ubikayu
                             , aes(x = Tahun, y = avg_rainfall, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi ubikayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi ubikayu",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_tren_produksi)
```

### Evaluasi Model

```{r}
# Mengambil data produksi ubikayu selama 10 tahun terakhir
data_aktual_uk <- Sumatera_ubikayu[format(Sumatera_ubikayu$Tahun, "%Y") >= "2013", "Produksi"]
data_aktual_uk
```

```{r}
data_aktual_uk<- as.numeric(data_aktual_uk$Produksi)
```

```{r}
prediksi_produksi_uk <- as.numeric(prediksi_garch_ubikayu$Produksi)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_uk <- sqrt(mean((data_aktual_uk - prediksi_produksi_uk)^2))
mape_garch_uk <- mean(abs((data_aktual_uk - prediksi_produksi_uk) / data_aktual_uk) * 100)
mae_garch_uk <- mean(abs(data_aktual_uk - prediksi_produksi_uk))
mse_garch_uk <- mean((data_aktual_uk - prediksi_produksi_uk)^2)

cat("MAPE from garch:", mape_garch_uk, "%\n")
cat("RMSE:", rmse_garch_uk, "\n")
cat("MAE:", mae_garch_uk, "\n")
cat("MSE:", mse_garch_uk, "\n")
```

```{r}
# Mengambil data produktivitas ubikayu selama 10 tahun terakhir
data_aktual_ptj <- Sumatera_ubikayu[format(Sumatera_ubikayu$Tahun, "%Y") >= "2013", "Produktivitas"]
data_aktual_ptj
```

```{r}
data_aktual_ptj<- as.numeric(data_aktual_ptj$Produktivitas)
```

```{r}
prediksi_produksi_ptj <- as.numeric(prediksi_garch_ubikayu$Produktivitas)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_ptj <- sqrt(mean((data_aktual_ptj - prediksi_produksi_ptj)^2))
mape_garch_ptj <- mean(abs((data_aktual_ptj - prediksi_produksi_ptj) / data_aktual_ptj) * 100)
mae_garch_ptj <- mean(abs(data_aktual_ptj - prediksi_produksi_ptj))
mse_garch_ptj <- mean((data_aktual_ptj - prediksi_produksi_ptj)^2)

cat("MAPE from garch:", mape_garch_ptj, "%\n")
cat("RMSE:", rmse_garch_ptj, "\n")
cat("MAE:", mae_garch_ptj, "\n")
cat("MSE:", mse_garch_ptj, "\n")
```
```{r}
# Mengambil data avg rainfall ubikayu selama 10 tahun terakhir
data_aktual_rainfal <- Sumatera_ubikayu[format(Sumatera_ubikayu$Tahun, "%Y") >= "2013", "avg_rainfall"]
data_aktual_rainfal
```

```{r}
data_aktual_rainfal<- as.numeric(data_aktual_rainfal$avg_rainfall)
```

```{r}
prediksi_produksi_rainfal <- as.numeric(prediksi_garch_ubikayu$Avg_Rainfall)
```

```{r}
# Menghitung nilai RMSE, MAPE, MAE, dan MSE
rmse_garch_rainfall <- sqrt(mean((data_aktual_uk - prediksi_produksi_uk)^2))
mape_garch_rainfall <- mean(abs((data_aktual_uk - prediksi_produksi_uk) / data_aktual_uk) * 100)
mae_garch_rainfall <- mean(abs(data_aktual_uk - prediksi_produksi_uk))
mse_garch_rainfall <- mean((data_aktual_kedelai - prediksi_produksi_uk)^2)

cat("MAPE from garch:", mape_garch_rainfall, "%\n")
cat("RMSE:", rmse_garch_rainfall, "\n")
cat("MAE:", mae_garch_rainfall, "\n")
cat("MSE:", mse_garch_rainfall, "\n")
```


#4. Model VAR terhadap Palawija Sumatera Utara

```{r}
sumut_palawija <- Palawija_CLEAN %>%
  filter(Provinsi == "SUMATERA UTARA")
sumut_palawija
```

##1. Jagung palawija SUMUT

```{r}
# Filter data Palawija "Jagung" berdasarkan jenis komonditi
jagung_palawija<- sumut_palawija %>%
  filter(Jenis_Komoditi == "Jagung")
jagung_palawija
```

## VAR terhadap Jagung Sumatera Utara

```{r}
# Pilih variabel yang akan diprediksi

data_var_jagung_sumut <- jagung_palawija[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_jagung_sumut
```

Untuk mendukung prediksi dengan Model VAR, data harus dirubah kedalam format time series (ts)

```{r}
#Format time series
ts_data_jagung_sumut<- ts(data_var_jagung_sumut, start = c(2000,1), frequency = 1)
ts_data_jagung_sumut
```

```{r}
best_lag_jagung_sumut<- VARselect(ts_data_jagung_sumut, lag.max = 5, type = "both")
best_lag_jagung_sumut
```

### VAR Model terhadap produksi Jagung Sumatera

```{r}

var_model_jagung_sumut <- VAR(ts_data_jagung_sumut, p = best_lag_jagung_sumut$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_jagung_sumut)
```

Estimation results for equation produktivitas: avg_rainfall.l1 -1.371e+00 2.921e-01 -4.693 0.001555 \*\* avg_rainfall.l3 6.605e-01 2.427e-01 2.722 0.026188 \* Produksi.l4 4.916e-06 2.039e-06 2.411 0.042429 \* F-statistik p-value:6.623e-10

### Uji Kolersi Pearson Jagung

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_jagung_sumut1 <- cor(data_var_jagung_sumut$Produksi, data_var_jagung_sumut$avg_rainfall)
cat ("Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi:",kolerasi_jagung_sumut1)
```

Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi: 0.3372069

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_jagung_sumut2 <- cor(data_var_jagung_sumut$avg_rainfall, data_var_jagung_sumut$Produktivitas)
cat ("Koefisien Korelasi Pearson Rata-rata curah hujan dan produksi:", kolerasi_jagung_sumut2)
```

Koefisien Korelasi Pearson Rata-rata curah hujan dan produksi: 0.34

### Uji Granger Causality Jagung

```{r}
# Melakukan uji Granger Causality 
granger_jagung_sumut1 <- causality(var_model_jagung_sumut, cause = "avg_rainfall")
granger_jagung_sumut1

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger p-value = 0.0005302 Instant p-value = 0.49 terdapat bukti signifikan sebab akibat avg-rainfall terhadap produksi dan produksivitas dalam jangkah panjang tetapi tidak di jangka instant

```{r}
# Melakukan uji Granger Causality 
granger_jagung_sumut2 <- causality(var_model_jagung_sumut, cause = "Produksi")
granger_jagung_sumut2

```

Granger p-value =1.346e-09 dan Instant p-value 0.6807 terdapat bukti signifikan sebab akibat produksi terhadap avg_rainfall dan produksivitas jangkah panjang dan tidak jangka instant

### Uji regresi linier Jagung

```{r}
# Membuat model regresi linier
regresi_jagung_1 <- lm(Produktivitas ~ avg_rainfall, data = data_var_jagung_sumut)

# Ringkasan hasil model
summary(regresi_jagung_1)
```

```         
         Estimate Std. Error t value Pr(>|t|)   
```

(Intercept) 49.338 27.533 1.792 0.0742 . avg_rainfall 9.460 3.536 2.676 0.0079 \*\*

```{r}
# Membuat model regresi linier
regresi_jagung_2 <- lm(Produksi ~ avg_rainfall, data = data_var_jagung_sumut)

# Ringkasan hasil model
summary(regresi_jagung_2)
```

Estimate Std. Error t value Pr(\>\|t\|)\
(Intercept) 12092 17239 0.701 0.4836\
avg_rainfall 3771 2214 1.703 0.0896 .

# Interpretasi Jagung SUMUT

Berdasarkan Model VAR, regresi dan uji grager dan isntants. Curah hujan berdampak terhadap produktivitas jagung sumut dan tidak berdampak pada produksi jagunng sumut.

### Membuat Prediksi Jagung SUMUT dengan Model VAR

```{r}
# Prediksi 10 periode ke depan
forecast_ubikayu <- predict(var_model_ubikayu_Sumatera, n.ahead = 10)
forecast_ubikayu
```

```{r}
# Mengambil hanya kolom "fcst" dari setiap variabel
forecast_results_ubikayu <- lapply(forecast_ubikayu$fcst, function(x) x[, "fcst"])

# Menampilkan hasil
print(forecast_results_ubikayu)
```

```{r}
# Membuat data frame untuk hasil prediksi
predicted_data_ubikayu <- as.data.frame(forecast_results_ubikayu)
predicted_data_ubikayu
```

```{r}
# Menambahkan variabel tahun 2023 sampai 2033
predicted_data_ubikayu$Tahun <- seq(2023, 2032)
predicted_data_ubikayu
```

```{r}
# Visualisasi tren produksi Ubi kayu
plot_produksi_ubikayu <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = Produksi, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi Ubi kayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi Ubi kayu",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_produksi_ubikayu)
```

```{r}
# Visualisasi tren produksi Ubi kayu
plot_produktivitas_ubikayu <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = Produktivitas, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produktivitas Ubi kayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produktivitas Jagung",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_produktivitas_ubikayu)
```

```{r}
# Visualisasi tren Curah hujan Sumatera
plot_avgrainfall_uk <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = avg_rainfall, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi curah hujan Sumatera (2023-2033)",
       x = "Tahun",
       y = "Rata-rata curah hujan ",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_avgrainfall_uk)
```

##2. Kacang kedelai palawija SUMUT

```{r}
# Filter data Palawija "kacang kedelai" berdasarkan jenis komonditi
kedelai_palawija<-sumut_palawija %>%
  filter(Jenis_Komoditi == "Kedelai")
kedelai_palawija
```

## VAR terhadap Kedelai Sumatera Utara

```{r}
# Pilih variabel yang akan diprediksi

data_var_kedelai_sumut <- kedelai_palawija[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_kedelai_sumut
```

Untuk mendukung prediksi dengan Model VAR, data harus dirubah kedalam format time series (ts)

```{r}
#Format time series
ts_data_kedelai_sumut<- ts(data_var_kedelai_sumut, start = c(2000,1), frequency = 1)
ts_data_kedelai_sumut
```

```{r}
best_lag_kedelai_sumut<- VARselect(ts_data_kedelai_sumut, lag.max = 5, type = "both")
best_lag_kedelai_sumut
```

### VAR Model terhadap produksi Kedelai Sumatera

```{r}

var_model_kedelai_sumut <- VAR(ts_data_kedelai_sumut, p = best_lag_kedelai_sumut$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_kedelai_sumut)
```

Estimation results for equation produktivitas:

### Uji Kolersi Pearson Kedelai

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_kedelai_sumut1 <- cor(data_var_kedelai_sumut$Produksi, data_var_kedelai_sumut$avg_rainfall)
cat ("Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi:",kolerasi_kedelai_sumut1)
```

Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi: -0.457278

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_kedelai_sumut2 <- cor(data_var_kedelai_sumut$avg_rainfall, data_var_kedelai_sumut$Produktivitas)
cat ("Koefisien Korelasi Pearson Rata-rata curah hujan dan produksi:", kolerasi_kedelai_sumut2)
```

Koefisien Korelasi Pearson Rata-rata curah hujan dan produksi: 0.1026

### Uji Granger Causality Kedelai

```{r}
# Melakukan uji Granger Causality 
granger_kedelai_sumut1 <- causality(var_model_kedelai_sumut, cause = "avg_rainfall")
granger_kedelai_sumut1

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger p-value = 0.419 Instant p-value = 0.1069 terdapat bukti signifikan sebab akibat avg-rainfall tidak terhadap pada produksi dan produksivitas dalam jangkah panjang dan jangka instant

```{r}
# Melakukan uji Granger Causality 
granger_kedelai_sumut2 <- causality(var_model_kedelai_sumut, cause = "Produksi")
granger_kedelai_sumut2

```

Granger p-value =0.7341 dan Instant p-value 0.1094 tidak terdapat bukti signifikan sebab akibat produksi terhadap avg_rainfall dan produksivitas jangkah panjang dan jangka instant

### Uji regresi linier Kedelai

```{r}
# Membuat model regresi linier
regresi_kedelai_1 <- lm(Produktivitas ~ avg_rainfall, data = data_var_kedelai_sumut)

# Ringkasan hasil model
summary(regresi_kedelai_1)
```

Estimate Std. Error t value Pr(\>\|t\|)\
(Intercept) 9.6869 3.4544 2.804 0.00906 \*\* avg_rainfall 0.2407 0.4407 0.546 0.58929

```{r}
# Membuat model regresi linier
regresi_kedelai_2 <- lm(Produksi ~ avg_rainfall, data = data_var_kedelai_sumut)

# Ringkasan hasil model
summary(regresi_kedelai_2)
```

Estimate Std. Error t value Pr(\>\|t\|)\
(Intercept) 82440 24214 3.405 0.00202 \*\* avg_rainfall -8405 3089 -2.721 0.01107 \*

# Interpretasi kedelai SUMUT

Berdasarkan Model VAR, regresi dan uji grager dan isntants. Curah hujan berdampak terhadap tidak berdampak terhadap produktivitas kedelai sumut dan tidak berdampak pada produksi kedelai sumut.

### Membuat Prediksi Kacang Kedelai SUMUT dengan Model VAR

```{r}
# Prediksi 10 periode ke depan
forecast_ubikayu <- predict(var_model_ubikayu_Sumatera, n.ahead = 10)
forecast_ubikayu
```

```{r}
# Mengambil hanya kolom "fcst" dari setiap variabel
forecast_results_ubikayu <- lapply(forecast_ubikayu$fcst, function(x) x[, "fcst"])

# Menampilkan hasil
print(forecast_results_ubikayu)
```

```{r}
# Membuat data frame untuk hasil prediksi
predicted_data_ubikayu <- as.data.frame(forecast_results_ubikayu)
predicted_data_ubikayu
```

```{r}
# Menambahkan variabel tahun 2023 sampai 2033
predicted_data_ubikayu$Tahun <- seq(2023, 2032)
predicted_data_ubikayu
```

```{r}
# Visualisasi tren produksi Ubi kayu
plot_produksi_ubikayu <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = Produksi, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi Ubi kayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi Ubi kayu",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_produksi_ubikayu)
```

```{r}
# Visualisasi tren produksi Ubi kayu
plot_produktivitas_ubikayu <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = Produktivitas, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produktivitas Ubi kayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produktivitas Jagung",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_produktivitas_ubikayu)
```

```{r}
# Visualisasi tren Curah hujan Sumatera
plot_avgrainfall_uk <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = avg_rainfall, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi curah hujan Sumatera (2023-2033)",
       x = "Tahun",
       y = "Rata-rata curah hujan ",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_avgrainfall_uk)
```

##3. Kacang hijau palawija SUMUT

```{r}
# Filter data Palawija "Kacang Hijau" berdasarkan jenis komonditi
kacanghijau_palawija<- sumut_palawija %>%
  filter(Jenis_Komoditi == "Kacang Hijau")
kacanghijau_palawija
```

## VAR terhadap Kacang Hijau Sumatera Utara

```{r}
# Pilih variabel yang akan diprediksi

data_var_kacanghijau_sumut <- kacanghijau_palawija[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_kacanghijau_sumut
```

Untuk mendukung prediksi dengan Model VAR, data harus dirubah kedalam format time series (ts)

```{r}
#Format time series
ts_data_kacanghijau_sumut<- ts(data_var_kacanghijau_sumut, start = c(2000,1), frequency = 1)
ts_data_kacanghijau_sumut
```

```{r}
best_lag_kacanghijau_sumut<- VARselect(ts_data_kacanghijau_sumut, lag.max = 5, type = "both")
best_lag_kacanghijau_sumut
```

### VAR Model terhadap produksi kacanghijau Sumatera

```{r}

var_model_kacanghijau_sumut <- VAR(ts_data_kacanghijau_sumut, p = best_lag_kacanghijau_sumut$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_kacanghijau_sumut)
```

Estimation results for equation produktivitas: avg_rainfall.l1 -3.933e+00 1.329e+00 -2.959 0.0416 \* F-statistik p-value:0.03056

### Uji Kolersi Pearson kacanghijau

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_kacanghijau_sumut1 <- cor(data_var_kacanghijau_sumut$Produksi, data_var_kacanghijau_sumut$avg_rainfall)
cat ("Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi:",kolerasi_kacanghijau_sumut1)
```

Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi: 0.325

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_kacanghijau_sumut2 <- cor(data_var_kacanghijau_sumut$avg_rainfall, data_var_kacanghijau_sumut$Produktivitas)
cat ("Koefisien Korelasi Pearson Rata-rata curah hujan dan produksi:", kolerasi_kacanghijau_sumut2)
```

Koefisien Korelasi Pearson Rata-rata curah hujan dan produksi: 0.27

### Uji Granger Causality kacanghijau

```{r}
# Melakukan uji Granger Causality 
granger_kacanghijau_sumut1 <- causality(var_model_kacanghijau_sumut, cause = "avg_rainfall")
granger_kacanghijau_sumut1

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger p-value = 0.01785 Instant p-value = 0.005492 terdapat bukti signifikan sebab akibat avg-rainfall terhadap produksi dan produksivitas dalam jangkah panjang dan di jangka instant

```{r}
# Melakukan uji Granger Causality 
granger_kacanghijau_sumut2 <- causality(var_model_kacanghijau_sumut, cause = "Produksi")
granger_kacanghijau_sumut2

```

Granger p-value =0.01102 dan Instant p-value 0.005521 terdapat bukti signifikan sebab akibat produksi terhadap avg_rainfall dan produksivitas jangkah panjang dan dan jangka instant

### Uji regresi linier kacanghijau

```{r}
# Membuat model regresi linier
regresi_kacanghijau_1 <- lm(Produktivitas ~ avg_rainfall, data = data_var_kacanghijau_sumut)

# Ringkasan hasil model
summary(regresi_kacanghijau_1)
```

Estimate Std. Error t value Pr(\>\|t\|) (Intercept) 3.3811 4.6463 0.728 0.474 avg_rainfall 0.8274 0.5870 1.410 0.171

```{r}
# Membuat model regresi linier
regresi_kacanghijau_2 <- lm(Produksi ~ avg_rainfall, data = data_var_kacanghijau_sumut)

# Ringkasan hasil model
summary(regresi_kacanghijau_2)
```

Estimate Std. Error t value Pr(\>\|t\|)\
(Intercept) 16928.7 6779.7 2.497 0.0198 \* avg_rainfall -1446.0 856.5 -1.688 0.1043

# Interpretasi kacanghijau SUMUT

Berdasarkan Model VAR, regresi dan uji grager dan isntants. Curah hujan tidak berdampak terhadap produktivitas kacanghijau sumut dan tidak berdampak pada produksi kacang hijau sumut.

### Membuat Prediksi Kacang Hijau SUMUT dengan Model VAR

```{r}
# Prediksi 10 periode ke depan
forecast_ubikayu <- predict(var_model_ubikayu_Sumatera, n.ahead = 10)
forecast_ubikayu
```

```{r}
# Mengambil hanya kolom "fcst" dari setiap variabel
forecast_results_ubikayu <- lapply(forecast_ubikayu$fcst, function(x) x[, "fcst"])

# Menampilkan hasil
print(forecast_results_ubikayu)
```

```{r}
# Membuat data frame untuk hasil prediksi
predicted_data_ubikayu <- as.data.frame(forecast_results_ubikayu)
predicted_data_ubikayu
```

```{r}
# Menambahkan variabel tahun 2023 sampai 2033
predicted_data_ubikayu$Tahun <- seq(2023, 2032)
predicted_data_ubikayu
```

```{r}
# Visualisasi tren produksi Ubi kayu
plot_produksi_ubikayu <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = Produksi, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi Ubi kayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi Ubi kayu",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_produksi_ubikayu)
```

```{r}
# Visualisasi tren produksi Ubi kayu
plot_produktivitas_ubikayu <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = Produktivitas, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produktivitas Ubi kayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produktivitas Jagung",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_produktivitas_ubikayu)
```

```{r}
# Visualisasi tren Curah hujan Sumatera
plot_avgrainfall_uk <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = avg_rainfall, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi curah hujan Sumatera (2023-2033)",
       x = "Tahun",
       y = "Rata-rata curah hujan ",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_avgrainfall_uk)
```

##4. Kacang Tanah palawija SUMUT

```{r}
# Filter data Palawija "Jagung" berdasarkan jenis komonditi
kacangtanah_palawija<- sumut_palawija %>%
  filter(Jenis_Komoditi == "Kacang Tanah")
kacangtanah_palawija
```

## VAR terhadap Jagung Sumatera Utara

```{r}
# Pilih variabel yang akan diprediksi

data_var_kacangtanah_sumut <- kacangtanah_palawija[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_kacangtanah_sumut
```

Untuk mendukung prediksi dengan Model VAR, data harus dirubah kedalam format time series (ts)

```{r}
#Format time series
ts_data_kacangtanah_sumut<- ts(data_var_kacangtanah_sumut, start = c(2000,1), frequency = 1)
ts_data_kacangtanah_sumut
```

```{r}
best_lag_kacangtanah_sumut<- VARselect(ts_data_kacangtanah_sumut, lag.max = 5, type = "both")
best_lag_kacangtanah_sumut
```

### VAR Model terhadap produksi kacangtanah Sumatera

```{r}

var_model_kacangtanah_sumut <- VAR(ts_data_kacangtanah_sumut, p = best_lag_kacangtanah_sumut$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_kacangtanah_sumut)
```

### Uji Kolersi Pearson kacangtanah

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_kacangtanah_sumut1 <- cor(data_var_kacangtanah_sumut$Produksi, data_var_kacangtanah_sumut$avg_rainfall)
cat ("Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi:",kolerasi_kacangtanah_sumut1)
```

Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi: -0.35

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_kacangtanah_sumut2 <- cor(data_var_kacangtanah_sumut$avg_rainfall, data_var_kacangtanah_sumut$Produktivitas)
cat ("Koefisien Korelasi Pearson Rata-rata curah hujan dan produksi:", kolerasi_kacangtanah_sumut2)
```

Koefisien Korelasi Pearson Rata-rata curah hujan dan produksi: 0.3416

### Uji Granger Causality kacangtanah

```{r}
# Melakukan uji Granger Causality 
granger_kacangtanah_sumut1 <- causality(var_model_kacangtanah_sumut, cause = "avg_rainfall")
granger_kacangtanah_sumut1

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger p-value = 0.4299 Instant p-value = 0.1633 tidak terdapat bukti signifikan sebab akibat avg-rainfall terhadap produksi dan produksivitas dalam jangkah panjang dan di jangka instant

```{r}
# Melakukan uji Granger Causality 
granger_kacangtanah_sumut2 <- causality(var_model_kacangtanah_sumut, cause = "Produksi")
granger_kacangtanah_sumut2

```

Granger p-value =0.8945 an Instant p-value 0.06302 tidak terdapat bukti signifikan sebab akibat produksi terhadap avg_rainfall dan produksivitas jangkah panjang dan tidak jangka instant

### Uji regresi linier kacangtanah

```{r}
# Membuat model regresi linier
regresi_kacangtanah_1 <- lm(Produktivitas ~ avg_rainfall, data = data_var_kacangtanah_sumut)

# Ringkasan hasil model
summary(regresi_kacangtanah_1)
```

```         
         Estimate Std. Error t value Pr(>|t|)    
```

(Intercept) 8.2549 1.5714 5.253 1.39e-05 \*\*\* avg_rainfall 0.3856 0.2005 1.923 0.0647

```{r}
# Membuat model regresi linier
regresi_kacangtanah_2 <- lm(Produksi ~ avg_rainfall, data = data_var_kacangtanah_sumut)

# Ringkasan hasil model
summary(regresi_kacangtanah_2)
```

Estimate Std. Error t value Pr(\>\|t\|)\
(Intercept) 47107 14712 3.202 0.00339 \*\* avg_rainfall -3830 1877 -2.040 0.05086 . .

# Interpretasi kacangtanah SUMUT

Berdasarkan Model VAR, regresi dan uji grager dan isntants. Curah hujan tidak berdampak terhadap produktivitas kacang tanah sumut dan tidak berdampak pada produksi kacang tanah sumut.

### Membuat Prediksi Kacang Tanah SUMUT dengan Model VAR

```{r}
# Prediksi 10 periode ke depan
forecast_ubikayu <- predict(var_model_ubikayu_Sumatera, n.ahead = 10)
forecast_ubikayu
```

```{r}
# Mengambil hanya kolom "fcst" dari setiap variabel
forecast_results_ubikayu <- lapply(forecast_ubikayu$fcst, function(x) x[, "fcst"])

# Menampilkan hasil
print(forecast_results_ubikayu)
```

```{r}
# Membuat data frame untuk hasil prediksi
predicted_data_ubikayu <- as.data.frame(forecast_results_ubikayu)
predicted_data_ubikayu
```

```{r}
# Menambahkan variabel tahun 2023 sampai 2033
predicted_data_ubikayu$Tahun <- seq(2023, 2032)
predicted_data_ubikayu
```

```{r}
# Visualisasi tren produksi Ubi kayu
plot_produksi_ubikayu <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = Produksi, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi Ubi kayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi Ubi kayu",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_produksi_ubikayu)
```

```{r}
# Visualisasi tren produksi Ubi kayu
plot_produktivitas_ubikayu <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = Produktivitas, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produktivitas Ubi kayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produktivitas Jagung",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_produktivitas_ubikayu)
```

```{r}
# Visualisasi tren Curah hujan Sumatera
plot_avgrainfall_uk <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = avg_rainfall, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi curah hujan Sumatera (2023-2033)",
       x = "Tahun",
       y = "Rata-rata curah hujan ",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_avgrainfall_uk)
```

##5. Ubi Jalar palawija SUMUT

```{r}
# Filter data Palawija "Jagung" berdasarkan jenis komonditi
Ubijalar_palawija<- sumut_palawija %>%
  filter(Jenis_Komoditi == "Ubi Jalar")
Ubijalar_palawija
```

##VAR terhadap Ubi Jalar Sumatera Utara

```{r}
# Pilih variabel yang akan diprediksi

data_var_ubijalar_sumut <- Ubijalar_palawija[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_ubijalar_sumut
```

Untuk mendukung prediksi dengan Model VAR, data harus dirubah kedalam format time series (ts)

```{r}
#Format time series
ts_data_ubijalar_sumut<- ts(data_var_ubijalar_sumut, start = c(1993,1), frequency = 1)
ts_data_ubijalar_sumut
```

```{r}
best_lag_ubijalar_sumut<- VARselect(ts_data_ubijalar_sumut, lag.max = 5, type = "both")
best_lag_ubijalar_sumut
```

### VAR Model terhadap produksi Ubi Jalar Sumatera

```{r}

var_model_ubijalar_sumut <- VAR(ts_data_ubijalar_sumut, p = best_lag_ubijalar_sumut$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_ubijalar_sumut)
```

### Uji Kolersi Pearson Ubi Jalar

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_ubijalar_sumut1 <- cor(data_var_ubijalar_sumut$Produksi, data_var_ubijalar_sumut$avg_rainfall)
cat ("Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi:",kolerasi_ubijalar_sumut1)
```

Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi: 0.25

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_ubijalar_sumut2 <- cor(data_var_ubijalar_sumut$avg_rainfall, data_var_ubijalar_sumut$Produktivitas)
cat ("Koefisien Korelasi Pearson Rata-rata curah hujan dan produksi:", kolerasi_ubijalar_sumut2)
```

Koefisien Korelasi Pearson Rata-rata curah hujan dan produksi: 0.23

### Uji Granger Causality ubi jalar

```{r}
# Melakukan uji Granger Causality 
granger_ubijalar_sumut1 <- causality(var_model_ubijalar_sumut, cause = "avg_rainfall")
granger_ubijalar_sumut1

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger p-value = 0.2464 Instant p-value = 0.2937 tidak terdapat bukti signifikan sebab akibat avg-rainfall terhadap produksi dan produksivitas dalam jangkah panjang dan tidak di jangka instant

```{r}
# Melakukan uji Granger Causality 
granger_ubijalar_sumut2 <- causality(var_model_ubijalar_sumut, cause = "Produksi")
granger_ubijalar_sumut2

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger p-value =0.602 an Instant p-value 0.3156 tidak terdapat bukti signifikan sebab akibat produksi terhadap avg_rainfall dan produksivitas baik jangkah panjang dan di jangka instant

### Uji regresi linier Ubi jalar

```{r}
# Membuat model regresi linier
regresi_ubijalar_1 <- lm(Produktivitas ~ avg_rainfall, data = data_var_ubijalar_sumut)

# Ringkasan hasil model
summary(regresi_ubijalar_1)
```

```{r}
# Membuat model regresi linier
regresi_ubijalar_2 <- lm(Produksi ~ avg_rainfall, data = data_var_ubijalar_sumut)

# Ringkasan hasil model
summary(regresi_ubijalar_2)
```

### Membuat Prediksi Ubi Jalar SUMUT dengan Model VAR

```{r}
# Prediksi 10 periode ke depan
forecast_ubikayu <- predict(var_model_ubikayu_Sumatera, n.ahead = 10)
forecast_ubikayu
```

```{r}
# Mengambil hanya kolom "fcst" dari setiap variabel
forecast_results_ubikayu <- lapply(forecast_ubikayu$fcst, function(x) x[, "fcst"])

# Menampilkan hasil
print(forecast_results_ubikayu)
```

```{r}
# Membuat data frame untuk hasil prediksi
predicted_data_ubikayu <- as.data.frame(forecast_results_ubikayu)
predicted_data_ubikayu
```

```{r}
# Menambahkan variabel tahun 2023 sampai 2033
predicted_data_ubikayu$Tahun <- seq(2023, 2032)
predicted_data_ubikayu
```

```{r}
# Visualisasi tren produksi Ubi kayu
plot_produksi_ubikayu <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = Produksi, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi Ubi kayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi Ubi kayu",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_produksi_ubikayu)
```

```{r}
# Visualisasi tren produksi Ubi kayu
plot_produktivitas_ubikayu <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = Produktivitas, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produktivitas Ubi kayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produktivitas Jagung",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_produktivitas_ubikayu)
```

```{r}
# Visualisasi tren Curah hujan Sumatera
plot_avgrainfall_uk <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = avg_rainfall, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi curah hujan Sumatera (2023-2033)",
       x = "Tahun",
       y = "Rata-rata curah hujan ",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_avgrainfall_uk)
```

##6. Ubi kayu palawija SUMUT

```{r}
# Filter data Palawija "Jagung" berdasarkan jenis komonditi
ubikayu_palawija<- sumut_palawija %>%
  filter(Jenis_Komoditi == "Ubi Kayu")
ubikayu_palawija
```

## VAR terhadap ubi kayu Sumatera Utara

```{r}
# Pilih variabel yang akan diprediksi

data_var_ubikayu_sumut <- ubikayu_palawija[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_ubikayu_sumut
```

Untuk mendukung prediksi dengan Model VAR, data harus dirubah kedalam format time series (ts)

```{r}
#Format time series
ts_data_ubikayu_sumut<- ts(data_var_ubikayu_sumut, start = c(2000,1), frequency = 1)
ts_data_ubikayu_sumut
```

```{r}
best_lag_ubikayu_sumut<- VARselect(ts_data_ubikayu_sumut, lag.max = 5, type = "both")
best_lag_ubikayu_sumut
```

### VAR Model terhadap produksi ubikayu Sumatera

```{r}

var_model_ubikayu_sumut <- VAR(ts_data_ubikayu_sumut, p = best_lag_ubikayu_sumut$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_ubikayu_sumut)
```

Estimation results for equation produktivitas: avg_rainfall.l1 -1.371e+00 2.921e-01 -4.693 0.001555 \*\* avg_rainfall.l3 6.605e-01 2.427e-01 2.722 0.026188 \* F-statistik p-value:6.623e-10

### Uji Kolersi Pearson ubikayu

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_ubikayu_sumut1 <- cor(data_var_ubikayu_sumut$Produksi, data_var_ubikayu_sumut$avg_rainfall)
cat ("Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi:",kolerasi_ubikayu_sumut1)
```

Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi: 0.22

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_ubikayu_sumut2 <- cor(data_var_ubikayu_sumut$avg_rainfall, data_var_ubikayu_sumut$Produktivitas)
cat ("Koefisien Korelasi Pearson Rata-rata curah hujan dan produksi:", kolerasi_ubikayu_sumut2)
```

Koefisien Korelasi Pearson Rata-rata curah hujan dan produksi: 0.25

### Uji Granger Causality ubikayu

```{r}
# Melakukan uji Granger Causality 
granger_ubikayu_sumut1 <- causality(var_model_ubikayu_sumut, cause = "avg_rainfall")
granger_ubikayu_sumut1

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```

Granger p-value = 0.90 Instant p-value = 0.021 terdapat bukti signifikan sebab akibat avg-rainfall tidak terhadap produksi dan produksivitas dalam jangkah panjang tetapi signiifkan sebab- akibat di jangka instant

```{r}
# Melakukan uji Granger Causality 
granger_ubikayu_sumut2 <- causality(var_model_ubikayu_sumut, cause = "Produksi")
granger_ubikayu_sumut2

```

Granger p-value =0.8724 dan Instant p-value 0.00417 terdapat bukti signifikan sebab akibat avg-rainfall tidak terhadap produksi dan produksivitas dalam jangkah panjang tetapi signiifkan sebab- akibat di jangka instant

### Uji regresi linier ubikayu

```{r}
# Membuat model regresi linier
regresi_ubikayu_1 <- lm(Produktivitas ~ avg_rainfall, data = data_var_ubikayu_sumut)

# Ringkasan hasil model
summary(regresi_ubikayu_1)
```

```         
         stimate Std. Error t value Pr(>|t|)
```

(Intercept) -31.74 190.21 -0.167 0.869 avg_rainfall 33.31 24.27 1.372 0.181

```{r}
# Membuat model regresi linier
regresi_ubikayu_2 <- lm(Produksi ~ avg_rainfall, data = data_var_ubikayu_sumut)

# Ringkasan hasil model
summary(regresi_ubikayu_2)
```

Estimate Std. Error t value Pr(\>\|t\|) (Intercept) 39232 617773 0.064 0.950 avg_rainfall 94365 78817 1.197 0.241 \# Interpretasi ubikayu SUMUT Berdasarkan Model VAR, regresi dan uji grager dan isntants. Curah hujan tidak berdampak terhadap produktivitas ubikayu sumut dan tidak berdampak pada produksi Ubi Kayu sumut.

#Interpretasi UMUM Berdasarkan proses analsiis model VAR pada setip palawija di provinsi sumatera utara dapat di ambil kesimpulan bahwa *Avg_rainfal hanya berdampak* terhadap Produktivitas jagung.Dan curah hujan *tidak berdampak* terhadap produksi jagung Sumut, Produksi dan produktivitas ubi jalar, Produksi dan produktivitas ubi kayu, Produksi dan produktivitas kacang kedelai, Produksi dan produktivitas kacang tanah dan Produksi dan produktivitas kacang Hijau.

### Membuat Prediksi Ubi kayu SUMUT dengan Model VAR

```{r}
# Prediksi 10 periode ke depan
forecast_ubikayu <- predict(var_model_ubikayu_Sumatera, n.ahead = 10)
forecast_ubikayu
```

```{r}
# Mengambil hanya kolom "fcst" dari setiap variabel
forecast_results_ubikayu <- lapply(forecast_ubikayu$fcst, function(x) x[, "fcst"])

# Menampilkan hasil
print(forecast_results_ubikayu)
```

```{r}
# Membuat data frame untuk hasil prediksi
predicted_data_ubikayu <- as.data.frame(forecast_results_ubikayu)
predicted_data_ubikayu
```

```{r}
# Menambahkan variabel tahun 2023 sampai 2033
predicted_data_ubikayu$Tahun <- seq(2023, 2032)
predicted_data_ubikayu
```

```{r}
# Visualisasi tren produksi Ubi kayu
plot_produksi_ubikayu <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = Produksi, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produksi Ubi kayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produksi Ubi kayu",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_produksi_ubikayu)
```

```{r}
# Visualisasi tren produksi Ubi kayu
plot_produktivitas_ubikayu <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = Produktivitas, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi Tren Produktivitas Ubi kayu Sumatera (2023-2033)",
       x = "Tahun",
       y = "Produktivitas Jagung",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_produktivitas_ubikayu)
```

```{r}
# Visualisasi tren Curah hujan Sumatera
plot_avgrainfall_uk <- ggplot(predicted_data_ubikayu, aes(x = Tahun, y = avg_rainfall, color = "Prediksi")) +
  geom_line() +
  geom_point() +
  labs(title = "Prediksi curah hujan Sumatera (2023-2033)",
       x = "Tahun",
       y = "Rata-rata curah hujan ",
       color = "Metode Prediksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")

# Menampilkan plot
print(plot_avgrainfall_uk)
```

```{r}
# Membuat prediksi dengan model VAR
predictions_jagung_Sumatera <- predict(var_model_jagung_Sumatera, n.ahead = 10)
predictions_jagung_Sumatera
```

