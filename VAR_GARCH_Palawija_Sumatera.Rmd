---
title: "Analisis dampak curah hujan pada produksi Palawija Sumatera dengan VAR dan GARCH"
author: "Fitria"
date: "2023-11-09"
output: pdf_document
---

# Memangil Library

```{r}
library(dplyr)
library(ggplot2)
library(lubridate)
library(summarytools)
library(readxl)
library(cluster)
library(scales)
library(vars)
library(rugarch)
library(caTools)
library(fGarch)
library(tseries)
library(tidyverse)
library(Metrics)
library(caret)
library(tsutils)
library(forecast) 
library(stats) 
library(MASS)
library(nortest)
library(forecast)
```

# 1. Load dataset Palawija Sumatera 1993-2022

```{r}
Sumatera_palawija <- read_excel("D:/OneDrive - mikroskil.ac.id/Skripsi/dataset penelitian/CURAH HUJAN dan Palawija SUMATERA 1993-2022.xlsx")
Sumatera_palawija
```

```{r}
#Merubah type data dari cdouble menjadi numeric agar mudah di operasikan
Sumatera_palawija$Produksi<-as.numeric(Sumatera_palawija$Produksi)
Sumatera_palawija$Produktivitas<-as.numeric(Sumatera_palawija$Produktivitas)
Sumatera_palawija$Luas_Panen<-as.numeric(Sumatera_palawija$Luas_Panen)
Sumatera_palawija$avg_rainfall<-as.numeric(Sumatera_palawija$avg_rainfall)
Sumatera_palawija
```

```{r}
#merubah type data tahun dari double menjadi date
Sumatera_palawija$Tahun<-make_date(Sumatera_palawija$Tahun)
Sumatera_palawija
```

```{r}
tail(Sumatera_palawija)
```

```{r}
head(Sumatera_palawija)
```

```{r}
# Menampikan variabel dengan baris kosong
colSums(is.na(Sumatera_palawija))
```

## Menghapus Data Kosong

```{r}
# Menghapus data NA's
Palawija_CLEAN <- na.omit(Sumatera_palawija)
summary(Palawija_CLEAN)
```

```{r}
#menampilkan kembali data yang kosong
colSums(is.na(Palawija_CLEAN))
```




## Eksplorasi Data Analisis (EDA)

### Jumlah Produksi Tanaman Palawija per Provinsi

```{r}
# Hitung total produksi semua tanaman palawija per provinsi di setiap tahun
totproduksi_palawija <- Palawija_CLEAN %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi)) %>%
  arrange(desc(total_produksi))

totproduksi_palawija
```

```{r}
# Hitung total produksi semua tanaman pangan per setiap provinsi dan di urutkan dari total produksi terbanyak
totproduksi_provinsi <- Palawija_CLEAN %>% 
  group_by(Provinsi) %>% 
  summarise(total_produksi = sum(Produksi))%>%
  arrange(desc(total_produksi))
  
totproduksi_provinsi
```

Total Produksi terbanyak ada di Provinsi Lampung sebanyak 205226881

```{r}
# Hitung total produksi semua tanaman pangan per setiap provinsi dan di urutkan dari total produksi terbanyak
totproduktivitas_provinsi <- Palawija_CLEAN %>% 
  group_by(Provinsi) %>% 
  summarise(total_produktivitas= sum(Produktivitas))%>%
  arrange(desc(total_produktivitas))
  
totproduktivitas_provinsi
```

### Tren Produksi Tanaman Palawija per Provinsi

```{r}
# Visualisasi Tren Produksi palawija per Provinsi di setiap tahun
plot_palawija1 <- ggplot(totproduksi_palawija, aes(x = Tahun, y = total_produksi, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Palawija Sumatera ", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_palawija1
```

```{r}

# Visualisasi dengan barplot
plot_palawija2 <- ggplot(totproduksi_provinsi, aes(x = Provinsi, y = total_produksi, fill = Provinsi)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Palawija antara Provinsi di Sumatera", x = "Provinsi", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_palawija2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Hitung total produksi semua tanaman palawija per provinsi di setiap tahun
totproduktivitas_palawija <- Palawija_CLEAN %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produktivitas = sum(Produktivitas)) %>%
  arrange(desc(total_produktivitas))

totproduktivitas_palawija
```

```{r}
# Visualisasi Tren Produksi palawija per Provinsi di setiap tahun
plot_palawija_produktivitas <- ggplot(totproduktivitas_palawija, aes(x = Tahun, y = total_produktivitas, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produktivitas Palawija Sumatera ", x = "Tahun", y = "Total Produktivitas") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_palawija_produktivitas
```

## Jagung

```{r}
# Filter data Palawija "Jagung" berdasarkan jenis komonditi
Sumatera_jagung<- Palawija_CLEAN %>%
  filter(Jenis_Komoditi == "Jagung")
Sumatera_jagung
```

## EDA Jagung

### Jumlah Produksi Jagung per Provinsi

```{r}
# Hitung total produksi Jagung per Provinsi di setiap tahun
totproduksi_jagung_palawija <-Sumatera_jagung %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi))

totproduksi_jagung_palawija
```

```{r}
# Hitung total produksi Jagung per setiap Provinsi
totproduksi_provinsi_Jagung <- Sumatera_jagung %>% 
  group_by(Provinsi) %>% 
  summarise(total_produksi = sum(Produksi))%>%
  arrange(desc(total_produksi))
  
totproduksi_provinsi_Jagung
```

### Tren Produksi Jagung per Provinsi

```{r}
# Visualisasi Tren Produksi tanaman pangan per Provinsi di setiap tahun
plot_Jagung_11 <- ggplot(totproduksi_jagung_palawija, aes(x = Tahun, y = total_produksi, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Jagung", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_Jagung_11
```

```{r}

# Visualisasi dengan barplot total produksi padi di setiap Provinsi
plot_Jagung_2<- ggplot(totproduksi_provinsi_Jagung, aes(x = Provinsi, y = total_produksi, fill = Provinsi)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Jagung antara Provinsi", x = "Provinsi", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_Jagung_2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Perbandingan produksi Jagung dalam kurun waktu 1993 - 2022 adalah dari Provinsi Lampung yang terbanyak dengan Jumlah Produksi 45986395 ton

## Kacang kedelai

```{r}
# Filter data Palawija "Kedelai" berdasarkan jenis komonditi
Sumatera_Kedelai<- Palawija_CLEAN %>%
  filter(Jenis_Komoditi == "Kedelai")
Sumatera_Kedelai
```

## EDA Kacang Kedelai

### Jumlah Produksi Kacang Kedelai per Provinsi

```{r}
# Hitung total produksi Kacang_Kedelai per Provinsi di setiap tahun
totproduksi_Kedelai <- Sumatera_Kedelai %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi))

totproduksi_Kedelai
```

```{r}
# Hitung total produksi Kacang Kedelai  per setiap Provinsi
totproduksi_provinsi_Kedelai <- Sumatera_Kedelai %>% 
  group_by(Provinsi) %>% 
  summarise(total_produksi = sum(Produksi))%>%
  arrange(desc(total_produksi))
  
totproduksi_provinsi_Kedelai
```

### Tren Produksi Kacang Kedelai per Provinsi

```{r}
# Visualisasi Tren Produksi Kacang Kedelai  per Provinsi di setiap tahun
plot_Kedelai_1 <- ggplot(totproduksi_Kedelai, aes(x = Tahun, y = total_produksi, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Kacang Kedelai ", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_Kedelai_1
```

```{r}

# Visualisasi dengan barplot total produksi Kacang Kedelai  di setiap Provinsi
plot_Kedelai_2<- ggplot(totproduksi_provinsi_Kedelai, aes(x = Provinsi, y = total_produksi, fill = Provinsi)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Kacang Kedelai  antara Provinsi", x = "Provinsi", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_Kedelai_2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Perbandingan produksi Kacang Kedelai dalam kurun waktu 1992 - 2022 adalah Provinsi Aceh yang terbanyak dengan Jumlah Produksi 1650031

## Kacang_hijau

```{r}
# Filter data Palawija "Kacang Hijau" berdasarkan jenis komonditi
Sumatera_kacang_hijau<- Palawija_CLEAN %>%
  filter(Jenis_Komoditi == "Kacang Hijau")
Sumatera_kacang_hijau
```

## EDA Kacang Hijau

### Jumlah Produksi Kacang Hijau per Provinsi

```{r}
# Hitung total produksi Kacang Hijau per Provinsi di setiap tahun
totproduksi_KacangHijau <- Sumatera_kacang_hijau %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi))

totproduksi_KacangHijau
```

```{r}
# Hitung total produksi Kacang Hijau per setiap Provinsi
totproduksi_provinsi_KacangHijau <- Sumatera_kacang_hijau %>% 
  group_by(Provinsi) %>% 
  summarise(total_produksi = sum(Produksi))%>%
  arrange(desc(total_produksi))
  
totproduksi_provinsi_KacangHijau
```

### Tren Produksi Kacang Hijau per Provinsi

```{r}
# Visualisasi Tren Produksi Kacang Hijau per Provinsi di setiap tahun
plot_KacangHijau_1 <- ggplot(totproduksi_KacangHijau, aes(x = Tahun, y = total_produksi, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Kacang Hijau", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_KacangHijau_1
```

```{r}

# Visualisasi dengan barplot total produksi Kacang Hijau di setiap Provinsi
plot_KacangHijau_2<- ggplot(totproduksi_provinsi_KacangHijau, aes(x = Provinsi, y = total_produksi, fill = Provinsi)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Kacang Hijau antara Provinsi", x = "Provinsi", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_KacangHijau_2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Perbandingan produksi Kacang Hijau dalam kurun waktu 1993 - 2022 adalah Sumatera Utara yang terbanyak dengan Jumlah Produksi 144423 Ton

## EDA Kacang Tanah

```{r}
# Filter data Palawija "Jagung" berdasarkan jenis komonditi
Sumatera_kacang_tanah<- Palawija_CLEAN %>%
  filter(Jenis_Komoditi == "Kacang Tanah")
Sumatera_kacang_tanah
```

### Jumlah Produksi Kacang Tanah per Provinsi

```{r}
# Hitung total produksi Kacang Tanah per Provinsi di setiap tahun
totproduksi_KacangTanah <- Sumatera_kacang_tanah %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi))

totproduksi_KacangTanah
```

```{r}
# Hitung total produksi Kacang Tanah per setiap Provinsi
totproduksi_provinsi_KacangTanah <- Sumatera_kacang_tanah %>% 
  group_by(Provinsi) %>% 
  summarise(total_produksi = sum(Produksi))%>%
  arrange(desc(total_produksi))
  
totproduksi_provinsi_KacangTanah
```

### Tren Produksi Kacang Tanah per Provinsi

```{r}
# Visualisasi Tren Produksi Kacang Tanah per Provinsi di setiap tahun
plot_KacangTanah_1 <- ggplot(totproduksi_KacangTanah, aes(x = Tahun, y = total_produksi, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Kacang Tanah", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_KacangTanah_1
```

```{r}

# Visualisasi dengan barplot total produksi Kacang Tanah di setiap Provinsi
plot_KacangTanah_2<- ggplot(totproduksi_provinsi_KacangTanah, aes(x = Provinsi, y = total_produksi, fill = Provinsi)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Kacang Tanah antara Provinsi", x = "Provinsi", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_KacangTanah_2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Perbandingan produksi Kacang Tanah dalam kurun waktu 1993 - 2022 adalah dari Sumatera Utara yang terbanyak dengan Jumlah Produksi 518192

## Ubi Jalar

```{r}
# Filter data Palawija "Jagung" berdasarkan jenis komonditi
Sumatera_ubi_jalar<- Palawija_CLEAN %>%
  filter(Jenis_Komoditi == "Ubi Jalar")
Sumatera_ubi_jalar
```

## EDA Ubi Jalar

### Jumlah Produksi Ubi Jalar per Provinsi

```{r}
# Hitung total produksi Ubi Jalar per Provinsi di setiap tahun
totproduksi_UbiJalar <- Sumatera_ubi_jalar %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi))

totproduksi_UbiJalar
```

```{r}
# Hitung total produksi padi per setiap Provinsi
totproduksi_provinsi_UbiJalar <- Sumatera_ubi_jalar %>% 
  group_by(Provinsi) %>% 
  summarise(total_produksi = sum(Produksi))%>%
  arrange(desc(total_produksi))
  
totproduksi_provinsi_UbiJalar
```

### Tren Produksi Ubi Jalar per Provinsi

```{r}
# Visualisasi Tren Produksi   Ubi Jalar per Provinsi di setiap tahun
plot_UbiJalar_1 <- ggplot(totproduksi_UbiJalar, aes(x = Tahun, y = total_produksi, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Ubi Jalar", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_UbiJalar_1
```

```{r}

# Visualisasi dengan barplot total produksi Ubi Jalar di setiap Provinsi
plot_UbiJalar_2<- ggplot(totproduksi_provinsi_UbiJalar, aes(x = Provinsi, y = total_produksi, fill = Provinsi)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Ubi Jalar antara Provinsi", x = "Provinsi", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_UbiJalar_2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Perbandingan produksi Ubi Jalar dalam kurun waktu 1993 - 2022 adalah dari Sumatera Utara yang terbanyak dengan Jumlah Produksi 3653240 Ton

## Ubi Kayu

```{r}
# Filter data Palawija "ubikayu" berdasarkan jenis komonditi
Sumatera_ubi_kayu<- Palawija_CLEAN %>%
  filter(Jenis_Komoditi == "Ubi Kayu")
Sumatera_ubi_kayu
```

## EDA Ubi Kayu

```{r}
# Turn off dplyr summarise() warning
options(dplyr.summarise.inform = FALSE)
```

### Jumlah Produksi Ubi Kayu per Provinsi

```{r}
# Hitung total produksi Ubi Kayu per Provinsi di setiap tahun
totproduksi_UbiKayu <- Sumatera_ubi_kayu %>% 
  group_by(Tahun, Provinsi, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi))

totproduksi_UbiKayu
```

```{r}
# Hitung total produksi Ubi Kayu per setiap Provinsi
totproduksi_provinsi_UbiKayu <- Sumatera_ubi_kayu %>% 
  group_by(Provinsi) %>% 
  summarise(total_produksi = sum(Produksi))%>%
  arrange(desc(total_produksi))
  
totproduksi_provinsi_UbiKayu
```

### Tren Produksi Ubi Kayu per Provinsi

```{r}
# Visualisasi Tren Ubi Kayu per Provinsi di setiap tahun
plot_UbiKayu_1 <- ggplot(totproduksi_UbiKayu, aes(x = Tahun, y = total_produksi, color = Provinsi)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Ubi Kayu ", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_UbiKayu_1
```

```{r}

# Visualisasi dengan barplot total produksi Ubi Kayu di setiap Provinsi
plot_UbiKayu_2<- ggplot(totproduksi_provinsi_UbiKayu, aes(x = Provinsi, y = total_produksi, fill = Provinsi)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Ubi Kayu antara Provinsi", x = "Provinsi", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_UbiKayu_2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Perbandingan produksi Ubi kayu dalam kurun waktu 1993 - 2022 adalah dari Lampung yang terbanyak dengan Jumlah Produksi 156729879 Ton

# 3. VAR tanaman palawija

# a. VAR terhadap jagung Sumatera

```{r}
# Pilih variabel yang akan diprediksi
data_var_jagung <- Sumatera_jagung[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_jagung
```

```{r}
# Tentukan ukuran data pelatihan (train) dan pengujian (test)
trainset_jagung <- floor(0.7 * nrow(data_var_jagung))  # 70% untuk pelatihan
testset_jagung <- nrow(data_var_jagung) - trainset_jagung   # 30% untuk pengujian
```

```{r}
# Pisahkan data menjadi train dan test berdasarkan urutan waktu
train_jagung <- data_var_jagung[1:trainset_jagung, ]
test_jagung <-data_var_jagung[(trainset_jagung + 1):nrow(data_var_jagung), ]
```


```{r}
#Format time series
ts_data_jagung_Sumatera <- ts(train_jagung, start = c(1993,1), frequency = 1)
```

```{r}
best_lag_jagung_Sumatera<- VARselect(ts_data_jagung_Sumatera, lag.max = 5, type = "both")
best_lag_jagung_Sumatera
```


```{r}
## estimasi model VAR
var_model_jagung_Sumatera <- VAR(ts_data_jagung_Sumatera, p = best_lag_jagung_Sumatera$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_jagung_Sumatera)
```


# B. Prediksi ARIMA - jagung
```{r}
# Extract residuals from VAR model
residuals_jagung <- residuals(var_model_jagung_Sumatera)
```


## 1. Prediksi Produksi  jagung

```{r}
# mengambil residual produksi jagung
residuals_Produksi_j <- residuals_jagung[, "Produksi"]
residuals_Produksi_j
```


```{r}
#untuk uji stationer
ts_residuals_Produksi_j <- ts(residuals_Produksi_j, start = c(1993, 1), frequency = 1)
```

```{r}
#uji stasioner
adf.test(ts_residuals_Produksi_j)
```
berdasarkan uji stationer bahwa variabel produksi sudah stationer

```{r}
acf(residuals_Produksi_j, main="ACF of Residuals produksi")
pacf(residuals_Produksi_j, main="PACF of Residuals Produksi")
```

```{r}
#order perbasarkan plot acf dan pacf
arima_order_ps_j <- c(5, 0, 5)
```


```{r}
# Estimate ARIMA model
arima_model_ps_jagung <- Arima(residuals_Produksi_j, order = arima_order_ps_j)
summary(arima_model_ps_jagung)
```


```{r}
# Check residuals of ARIMA model
checkresiduals(arima_model_ps_jagung)
```

```{r}
# Prediksi menggunakan model VAR untuk periode tes
var_forecast <- predict(var_model_jagung_Sumatera, n.ahead = 10)
```


```{r}
# Generate forecasts for the next 10 years
forecast_ps_jagung <- forecast(arima_model_ps_jagung, h = 10)
forecast_ps_jagung
```

```{r}
# Plot forecast
autoplot(forecast_ps_jagung) +
  labs(title = "Forecast of Corn Production in Sumatera (2023-2032)",
       subtitle = "Based on ARIMA model with VAR residuals")
```

```{r}
# Menyusun data untuk visualisasi dengan nama kolom yang sesuai
result_ps_jagung <- data.frame(Produksi_actual_j = test_jagung$Produksi[1:10], Produksi_pred_j = forecast_ps_jagung$mean[1:10])

# Plot perbandingan Produksi Jagung Aktual dengan Prediksi Model ARIMA
ggplot(data = result_ps_jagung, aes(x = Produksi_actual_j, y = Produksi_pred_j)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  labs(x = "Actual Produksi", y = "Predicted Produksi") +
  ggtitle("Perbandingan Produksi Jagung Aktual dengan Prediksi Model ARIMA") +
  theme_minimal()
```

```{r}
# Visualisasi Produksi Aktual dengan Hasil Prediksi
ggplot(data = result_ps_jagung, aes(x = 1:nrow(result_ps_jagung))) +
  geom_line(aes(y = Produksi_actual_j, color = "Actual"), size = 1) +
  geom_line(aes(y = Produksi_pred_j, color = "ARIMA Prediction"), size = 1) +
  labs(x = "Observation", y = "Produksi") +
  scale_color_manual(values = c("Actual" = "blue", "ARIMA Prediction" = "red")) +
  ggtitle("Produksi Jagung: Aktual vs Prediksi Model ARIMA") +
  theme_minimal()

```

### evaluasi model
```{r}
# Hitung MAE (Mean Absolute Error)
mae_ps_jagung <- mae(result_ps_jagung$Produksi_actual_j, result_ps_jagung$Produksi_pred_j)

# Hitung MSE (Mean Squared Error)
mse_ps_jagung <- mse(result_ps_jagung$Produksi_actual_j, result_ps_jagung$Produksi_pred_j)

# Hitung RMSE (Root Mean Square Error)
rmse_ps_jagung <- rmse(result_ps_jagung$Produksi_actual_j, result_ps_jagung$Produksi_pred_j)

# Hitung MAPE (Mean Absolute Percent Error)
mape_ps_jagung <- mape(result_ps_jagung$Produksi_actual_j, result_ps_jagung$Produksi_pred_j)

# Tampilkan hasil evaluasi
cat(paste("MAE Produksi jagung : ", mae_ps_jagung, "\n"))
cat(paste("MSE Produksi jagung : ", mse_ps_jagung, "\n"))
cat(paste("RMSE Produksi jagung : ", rmse_ps_jagung, "\n"))
cat(paste("MAPE Produksi jagung : ", mape_ps_jagung, "%\n"))
```
Output:

MAE Produksi jagung :  144013.91793377 
MSE Produksi jagung :  29550628357.0882 
RMSE Produksi jagung :  171902.962036982 
MAPE Produksi jagung :  1.08722189047866 %

```{r}
# Create data frame for forecasted production (2023-2032)
forecast_jagung_df_10y <- data.frame(Tahun = 2023:2032, Produksi = forecast_ps_jagung$mean)

# Display results
forecast_jagung_df_10y

```
Output:

Tahun   Produksi

2023	-64597.9844			
2024	-20844.3772			
2025	37252.6714			
2026	7974.5377			
2027	-30551.2710			
2028	452.2488			
2029	13743.1598			
2030	4671.0159			
2031	-10564.0206			
2032	-6966.1599


## 2. Prediksi Porduktivitas jagung

```{r}
# Extract residuals of Produktivitas (corn production)
residuals_Produktivitas_j <- residuals_jagung[, "Produktivitas"]
```


```{r}
#untuk uji stationer
ts_residuals_Produktivitas_j <- ts(residuals_Produktivitas_j, start = c(1993, 1), frequency = 1)
```

```{r}
#uji stasioner
adf.test(ts_residuals_Produktivitas_j)
```

```{r}
acf(residuals_Produktivitas_j, main="ACF of Residuals Produktivitas")
pacf(residuals_Produktivitas_j, main="PACF of Residuals Produktivitas")
```

```{r}
arima_order_pt_j <- c(4, 0, 4)
```



```{r}
# Estimate ARIMA model
arima_model_pt_jagung <- Arima(residuals_Produktivitas_j, order = arima_order_pt_j)
```


```{r}
# Check residuals of ARIMA model
checkresiduals(arima_model_pt_jagung)
```

```{r}
# Generate forecasts for the next 10 years
forecast_pt_jagung <- forecast(arima_model_pt_jagung, h = 10)
forecast_pt_jagung
```

```{r}
# Plot forecast
autoplot(forecast_pt_jagung) +
  labs(title = "Forecast of Corn Production in Sumatera (2023-2032)",
       subtitle = "Based on ARIMA model with VAR residuals")
```



```{r}
# Menyusun data untuk visualisasi dengan nama kolom yang sesuai
result_pt_jagung <- data.frame(Produktivitas_actual_j = test_jagung$Produktivitas[1:10], Produktivitas_pred_j = forecast_pt_jagung$mean[1:10])

# Plot perbandingan Produktivitas Jagung Aktual dengan Prediksi Model ARIMA
ggplot(data = result_pt_jagung, aes(x = Produktivitas_actual_j, y = Produktivitas_pred_j)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  labs(x = "Actual Produktivitas", y = "Predicted Produktivitas") +
  ggtitle("Perbandingan Produktivitas Jagung Aktual dengan Prediksi Model ARIMA") +
  theme_minimal()
```


```{r}
# Visualisasi Produktivitas Aktual dengan Hasil Prediksi
ggplot(data = result_pt_jagung, aes(x = 1:nrow(result_pt_jagung))) +
  geom_line(aes(y = Produktivitas_actual_j, color = "Actual"), size = 1) +
  geom_line(aes(y = Produktivitas_pred_j, color = "ARIMA Prediction"), size = 1) +
  labs(x = "Observation", y = "Produktivitas") +
  scale_color_manual(values = c("Actual" = "blue", "ARIMA Prediction" = "red")) +
  ggtitle("Produktivitas Jagung: Aktual vs Prediksi Model ARIMA") +
  theme_minimal()


```

### evaluasi model
```{r}
# Hitung MAE (Mean Absolute Error)
mae_pt_jagung <- mae(result_pt_jagung$Produktivitas_actual_j, result_pt_jagung$Produktivitas_pred_j)

# Hitung MSE (Mean Squared Error)
mse_pt_jagung <- mse(result_pt_jagung$Produktivitas_actual_j, result_pt_jagung$Produktivitas_pred_j)

# Hitung RMSE (Root Mean Square Error)
rmse_pt_jagung <- rmse(result_pt_jagung$Produktivitas_actual_j, result_pt_jagung$Produktivitas_pred_j)

# Hitung MAPE (Mean Absolute Percent Error)
mape_pt_jagung <- mape(result_pt_jagung$Produktivitas_actual_j, result_pt_jagung$Produktivitas_pred_j)

# Tampilkan hasil evaluasi
cat(paste("MAE Produktivitas jagung : ", mae_pt_jagung, "\n"))
cat(paste("MSE Produktivitas jagung : ", mse_pt_jagung, "\n"))
cat(paste("RMSE Produktivitas jagung : ", rmse_pt_jagung, "\n"))
cat(paste("MAPE Produktivitas jagung : ", mape_pt_jagung, "%\n"))
```
```{r}
# Create data frame for forecasted production (2023-2032)
forecast_jagung_df_10y <- data.frame(Tahun = 2023:2032, Produktivitas = forecast_pt_jagung$mean)

# Display results
forecast_jagung_df_10y

```


# C. VAR terhadap Kedelai Sumatera
```{r}
# Pilih variabel yang akan diprediksi

data_var_kedelai_Sumatera <- Sumatera_Kedelai[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_kedelai_Sumatera
```

```{r}
# Tentukan ukuran data pelatihan (train) dan pengujian (test)
trainset_Kedelai <- floor(0.7 * nrow(data_var_kedelai_Sumatera))  # 70% untuk pelatihan
testset_Kedelai <- nrow(data_var_kedelai_Sumatera) - trainset_Kedelai   # 30% untuk pengujian
```

```{r}
# Pisahkan data menjadi train dan test berdasarkan urutan waktu
train_Kedelai <- data_var_kedelai_Sumatera[1:trainset_Kedelai, ]
test_Kedelai <-data_var_kedelai_Sumatera[(trainset_Kedelai + 1):nrow(data_var_kedelai_Sumatera), ]
```

```{r}
#Format time series
ts_data_kedelai_Sumatera <- ts(train_Kedelai, start = c(1993,1), frequency = 1)
```

```{r}
best_lag_kedelai_Sumatera<- VARselect(ts_data_kedelai_Sumatera, lag.max = 5, type = "both")
best_lag_kedelai_Sumatera
```


```{r}
#Estimasi model VAR
var_model_kedelai_Sumatera <- VAR(ts_data_kedelai_Sumatera, p = best_lag_kedelai_Sumatera$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_kedelai_Sumatera)
```



# D. Prediksi ARIMA - Kedelai
```{r}
# Extract residuals from VAR model
residuals_Kedelai <- residuals(var_model_kedelai_Sumatera)
```


## 1. Prediksi Produksi  Kedelai
```{r}
# Extract residuals of Produksi (corn production)
residuals_Produksi_kk <- residuals_Kedelai[, "Produksi"]
```

```{r}
#untuk uji stationer
ts_residuals_Produksi_kk <- ts(residuals_Produksi_kk, start = c(1993, 1), frequency = 1)
```

```{r}
#uji stasioner
adf.test(ts_residuals_Produksi_kk)
```

```{r}
acf(residuals_Produksi_kk, main="ACF of Residuals produksi")
pacf(residuals_Produksi_kk, main="PACF of Residuals Produksi")
```

```{r}
arima_order_ps_kk <- c(3, 0, 3)
```


```{r}
# Estimate ARIMA model
arima_model_ps_Kedelai <- Arima(residuals_Produksi_kk, order = arima_order_ps_kk)
```


```{r}
# Check residuals of ARIMA model
checkresiduals(arima_model_ps_Kedelai)
```

```{r}
# Generate forecasts for the next 10 years
forecast_ps_Kedelai <- forecast(arima_model_ps_Kedelai, h = 10)
forecast_ps_Kedelai
```

```{r}
# Plot forecast
autoplot(forecast_ps_Kedelai) +
  labs(title = "Forecast of Corn Production in Sumatera (2023-2032)",
       subtitle = "Based on ARIMA model with VAR residuals")
```



```{r}
# Menyusun data untuk visualisasi dengan nama kolom yang sesuai
result_ps_Kedelai <- data.frame(Produksi_actual_kk = test_Kedelai$Produksi[1:10], Produksi_pred_kk = forecast_ps_Kedelai$mean[1:10])

# Plot perbandingan Produksi Kedelai Aktual dengan Prediksi Model ARIMA
ggplot(data = result_ps_Kedelai, aes(x = Produksi_actual_kk, y = Produksi_pred_kk)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  labs(x = "Actual Produksi", y = "Predicted Produksi") +
  ggtitle("Perbandingan Produksi Kedelai Aktual dengan Prediksi Model ARIMA") +
  theme_minimal()
```


```{r}
# Visualisasi Produksi Aktual dengan Hasil Prediksi
ggplot(data = result_ps_Kedelai, aes(x = 1:nrow(result_ps_Kedelai))) +
  geom_line(aes(y = Produksi_actual_kk, color = "Actual"), size = 1) +
  geom_line(aes(y = Produksi_pred_kk, color = "ARIMA Prediction"), size = 1) +
  labs(x = "Observation", y = "Produksi") +
  scale_color_manual(values = c("Actual" = "blue", "ARIMA Prediction" = "red")) +
  ggtitle("Produksi Kedelai: Aktual vs Prediksi Model ARIMA") +
  theme_minimal()


```

### evaluasi model
```{r}
# Hitung MAE (Mean Absolute Error)
mae_ps_Kedelai <- mae(result_ps_Kedelai$Produksi_actual_kk, result_ps_Kedelai$Produksi_pred_kk)

# Hitung MSE (Mean Squared Error)
mse_ps_Kedelai <- mse(result_ps_Kedelai$Produksi_actual_kk, result_ps_Kedelai$Produksi_pred_kk)

# Hitung RMSE (Root Mean Square Error)
rmse_ps_Kedelai <- rmse(result_ps_Kedelai$Produksi_actual_kk, result_ps_Kedelai$Produksi_pred_kk)

# Hitung MAPE (Mean Absolute Percent Error)
mape_ps_Kedelai <- mape(result_ps_Kedelai$Produksi_actual_kk, result_ps_Kedelai$Produksi_pred_kk)

# Tampilkan hasil evaluasi
cat(paste("MAE Produksi Kedelai : ", mae_ps_Kedelai, "\n"))
cat(paste("MSE Produksi Kedelai : ", mse_ps_Kedelai, "\n"))
cat(paste("RMSE Produksi Kedelai : ", rmse_ps_Kedelai, "\n"))
cat(paste("MAPE Produksi Kedelai : ", mape_ps_Kedelai, "%\n"))
```
```{r}
# Create data frame for forecasted production (2023-2032)
forecast_Kedelai_df_10y <- data.frame(Tahun = 2023:2032, Produksi = forecast_ps_Kedelai$mean)

# Display results
forecast_Kedelai_df_10y

```



## 2. Prediksi Porduktivitas Kedelai

```{r}
# Extract residuals of Produktivitas (corn production)
residuals_Produktivitas_kk <- residuals_Kedelai[, "Produktivitas"]
```


```{r}
#untuk uji stationer
ts_residuals_Produktivitas_kk <- ts(residuals_Produktivitas_kk, start = c(1993, 1), frequency = 1)
```

```{r}
#uji stasioner
adf.test(ts_residuals_Produktivitas_kk)
```

```{r}
acf(residuals_Produktivitas_kk, main="ACF of Residuals Produktivitas")
pacf(residuals_Produktivitas_kk, main="PACF of Residuals Produktivitas")
```

```{r}
arima_order_pt_kk <- c(5, 0, 5)
```



```{r}
# Estimate ARIMA model
arima_model_pt_Kedelai <- Arima(residuals_Produktivitas_kk, order = arima_order_pt_kk)
```


```{r}
# Check residuals of ARIMA model
checkresiduals(arima_model_pt_Kedelai)
```

```{r}
# Generate forecasts for the next 10 years
forecast_pt_Kedelai <- forecast(arima_model_pt_Kedelai, h = 10)
forecast_pt_Kedelai
```

```{r}
# Plot forecast
autoplot(forecast_pt_Kedelai) +
  labs(title = "Forecast of Corn Production in Sumatera (2023-2032)",
       subtitle = "Based on ARIMA model with VAR residuals")
```



```{r}
# Menyusun data untuk visualisasi dengan nama kolom yang sesuai
result_pt_Kedelai <- data.frame(Produktivitas_actual_kk = test_Kedelai$Produktivitas[1:10], Produktivitas_pred_kk = forecast_pt_Kedelai$mean[1:10])

# Plot perbandingan Produktivitas Kedelai Aktual dengan Prediksi Model ARIMA
ggplot(data = result_pt_Kedelai, aes(x = Produktivitas_actual_kk, y = Produktivitas_pred_kk)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  labs(x = "Actual Produktivitas", y = "Predicted Produktivitas") +
  ggtitle("Perbandingan Produktivitas Kedelai Aktual dengan Prediksi Model ARIMA") +
  theme_minimal()
```


```{r}
# Visualisasi Produktivitas Aktual dengan Hasil Prediksi
ggplot(data = result_pt_Kedelai, aes(x = 1:nrow(result_pt_Kedelai))) +
  geom_line(aes(y = Produktivitas_actual_kk, color = "Actual"), size = 1) +
  geom_line(aes(y = Produktivitas_pred_kk, color = "ARIMA Prediction"), size = 1) +
  labs(x = "Observation", y = "Produktivitas") +
  scale_color_manual(values = c("Actual" = "blue", "ARIMA Prediction" = "red")) +
  ggtitle("Produktivitas Kedelai: Aktual vs Prediksi Model ARIMA") +
  theme_minimal()


```

### evaluasi model
```{r}
# Hitung MAE (Mean Absolute Error)
mae_pt_Kedelai <- mae(result_pt_Kedelai$Produktivitas_actual_kk, result_pt_Kedelai$Produktivitas_pred_kk)

# Hitung MSE (Mean Squared Error)
mse_pt_Kedelai <- mse(result_pt_Kedelai$Produktivitas_actual_kk, result_pt_Kedelai$Produktivitas_pred_kk)

# Hitung RMSE (Root Mean Square Error)
rmse_pt_Kedelai <- rmse(result_pt_Kedelai$Produktivitas_actual_kk, result_pt_Kedelai$Produktivitas_pred_kk)

# Hitung MAPE (Mean Absolute Percent Error)
mape_pt_Kedelai <- mape(result_pt_Kedelai$Produktivitas_actual_kk, result_pt_Kedelai$Produktivitas_pred_kk)

# Tampilkan hasil evaluasi
cat(paste("MAE Produktivitas Kedelai : ", mae_pt_Kedelai, "\n"))
cat(paste("MSE Produktivitas Kedelai : ", mse_pt_Kedelai, "\n"))
cat(paste("RMSE Produktivitas Kedelai : ", rmse_pt_Kedelai, "\n"))
cat(paste("MAPE Produktivitas Kedelai : ", mape_pt_Kedelai, "%\n"))
```
```{r}
# Create data frame for forecasted production (2023-2032)
forecast_Kedelai_df_10y <- data.frame(Tahun = 2023:2032, Produktivitas = forecast_pt_Kedelai$mean)

# Display results
forecast_Kedelai_df_10y
```



# E. VAR terhadap Kacang hijau
```{r}
# Pilih variabel yang akan diprediksi
data_var_kcgHijau_Sumatera <- Sumatera_kacang_hijau[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_kcgHijau_Sumatera
```

```{r}
# Tentukan ukuran data pelatihan (train) dan pengujian (test)
trainset_kcgHijau <- floor(0.7 * nrow(data_var_kcgHijau_Sumatera))  # 70% untuk pelatihan
testset_kcgHijau <- nrow(data_var_kcgHijau_Sumatera) - trainset_kcgHijau   # 30% untuk pengujian
```

```{r}
# Pisahkan data menjadi train dan test berdasarkan urutan waktu
train_kcgHijau <- data_var_kcgHijau_Sumatera[1:trainset_kcgHijau, ]
test_kcgHijau <-data_var_kcgHijau_Sumatera[(trainset_kcgHijau + 1):nrow(data_var_kcgHijau_Sumatera), ]
```


```{r}
#Format time series
ts_data_kcgHijau <- ts(train_kcgHijau, start = c(1993,1), frequency = 1)
ts_data_kcgHijau
```

```{r}
best_lag_kcgHijau <- VARselect(ts_data_kcgHijau, lag.max = 5, type = "both")
best_lag_kcgHijau
```


```{r}

var_model_kacanghijau_Sumatera <- VAR(ts_data_kcgHijau, p = best_lag_kcgHijau$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_kacanghijau_Sumatera)
```



# F. Prediksi ARIMA - Kacang Hijau
```{r}
# Extract residuals from VAR model
residuals_kcgHijau <- residuals(var_model_kacanghijau_Sumatera)
```


## 1. Prediksi Produksi  kcgHijau
```{r}
# Extract residuals of Produksi (corn production)
residuals_Produksi_kh <- residuals_kcgHijau[, "Produksi"]
```

```{r}
#untuk uji stationer
ts_residuals_Produksi_kh <- ts(residuals_Produksi_kh, start = c(1993, 1), frequency = 1)
```

```{r}
#uji stasioner
adf.test(ts_residuals_Produksi_kh)
```

```{r}
acf(residuals_Produksi_kh, main="ACF of Residuals produksi")
pacf(residuals_Produksi_kh, main="PACF of Residuals Produksi")
```

```{r}
arima_order_ps_kh <- c(5, 0, 5)
```


```{r}
# Estimate ARIMA model
arima_model_ps_kcgHijau <- Arima(residuals_Produksi_kh, order = arima_order_ps_kh)
```


```{r}
# Check residuals of ARIMA model
checkresiduals(arima_model_ps_kcgHijau)
```

```{r}
# Generate forecasts for the next 10 years
forecast_ps_kcgHijau <- forecast(arima_model_ps_kcgHijau, h = 10)
forecast_ps_kcgHijau
```

```{r}
# Plot forecast
autoplot(forecast_ps_kcgHijau) +
  labs(title = "Forecast of Corn Production in Sumatera (2023-2032)",
       subtitle = "Based on ARIMA model with VAR residuals")
```



```{r}
# Menyusun data untuk visualisasi dengan nama kolom yang sesuai
result_ps_kcgHijau <- data.frame(Produksi_actual_kh = test_kcgHijau$Produksi[1:10], Produksi_pred_kh = forecast_ps_kcgHijau$mean[1:10])

# Plot perbandingan Produksi kcgHijau Aktual dengan Prediksi Model ARIMA
ggplot(data = result_ps_kcgHijau, aes(x = Produksi_actual_kh, y = Produksi_pred_kh)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  labs(x = "Actual Produksi", y = "Predicted Produksi") +
  ggtitle("Perbandingan Produksi Kacang Hijau Aktual dengan Prediksi Model ARIMA") +
  theme_minimal()
```


```{r}
# Visualisasi Produksi Aktual dengan Hasil Prediksi
ggplot(data = result_ps_kcgHijau, aes(x = 1:nrow(result_ps_kcgHijau))) +
  geom_line(aes(y = Produksi_actual_kh, color = "Actual"), size = 1) +
  geom_line(aes(y = Produksi_pred_kh, color = "ARIMA Prediction"), size = 1) +
  labs(x = "Observation", y = "Produksi") +
  scale_color_manual(values = c("Actual" = "blue", "ARIMA Prediction" = "red")) +
  ggtitle("Produksi Kacang Hijau: Aktual vs Prediksi Model ARIMA") +
  theme_minimal()


```

### evaluasi model
```{r}
# Hitung MAE (Mean Absolute Error)
mae_ps_kcgHijau <- mae(result_ps_kcgHijau$Produksi_actual_kh, result_ps_kcgHijau$Produksi_pred_kh)

# Hitung MSE (Mean Squared Error)
mse_ps_kcgHijau <- mse(result_ps_kcgHijau$Produksi_actual_kh, result_ps_kcgHijau$Produksi_pred_kh)

# Hitung RMSE (Root Mean Square Error)
rmse_ps_kcgHijau <- rmse(result_ps_kcgHijau$Produksi_actual_kh, result_ps_kcgHijau$Produksi_pred_kh)

# Hitung MAPE (Mean Absolute Percent Error)
mape_ps_kcgHijau <- mape(result_ps_kcgHijau$Produksi_actual_kh, result_ps_kcgHijau$Produksi_pred_kh)

# Tampilkan hasil evaluasi
cat(paste("MAE Produksi kcgHijau : ", mae_ps_kcgHijau, "\n"))
cat(paste("MSE Produksi kcgHijau : ", mse_ps_kcgHijau, "\n"))
cat(paste("RMSE Produksi kcgHijau : ", rmse_ps_kcgHijau, "\n"))
cat(paste("MAPE Produksi kcgHijau : ", mape_ps_kcgHijau, "%\n"))
```
```{r}
# Create data frame for forecasted production (2023-2032)
forecast_kcgHijau_df_10y <- data.frame(Tahun = 2023:2032, Produksi = forecast_ps_kcgHijau$mean)

# Display results
forecast_kcgHijau_df_10y

```



## 2. Prediksi Porduktivitas kcgHijau

```{r}
# Extract residuals of Produktivitas (corn production)
residuals_Produktivitas_kh <- residuals_kcgHijau[, "Produktivitas"]
```


```{r}
#untuk uji stationer
ts_residuals_Produktivitas_kh <- ts(residuals_Produktivitas_kh, start = c(1993, 1), frequency = 1)
```

```{r}
#uji stasioner
adf.test(ts_residuals_Produktivitas_kh)
```

```{r}
acf(residuals_Produktivitas_kh, main="ACF of Residuals Produktivitas")
pacf(residuals_Produktivitas_kh, main="PACF of Residuals Produktivitas")
```

```{r}
arima_order_pt_kh <- c(5, 0, 5)
```



```{r}
# Estimate ARIMA model
arima_model_pt_kcgHijau <- Arima(residuals_Produktivitas_kh, order = arima_order_pt_kh)
```


```{r}
# Check residuals of ARIMA model
checkresiduals(arima_model_pt_kcgHijau)
```

```{r}
# Generate forecasts for the next 10 years
forecast_pt_kcgHijau <- forecast(arima_model_pt_kcgHijau, h = 10)
forecast_pt_kcgHijau
```

```{r}
# Plot forecast
autoplot(forecast_pt_kcgHijau) +
  labs(title = "Forecast of Corn Production in Sumatera (2023-2032)",
       subtitle = "Based on ARIMA model with VAR residuals")
```



```{r}
# Menyusun data untuk visualisasi dengan nama kolom yang sesuai
result_pt_kcgHijau <- data.frame(Produktivitas_actual_kh = test_kcgHijau$Produktivitas[1:10], Produktivitas_pred_kh = forecast_pt_kcgHijau$mean[1:10])

# Plot perbandingan Produktivitas kcgHijau Aktual dengan Prediksi Model ARIMA
ggplot(data = result_pt_kcgHijau, aes(x = Produktivitas_actual_kh, y = Produktivitas_pred_kh)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  labs(x = "Actual Produktivitas", y = "Predicted Produktivitas") +
  ggtitle("Perbandingan Produktivitas kacang Hijau Aktual dengan Prediksi Model ARIMA") +
  theme_minimal()
```


```{r}
# Visualisasi Produktivitas Aktual dengan Hasil Prediksi
ggplot(data = result_pt_kcgHijau, aes(x = 1:nrow(result_pt_kcgHijau))) +
  geom_line(aes(y = Produktivitas_actual_kh, color = "Actual"), size = 1) +
  geom_line(aes(y = Produktivitas_pred_kh, color = "ARIMA Prediction"), size = 1) +
  labs(x = "Observation", y = "Produktivitas") +
  scale_color_manual(values = c("Actual" = "blue", "ARIMA Prediction" = "red")) +
  ggtitle("Produktivitas kacang Hijau: Aktual vs Prediksi Model ARIMA") +
  theme_minimal()


```

### evaluasi model
```{r}
# Hitung MAE (Mean Absolute Error)
mae_pt_kcgHijau <- mae(result_pt_kcgHijau$Produktivitas_actual_kh, result_pt_kcgHijau$Produktivitas_pred_kh)

# Hitung MSE (Mean Squared Error)
mse_pt_kcgHijau <- mse(result_pt_kcgHijau$Produktivitas_actual_kh, result_pt_kcgHijau$Produktivitas_pred_kh)

# Hitung RMSE (Root Mean Square Error)
rmse_pt_kcgHijau <- rmse(result_pt_kcgHijau$Produktivitas_actual_kh, result_pt_kcgHijau$Produktivitas_pred_kh)

# Hitung MAPE (Mean Absolute Percent Error)
mape_pt_kcgHijau <- mape(result_pt_kcgHijau$Produktivitas_actual_kh, result_pt_kcgHijau$Produktivitas_pred_kh)

# Tampilkan hasil evaluasi
cat(paste("MAE Produktivitas kcgHijau : ", mae_pt_kcgHijau, "\n"))
cat(paste("MSE Produktivitas kcgHijau : ", mse_pt_kcgHijau, "\n"))
cat(paste("RMSE Produktivitas kcgHijau : ", rmse_pt_kcgHijau, "\n"))
cat(paste("MAPE Produktivitas kcgHijau : ", mape_pt_kcgHijau, "%\n"))
```
```{r}
# Create data frame for forecasted production (2023-2032)
forecast_kcgHijau_df_10y <- data.frame(Tahun = 2023:2032, Produktivitas = forecast_pt_kcgHijau$mean)

# Display results
forecast_kcgHijau_df_10y
```



#G. VAR terhadap kacang Tanah Sumatera

```{r}
# Pilih variabel yang akan diprediks
data_var_kcgTanah <- Sumatera_kacang_tanah[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_kcgTanah
```

```{r}
# Tentukan ukuran data pelatihan (train) dan pengujian (test)
trainset_kcgTanah <- floor(0.7 * nrow(data_var_kcgTanah))  # 70% untuk pelatihan
testset_kcgTanah <- nrow(data_var_kcgTanah) - trainset_kcgTanah   # 30% untuk pengujian
```

```{r}
# Pisahkan data menjadi train dan test berdasarkan urutan waktu
train_kcgTanah <- data_var_kcgTanah[1:trainset_kcgTanah, ]
test_kcgTanah <-data_var_kcgTanah[(trainset_kcgTanah + 1):nrow(data_var_kcgTanah), ]
```


```{r}
#Format time series
ts_data_kcgTanah <- ts(train_kcgTanah, start = c(1993,1), frequency = 1)
```

```{r}
best_lag_kcgTanah <- VARselect(ts_data_kcgTanah, lag.max = 5, type = "both")
best_lag_kcgTanah
```


```{r}

var_model_kacangtanah_Sumatera <- VAR(ts_data_kcgTanah, p = best_lag_kcgTanah$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_kacangtanah_Sumatera)
```


# H. Prediksi ARIMA - kcgTanah
```{r}
# Extract residuals from VAR model
residuals_kcgTanah <- residuals(var_model_kacangtanah_Sumatera)
```


## 1. Prediksi Produksi  kcgTanah
```{r}
# Extract residuals of Produksi (corn production)
residuals_Produksi_kt <- residuals_kcgTanah[, "Produksi"]
```

```{r}
#untuk uji stationer
ts_residuals_Produksi_kt <- ts(residuals_Produksi_kt, start = c(1993, 1), frequency = 1)
```

```{r}
#uji stasioner
adf.test(ts_residuals_Produksi_kt)
```

```{r}
acf(residuals_Produksi_kt, main="ACF of Residuals produksi")
pacf(residuals_Produksi_kt, main="PACF of Residuals Produksi")
```

```{r}
arima_order_ps_kt <- c(5, 0, 5)
```


```{r}
# Estimate ARIMA model
arima_model_ps_kcgTanah <- Arima(residuals_Produksi_kt, order = arima_order_ps_kt)
```


```{r}
# Check residuals of ARIMA model
checkresiduals(arima_model_ps_kcgTanah)
```

```{r}
# Generate forecasts for the next 10 years
forecast_ps_kcgTanah <- forecast(arima_model_ps_kcgTanah, h = 10)
forecast_ps_kcgTanah
```

```{r}
# Plot forecast
autoplot(forecast_ps_kcgTanah) +
  labs(title = "Forecast of Corn Production in Sumatera (2023-2032)",
       subtitle = "Based on ARIMA model with VAR residuals")
```



```{r}
# Menyusun data untuk visualisasi dengan nama kolom yang sesuai
result_ps_kcgTanah <- data.frame(Produksi_actual_kt = test_kcgTanah$Produksi[1:10], Produksi_pred_kt = forecast_ps_kcgTanah$mean[1:10])

# Plot perbandingan Produksi kcgTanah Aktual dengan Prediksi Model ARIMA
ggplot(data = result_ps_kcgTanah, aes(x = Produksi_actual_kt, y = Produksi_pred_kt)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  labs(x = "Actual Produksi", y = "Predicted Produksi") +
  ggtitle("Perbandingan Produksi Kacang Tanah Aktual dengan Prediksi Model ARIMA") +
  theme_minimal()
```


```{r}
# Visualisasi Produksi Aktual dengan Hasil Prediksi
ggplot(data = result_ps_kcgTanah, aes(x = 1:nrow(result_ps_kcgTanah))) +
  geom_line(aes(y = Produksi_actual_kt, color = "Actual"), size = 1) +
  geom_line(aes(y = Produksi_pred_kt, color = "ARIMA Prediction"), size = 1) +
  labs(x = "Observation", y = "Produksi") +
  scale_color_manual(values = c("Actual" = "blue", "ARIMA Prediction" = "red")) +
  ggtitle("Produksi Kacang Tanah: Aktual vs Prediksi Model ARIMA") +
  theme_minimal()


```

### evaluasi model
```{r}
# Hitung MAE (Mean Absolute Error)
mae_ps_kcgTanah <- mae(result_ps_kcgTanah$Produksi_actual_kt, result_ps_kcgTanah$Produksi_pred_kt)

# Hitung MSE (Mean Squared Error)
mse_ps_kcgTanah <- mse(result_ps_kcgTanah$Produksi_actual_kt, result_ps_kcgTanah$Produksi_pred_kt)

# Hitung RMSE (Root Mean Square Error)
rmse_ps_kcgTanah <- rmse(result_ps_kcgTanah$Produksi_actual_kt, result_ps_kcgTanah$Produksi_pred_kt)

# Hitung MAPE (Mean Absolute Percent Error)
mape_ps_kcgTanah <- mape(result_ps_kcgTanah$Produksi_actual_kt, result_ps_kcgTanah$Produksi_pred_kt)

# Tampilkan hasil evaluasi
cat(paste("MAE Produksi kcgTanah : ", mae_ps_kcgTanah, "\n"))
cat(paste("MSE Produksi kcgTanah : ", mse_ps_kcgTanah, "\n"))
cat(paste("RMSE Produksi kcgTanah : ", rmse_ps_kcgTanah, "\n"))
cat(paste("MAPE Produksi kcgTanah : ", mape_ps_kcgTanah, "%\n"))
```
```{r}
# Create data frame for forecasted production (2023-2032)
forecast_kcgTanah_df_10y <- data.frame(Tahun = 2023:2032, Produksi = forecast_ps_kcgTanah$mean)

# Display results
forecast_kcgTanah_df_10y

```



## 2. Prediksi Porduktivitas kcgTanah

```{r}
# Extract residuals of Produktivitas (corn production)
residuals_Produktivitas_kt <- residuals_kcgTanah[, "Produktivitas"]
```


```{r}
#untuk uji stationer
ts_residuals_Produktivitas_kt <- ts(residuals_Produktivitas_kt, start = c(1993, 1), frequency = 1)
```

```{r}
#uji stasioner
adf.test(ts_residuals_Produktivitas_kt)
```

```{r}
acf(residuals_Produktivitas_kt, main="ACF of Residuals Produktivitas")
pacf(residuals_Produktivitas_kt, main="PACF of Residuals Produktivitas")
```

```{r}
arima_order_pt_kt <- c(3, 0, 3)
```



```{r}
# Estimate ARIMA model
arima_model_pt_kcgTanah <- Arima(residuals_Produktivitas_kt, order = arima_order_pt_kt)
```


```{r}
# Check residuals of ARIMA model
checkresiduals(arima_model_pt_kcgTanah)
```

```{r}
# Generate forecasts for the next 10 years
forecast_pt_kcgTanah <- forecast(arima_model_pt_kcgTanah, h = 10)
forecast_pt_kcgTanah
```

```{r}
# Plot forecast
autoplot(forecast_pt_kcgTanah) +
  labs(title = "Forecast of Corn Production in Sumatera (2023-2032)",
       subtitle = "Based on ARIMA model with VAR residuals")
```



```{r}
# Menyusun data untuk visualisasi dengan nama kolom yang sesuai
result_pt_kcgTanah <- data.frame(Produktivitas_actual_kt = test_kcgTanah$Produktivitas[1:10], Produktivitas_pred_kt = forecast_pt_kcgTanah$mean[1:10])

# Plot perbandingan Produktivitas kcgTanah Aktual dengan Prediksi Model ARIMA
ggplot(data = result_pt_kcgTanah, aes(x = Produktivitas_actual_kt, y = Produktivitas_pred_kt)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  labs(x = "Actual Produktivitas", y = "Predicted Produktivitas") +
  ggtitle("Perbandingan Produktivitas kacang Tanah Aktual dengan Prediksi Model ARIMA") +
  theme_minimal()
```


```{r}
# Visualisasi Produktivitas Aktual dengan Hasil Prediksi
ggplot(data = result_pt_kcgTanah, aes(x = 1:nrow(result_pt_kcgTanah))) +
  geom_line(aes(y = Produktivitas_actual_kt, color = "Actual"), size = 1) +
  geom_line(aes(y = Produktivitas_pred_kt, color = "ARIMA Prediction"), size = 1) +
  labs(x = "Observation", y = "Produktivitas") +
  scale_color_manual(values = c("Actual" = "blue", "ARIMA Prediction" = "red")) +
  ggtitle("Produktivitas kacang Tanah: Aktual vs Prediksi Model ARIMA") +
  theme_minimal()


```

### evaluasi model
```{r}
# Hitung MAE (Mean Absolute Error)
mae_pt_kcgTanah <- mae(result_pt_kcgTanah$Produktivitas_actual_kt, result_pt_kcgTanah$Produktivitas_pred_kt)

# Hitung MSE (Mean Squared Error)
mse_pt_kcgTanah <- mse(result_pt_kcgTanah$Produktivitas_actual_kt, result_pt_kcgTanah$Produktivitas_pred_kt)

# Hitung RMSE (Root Mean Square Error)
rmse_pt_kcgTanah <- rmse(result_pt_kcgTanah$Produktivitas_actual_kt, result_pt_kcgTanah$Produktivitas_pred_kt)

# Hitung MAPE (Mean Absolute Percent Error)
mape_pt_kcgTanah <- mape(result_pt_kcgTanah$Produktivitas_actual_kt, result_pt_kcgTanah$Produktivitas_pred_kt)

# Tampilkan hasil evaluasi
cat(paste("MAE Produktivitas kcgTanah : ", mae_pt_kcgTanah, "\n"))
cat(paste("MSE Produktivitas kcgTanah : ", mse_pt_kcgTanah, "\n"))
cat(paste("RMSE Produktivitas kcgTanah : ", rmse_pt_kcgTanah, "\n"))
cat(paste("MAPE Produktivitas kcgTanah : ", mape_pt_kcgTanah, "%\n"))
```
```{r}
# Create data frame for forecasted production (2023-2032)
forecast_kcgTanah_df_10y <- data.frame(Tahun = 2023:2032, Produktivitas = forecast_pt_kcgTanah$mean)

# Display results
forecast_kcgTanah_df_10y
```


# I. Var terhadap Ubi Jalar 
```{r}
data_var_ubijalar <- Sumatera_ubi_jalar[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_ubijalar
```


```{r}
# Tentukan ukuran data pelatihan (train) dan pengujian (test)
trainset_ubijalar <- floor(0.7 * nrow(data_var_ubijalar))  # 70% untuk pelatihan
testset_ubijalar <- nrow(data_var_ubijalar) - trainset_ubijalar   # 30% untuk pengujian
```

```{r}
# Pisahkan data menjadi train dan test berdasarkan urutan waktu
train_ubijalar <- data_var_ubijalar[1:trainset_ubijalar, ]
test_ubijalar <-data_var_ubijalar[(trainset_ubijalar + 1):nrow(data_var_ubijalar), ]
```



```{r}
#Format time series
ts_data_ubijalar_Sumatera<- ts(train_ubijalar, start = c(1993,1), frequency = 1)
```

```{r}
best_lag_ubijalar_Sumatera<- VARselect(ts_data_ubijalar_Sumatera, lag.max = 5, type = "both")
best_lag_ubijalar_Sumatera
```


```{r}

var_model_ubijalar_Sumatera <- VAR(ts_data_ubijalar_Sumatera, p = best_lag_ubijalar_Sumatera$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_ubijalar_Sumatera)
```



# J. Prediksi ARIMA - ubi jalar
```{r}
# Extract residuals from VAR model
residuals_ubijalar <- residuals(var_model_ubijalar_Sumatera)
```

## 1. Prediksi Produksi  ubi jalar
```{r}
# Extract residuals of Produksi (corn production)
residuals_Produksi_uj <- residuals_ubijalar[, "Produksi"]
```

```{r}
#untuk uji stationer
ts_residuals_Produksi_uj <- ts(residuals_Produksi_uj, start = c(1993, 1), frequency = 1)
```

```{r}
#uji stasioner
adf.test(ts_residuals_Produksi_uj)
```

```{r}
acf(residuals_Produksi_uj, main="ACF of Residuals produksi")
pacf(residuals_Produksi_uj, main="PACF of Residuals Produksi")
```

```{r}
order_ps_uj <- c(6, 0, 6)
```


```{r}
# Estimate ARIMA model
arima_model_ps_ubijalar <- Arima(residuals_Produksi_uj, order = order_ps_uj)
```


```{r}
# Check residuals of ARIMA model
checkresiduals(arima_model_ps_ubijalar)
```

```{r}
# Generate forecasts for the next 10 years
forecast_ps_ubijalar <- forecast(arima_model_ps_ubijalar, h = 10)
forecast_ps_ubijalar
```

```{r}
# Plot forecast
autoplot(forecast_ps_ubijalar) +
  labs(title = "Forecast of Corn Production in Sumatera (2023-2032)",
       subtitle = "Based on ARIMA model with VAR residuals")
```



```{r}
# Menyusun data untuk visualisasi dengan nama kolom yang sesuai
result_ps_ubijalar <- data.frame(Produksi_actual_uj = test_ubijalar$Produksi[1:10], Produksi_pred_uj = forecast_ps_ubijalar$mean[1:10])

# Plot perbandingan Produksi ubi jalar Aktual dengan Prediksi Model ARIMA
ggplot(data = result_ps_ubijalar, aes(x = Produksi_actual_uj, y = Produksi_pred_uj)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  labs(x = "Actual Produksi", y = "Predicted Produksi") +
  ggtitle("Perbandingan Produksi ubi jalar Aktual dengan Prediksi Model ARIMA") +
  theme_minimal()
```


```{r}
# Visualisasi Produksi Aktual dengan Hasil Prediksi
ggplot(data = result_ps_ubijalar, aes(x = 1:nrow(result_ps_ubijalar))) +
  geom_line(aes(y = Produksi_actual_uj, color = "Actual"), size = 1) +
  geom_line(aes(y = Produksi_pred_uj, color = "ARIMA Prediction"), size = 1) +
  labs(x = "Observation", y = "Produksi") +
  scale_color_manual(values = c("Actual" = "blue", "ARIMA Prediction" = "red")) +
  ggtitle("Produksi ubi jalar: Aktual vs Prediksi Model ARIMA") +
  theme_minimal()


```

### evaluasi model
```{r}
# Hitung MAE (Mean Absolute Error)
mae_ps_ubijalar <- mae(result_ps_ubijalar$Produksi_actual_uj, result_ps_ubijalar$Produksi_pred_uj)

# Hitung MSE (Mean Squared Error)
mse_ps_ubijalar <- mse(result_ps_ubijalar$Produksi_actual_uj, result_ps_ubijalar$Produksi_pred_uj)

# Hitung RMSE (Root Mean Square Error)
rmse_ps_ubijalar <- rmse(result_ps_ubijalar$Produksi_actual_uj, result_ps_ubijalar$Produksi_pred_uj)

# Hitung MAPE (Mean Absolute Percent Error)
mape_ps_ubijalar <- mape(result_ps_ubijalar$Produksi_actual_uj, result_ps_ubijalar$Produksi_pred_uj)

# Tampilkan hasil evaluasi
cat(paste("MAE Produksi ubi jalar : ", mae_ps_ubijalar, "\n"))
cat(paste("MSE Produksi ubi jalar : ", mse_ps_ubijalar, "\n"))
cat(paste("RMSE Produksi ubi jalar : ", rmse_ps_ubijalar, "\n"))
cat(paste("MAPE Produksi ubi jalar : ", mape_ps_ubijalar, "%\n"))
```
```{r}
# Create data frame for forecasted production (2023-2032)
forecast_ubijalar_df_10y <- data.frame(Tahun = 2023:2032, Produksi = forecast_ps_ubijalar$mean)

# Display results
forecast_ubijalar_df_10y

```


## 2. Prediksi Porduktivitas ubi jalar

```{r}
# Extract residuals of Produktivitas (corn production)
residuals_Produktivitas_uj <- residuals_ubijalar[, "Produktivitas"]
```


```{r}
#untuk uji stationer
ts_residuals_Produktivitas_uj <- ts(residuals_Produktivitas_uj, start = c(1993, 1), frequency = 1)
```

```{r}
#uji stasioner
adf.test(ts_residuals_Produktivitas_uj)
```

```{r}
acf(residuals_Produktivitas_uj, main="ACF of Residuals Produktivitas")
```


```{r}
pacf(residuals_Produktivitas_uj, main="PACF of Residuals Produktivitas")
```

```{r}
arima_order_pt_uj <- c(6, 0, 6)
```



```{r}
# Estimate ARIMA model
arima_model_pt_ubijalar <- Arima(residuals_Produktivitas_uj, order = arima_order_pt_uj)
```


```{r}
# Check residuals of ARIMA model
checkresiduals(arima_model_pt_ubijalar)
```

```{r}
# Generate forecasts for the next 10 years
forecast_pt_ubijalar <- forecast(arima_model_pt_ubijalar, h = 10)
forecast_pt_ubijalar
```

```{r}
# Plot forecast
autoplot(forecast_pt_ubijalar) +
  labs(title = "Forecast of Corn Production in Sumatera (2023-2032)",
       subtitle = "Based on ARIMA model with VAR residuals")
```



```{r}
# Menyusun data untuk visualisasi dengan nama kolom yang sesuai
result_pt_ubijalar <- data.frame(Produktivitas_actual_uj = test_ubijalar$Produktivitas[1:10], Produktivitas_pred_uj = forecast_pt_ubijalar$mean[1:10])

# Plot perbandingan Produktivitas ubi jalar Aktual dengan Prediksi Model ARIMA
ggplot(data = result_pt_ubijalar, aes(x = Produktivitas_actual_uj, y = Produktivitas_pred_uj)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  labs(x = "Actual Produktivitas", y = "Predicted Produktivitas") +
  ggtitle("Perbandingan Produktivitas ubi jalar Aktual dengan Prediksi Model ARIMA") +
  theme_minimal()
```


```{r}
# Visualisasi Produktivitas Aktual dengan Hasil Prediksi
ggplot(data = result_pt_ubijalar, aes(x = 1:nrow(result_pt_ubijalar))) +
  geom_line(aes(y = Produktivitas_actual_uj, color = "Actual"), size = 1) +
  geom_line(aes(y = Produktivitas_pred_uj, color = "ARIMA Prediction"), size = 1) +
  labs(x = "Observation", y = "Produktivitas") +
  scale_color_manual(values = c("Actual" = "blue", "ARIMA Prediction" = "red")) +
  ggtitle("Produktivitas ubi jalar: Aktual vs Prediksi Model ARIMA") +
  theme_minimal()


```

### evaluasi model
```{r}
# Hitung MAE (Mean Absolute Error)
mae_pt_ubijalar <- mae(result_pt_ubijalar$Produktivitas_actual_uj, result_pt_ubijalar$Produktivitas_pred_uj)

# Hitung MSE (Mean Squared Error)
mse_pt_ubijalar <- mse(result_pt_ubijalar$Produktivitas_actual_uj, result_pt_ubijalar$Produktivitas_pred_uj)

# Hitung RMSE (Root Mean Square Error)
rmse_pt_ubijalar <- rmse(result_pt_ubijalar$Produktivitas_actual_uj, result_pt_ubijalar$Produktivitas_pred_uj)

# Hitung MAPE (Mean Absolute Percent Error)
mape_pt_ubijalar <- mape(result_pt_ubijalar$Produktivitas_actual_uj, result_pt_ubijalar$Produktivitas_pred_uj)

# Tampilkan hasil evaluasi
cat(paste("MAE Produktivitas ubi jalar : ", mae_pt_ubijalar, "\n"))
cat(paste("MSE Produktivitas ubi jalar : ", mse_pt_ubijalar, "\n"))
cat(paste("RMSE Produktivitas ubi jalar : ", rmse_pt_ubijalar, "\n"))
cat(paste("MAPE Produktivitas ubi jalar : ", mape_pt_ubijalar, "%\n"))
```
```{r}
# Create data frame for forecasted production (2023-2032)
forecast_ubijalar_df_10y <- data.frame(Tahun = 2023:2032, Produktivitas = forecast_pt_ubijalar$mean)

# Display results
forecast_ubijalar_df_10y
```



# K. VAR terhadap Ubi kayu


```{r}
# Pilih variabel yang akan diprediksi

data_var_ubikayu <- Sumatera_ubi_kayu[, c("Produksi", "avg_rainfall", "Produktivitas")]
data_var_ubikayu
```

```{r}
# Tentukan ukuran data pelatihan (train) dan pengujian (test)
trainset_ubikayu <- floor(0.7 * nrow(data_var_ubikayu))  # 70% untuk pelatihan
testset_ubikayu <- nrow(data_var_ubikayu) - trainset_ubikayu   # 30% untuk pengujian
```

```{r}
# Pisahkan data menjadi train dan test berdasarkan urutan waktu
train_ubikayu <- data_var_ubikayu[1:trainset_ubikayu, ]
test_ubikayu <-data_var_ubikayu[(trainset_ubikayu + 1):nrow(data_var_ubikayu), ]
```


```{r}
#Format time series
ts_data_ubikayu_Sumatera <- ts(train_ubikayu, start = c(1993,1), frequency = 1)
```

```{r}
best_lag_ubikayu_Sumatera<- VARselect(ts_data_ubikayu_Sumatera, lag.max = 5, type = "both")
best_lag_ubikayu_Sumatera
```


```{r}

var_model_ubikayu_Sumatera <- VAR(ts_data_ubikayu_Sumatera, p = best_lag_ubikayu_Sumatera$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_ubikayu_Sumatera)
```




# L. Prediksi ARIMA - Ubi kayu
```{r}
# Extract residuals from VAR model
residuals_ubikayu <- residuals(var_model_ubikayu_Sumatera)
```


## 1. Prediksi Produksi  ubikayu
```{r}
# Extract residuals of Produksi (corn production)
residuals_Produksi_uk <- residuals_ubikayu[, "Produksi"]
```

```{r}
#untuk uji stationer
ts_residuals_Produksi_uk <- ts(residuals_Produksi_uk, start = c(1993, 1), frequency = 1)
```

```{r}
#uji stasioner
adf.test(ts_residuals_Produksi_uk)
```

```{r}
acf(residuals_Produksi_uk, main="ACF of Residuals produksi")
pacf(residuals_Produksi_uk, main="PACF of Residuals Produksi")
```

```{r}
arima_order_ps_uk <- c(7, 0, 7)
```


```{r}
# Estimate ARIMA model
arima_model_ps_ubikayu <- Arima(residuals_Produksi_uk, order = arima_order_ps_uk)
```


```{r}
# Check residuals of ARIMA model
checkresiduals(arima_model_ps_ubikayu)
```

```{r}
# Generate forecasts for the next 10 years
forecast_ps_ubikayu <- forecast(arima_model_ps_ubikayu, h = 10)
forecast_ps_ubikayu
```

```{r}
# Plot forecast
autoplot(forecast_ps_ubikayu) +
  labs(title = "Forecast of Corn Production in Sumatera (2023-2032)",
       subtitle = "Based on ARIMA model with VAR residuals")
```



```{r}
# Menyusun data untuk visualisasi dengan nama kolom yang sesuai
result_ps_ubikayu <- data.frame(Produksi_actual_uk = test_ubikayu$Produksi[1:10], Produksi_pred_uk = forecast_ps_ubikayu$mean[1:10])

# Plot perbandingan Produksi ubikayu Aktual dengan Prediksi Model ARIMA
ggplot(data = result_ps_ubikayu, aes(x = Produksi_actual_uk, y = Produksi_pred_uk)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  labs(x = "Actual Produksi", y = "Predicted Produksi") +
  ggtitle("Perbandingan Produksi Ubi Kayu Aktual dengan Prediksi Model ARIMA") +
  theme_minimal()
```


```{r}
# Visualisasi Produksi Aktual dengan Hasil Prediksi
ggplot(data = result_ps_ubikayu, aes(x = 1:nrow(result_ps_ubikayu))) +
  geom_line(aes(y = Produksi_actual_uk, color = "Actual"), size = 1) +
  geom_line(aes(y = Produksi_pred_uk, color = "ARIMA Prediction"), size = 1) +
  labs(x = "Observation", y = "Produksi") +
  scale_color_manual(values = c("Actual" = "blue", "ARIMA Prediction" = "red")) +
  ggtitle("Produksi Ubi Kayu: Aktual vs Prediksi Model ARIMA") +
  theme_minimal()


```

### evaluasi model
```{r}
# Hitung MAE (Mean Absolute Error)
mae_ps_ubikayu <- mae(result_ps_ubikayu$Produksi_actual_uk, result_ps_ubikayu$Produksi_pred_uk)

# Hitung MSE (Mean Squared Error)
mse_ps_ubikayu <- mse(result_ps_ubikayu$Produksi_actual_uk, result_ps_ubikayu$Produksi_pred_uk)

# Hitung RMSE (Root Mean Square Error)
rmse_ps_ubikayu <- rmse(result_ps_ubikayu$Produksi_actual_uk, result_ps_ubikayu$Produksi_pred_uk)

# Hitung MAPE (Mean Absolute Percent Error)
mape_ps_ubikayu <- mape(result_ps_ubikayu$Produksi_actual_uk, result_ps_ubikayu$Produksi_pred_uk)

# Tampilkan hasil evaluasi
cat(paste("MAE Produksi ubikayu : ", mae_ps_ubikayu, "\n"))
cat(paste("MSE Produksi ubikayu : ", mse_ps_ubikayu, "\n"))
cat(paste("RMSE Produksi ubikayu : ", rmse_ps_ubikayu, "\n"))
cat(paste("MAPE Produksi ubikayu : ", mape_ps_ubikayu, "%\n"))
```
```{r}
# Create data frame for forecasted production (2023-2032)
forecast_ubikayu_df_10y <- data.frame(Tahun = 2023:2032, Produksi = forecast_ps_ubikayu$mean)

# Display results
forecast_ubikayu_df_10y

```



## 2. Prediksi Porduktivitas ubikayu

```{r}
# Extract residuals of Produktivitas (corn production)
residuals_Produktivitas_uk <- residuals_ubikayu[, "Produktivitas"]
```


```{r}
#untuk uji stationer
ts_residuals_Produktivitas_uk <- ts(residuals_Produktivitas_uk, start = c(1993, 1), frequency = 1)
```

```{r}
#uji stasioner
adf.test(ts_residuals_Produktivitas_uk)
```

```{r}
acf(residuals_Produktivitas_uk, main="ACF of Residuals Produktivitas")
pacf(residuals_Produktivitas_uk, main="PACF of Residuals Produktivitas")
```

```{r}
arima_order_pt_uk <- c(4, 0, 4)
```



```{r}
# Estimate ARIMA model
arima_model_pt_ubikayu <- Arima(residuals_Produktivitas_uk, order = arima_order_pt_uk)
```


```{r}
# Check residuals of ARIMA model
checkresiduals(arima_model_pt_ubikayu)
```

```{r}
# Generate forecasts for the next 10 years
forecast_pt_ubikayu <- forecast(arima_model_pt_ubikayu, h = 10)
forecast_pt_ubikayu
```

```{r}
# Plot forecast
autoplot(forecast_pt_ubikayu) +
  labs(title = "Forecast of Corn Production in Sumatera (2023-2032)",
       subtitle = "Based on ARIMA model with VAR residuals")
```



```{r}
# Menyusun data untuk visualisasi dengan nama kolom yang sesuai
result_pt_ubikayu <- data.frame(Produktivitas_actual_uk = test_ubikayu$Produktivitas[1:10], Produktivitas_pred_uk = forecast_pt_ubikayu$mean[1:10])

# Plot perbandingan Produktivitas ubikayu Aktual dengan Prediksi Model ARIMA
ggplot(data = result_pt_ubikayu, aes(x = Produktivitas_actual_uk, y = Produktivitas_pred_uk)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  labs(x = "Actual Produktivitas", y = "Predicted Produktivitas") +
  ggtitle("Perbandingan Produktivitas Ubi Kayu Aktual dengan Prediksi Model ARIMA") +
  theme_minimal()
```


```{r}
# Visualisasi Produktivitas Aktual dengan Hasil Prediksi
ggplot(data = result_pt_ubikayu, aes(x = 1:nrow(result_pt_ubikayu))) +
  geom_line(aes(y = Produktivitas_actual_uk, color = "Actual"), size = 1) +
  geom_line(aes(y = Produktivitas_pred_uk, color = "ARIMA Prediction"), size = 1) +
  labs(x = "Observation", y = "Produktivitas") +
  scale_color_manual(values = c("Actual" = "blue", "ARIMA Prediction" = "red")) +
  ggtitle("Produktivitas Ubi Kayu: Aktual vs Prediksi Model ARIMA") +
  theme_minimal()


```

### evaluasi model
```{r}
# Hitung MAE (Mean Absolute Error)
mae_pt_ubikayu <- mae(result_pt_ubikayu$Produktivitas_actual_uk, result_pt_ubikayu$Produktivitas_pred_uk)

# Hitung MSE (Mean Squared Error)
mse_pt_ubikayu <- mse(result_pt_ubikayu$Produktivitas_actual_uk, result_pt_ubikayu$Produktivitas_pred_uk)

# Hitung RMSE (Root Mean Square Error)
rmse_pt_ubikayu <- rmse(result_pt_ubikayu$Produktivitas_actual_uk, result_pt_ubikayu$Produktivitas_pred_uk)

# Hitung MAPE (Mean Absolute Percent Error)
mape_pt_ubikayu <- mape(result_pt_ubikayu$Produktivitas_actual_uk, result_pt_ubikayu$Produktivitas_pred_uk)

# Tampilkan hasil evaluasi
cat(paste("MAE Produktivitas ubikayu : ", mae_pt_ubikayu, "\n"))
cat(paste("MSE Produktivitas ubikayu : ", mse_pt_ubikayu, "\n"))
cat(paste("RMSE Produktivitas ubikayu : ", rmse_pt_ubikayu, "\n"))
cat(paste("MAPE Produktivitas ubikayu : ", mape_pt_ubikayu, "%\n"))
```
```{r}
# Create data frame for forecasted production (2023-2032)
forecast_ubikayu_df_10y <- data.frame(Tahun = 2023:2032, Produktivitas = forecast_pt_ubikayu$mean)

# Display results
forecast_ubikayu_df_10y
```