---
title: "Untitled"
author: "Fitria"
date: "2023-10-29"
output: pdf_document
---


```{r}
.libPaths("C:/Users/Lenovo/AppData/Local/R/win-library/4.3")
```




```{r}
library(readxl)
library(dplyr)
library(stats)
library(lubridate)
library(ggplot2)
library(lubridate)
library(summarytools)
library(cluster)
library(scales)
library(vars)

```


```{r}

# Buat vektor untuk mengonversi nama bulan ke angka bulan
#bulan<- c("Januari" = 1, "Februari" = 2, "Maret" = 3, "April" = 4, "Mei" = 5, "Juni" = 6, "Juli" = 7, "Agustus" = 8, "September" = 9, "Oktober" = 10, "November" = 11, "Desember" = 12)
# Mengubah variabel bulan menjadi angka
#Hujan_kab$bulan_angka <- bulan[Hujan_kab$Bulan]
#Hujan_kab

```

```{r}
# Mengonversi variabel tahun dan bulan menjadi tipe data Date dengan format "YYYY-MM-01"
#Hujan_kab$tanggal <- as.Date(paste0(Hujan_kab$Tahun, "-", Hujan_kab$bulan_angka, "-01"))
#Hujan_kab
```


```{r}
data_iklim <-read_excel("D:/Download/Data tanaman Pangan dan Iklim di Indonesia (2006-2015).xlsx")
data_iklim
```

```{r}

#Merubah type data dari cdouble menjadi numeric agar mudah di operasikan
data_iklim$Produktivitas<-as.numeric(data_iklim$Produktivitas)
data_iklim$Produksi<-as.numeric(data_iklim$Produksi)
data_iklim$Luas_Panen<-as.numeric(data_iklim$Luas_Panen)
data_iklim$Kecepatan_Angin<-as.numeric(data_iklim$Kecepatan_Angin)
data_iklim$Kelembapan<-as.numeric(data_iklim$Kelembapan)
data_iklim$Suhu<-as.numeric(data_iklim$Suhu)
data_iklim$Penyinaran_Matahari<-as.numeric(data_iklim$Penyinaran_Matahari)
data_iklim
```

```{r}
data_iklim$Tahun<-make_date(data_iklim$Tahun)
data_iklim
```

```{r}
shapiro.test(data_iklim$Produksi)
shapiro.test(data_iklim$Produktivitas)
shapiro.test(data_iklim$Luas_Panen)
shapiro.test(data_iklim$Kecepatan_Angin)
shapiro.test(data_iklim$Kelembapan)
shapiro.test(data_iklim$Suhu)
shapiro.test(data_iklim$Penyinaran_Matahari)

```


```{r}
ks.test(data_iklim$Produksi, "pnorm", mean=mean(data_iklim$Produksi), sd=sd(data_iklim$Produksi))
ks.test(data_iklim$Kelembapan, "pnorm", mean=mean(data_iklim$Kelembapan), sd=sd(data_iklim$Kelembapan))
```

```{r}
# Menampikan variabel dengan baris kosong
colSums(is.na(data_iklim))
```

```{r}
# Menghapus data NA's
Iklim_clean <- na.omit(data_iklim)
summary(Iklim_clean)
```
```{r}
colSums(is.na(Iklim_clean))
```
```{r}
tail(Iklim_clean)
```


```{r}
shapiro.test(Iklim_clean$Produksi)
shapiro.test(Iklim_clean$Produktivitas)
shapiro.test(Iklim_clean$Luas_Panen)
shapiro.test(Iklim_clean$Kecepatan_Angin)
shapiro.test(Iklim_clean$Kelembapan)
shapiro.test(Iklim_clean$Suhu)
shapiro.test(Iklim_clean$Penyinaran_Matahari)
shapiro.test(Iklim_clean$Tahun)
```

```{r}
#hist(data$variabel_dependen) untuk variabel dependen numerik yang hasilnya menunjukkan bahwa distribusi data tidak normal 
hist(Iklim_clean$Produksi)
hist(Iklim_clean$Produktivitas)
```
```{r}
# Melakukan transformasi logaritmik pada variabel Produktivitas
Iklim_clean$Produktivitas_transformed <- log(Iklim_clean$Produktivitas)

# Melakukan transformasi logaritmik pada variabel Produksi
Iklim_clean$Produksi_transformed <- log(Iklim_clean$Produksi)
```


```{r}
hist(Iklim_clean$Produksi_transformed)
hist(Iklim_clean$Produktivitas_transformed)
```
## Melakukan Analisis Iklim terhadap tanaman pangan di indonesia tahun 2006-2015 dengan model VAR

### Analisis Iklim terhadap Padi di indonesia tahun 2006-2015 dengan model VAR

```{r}
#Mengambil tanaman pangan padi
Iklim_padi <- Iklim_clean %>%
  filter(Jenis_Komoditi == "Padi") 

Iklim_padi
```



### L0ad data curah hujan indonesia
```{r}
Hujan_indonesia <-read_excel("D:/Download/climateserv_Indonesia_(2006-2015).xlsx")
Hujan_indonesia
```

```{r}
# Merubah type variabel date menjadi type data date
Hujan_indonesia$date<- as.Date(Hujan_indonesia$date)

#Merubah type data menajdi numeric
Hujan_indonesia$rainfall_avg<-as.numeric(Hujan_indonesia$rainfall_avg)
glimpse(Hujan_indonesia)
```

```{r}
# Mengambil rata-rata curah hujan per tahun
Hujan_yearly <- Hujan_indonesia %>%
  mutate(year = lubridate::year(date)) %>%
  group_by(year) %>%
  summarise(avg_rainfall = mean(rainfall_avg))
Hujan_yearly  
```

```{r}
# Merubah type tahun menjadi date
Hujan_yearly$year <- make_date(Hujan_yearly$year)
Hujan_yearly
```
## Padi Indonesia

```{r}
# Mengabungkan kedua dataset
merged_padi_indonesia <- merge(Iklim_padi, Hujan_yearly, by.x = "Tahun", by.y = "year")
merged_padi_indonesia
```

```{r}
# Pilih variabel yang akan diprediksi

data_var_Indonesia1 <- merged_padi_indonesia[, c("Produksi", "Luas_Panen", "Kecepatan_Angin", "Kelembapan", "Suhu", "Penyinaran_Matahari", "avg_rainfall")]
data_var_Indonesia1
```

Untuk mendukung prediksi dengan Model VAR, data harus dirubah kedalam
format time series (ts)

```{r}
ts_data_padi_Indonesia <- ts(data_var_Indonesia1, start = c(2006,1), frequency = 1)
ts_data_padi_Indonesia
```

```{r}
best_lag_padi_Indonesia<- VARselect(ts_data_padi_Indonesia, lag.max = 5, type = "both")
best_lag_padi_Indonesia
```
### VAR Model Rata-rata curah hujan terhadap rata-rata produksi padi
```{r}
# VAR Model Rata-rata curah hujan terhadap rata-rata produksi padi
var_model_Padi_Indonesia <- VAR(ts_data_padi_Indonesia, p = best_lag_padi_Indonesia$selection[1], type = "both") # jumlah order dari model VAR
summary(var_model_Padi_Indonesia)
```


```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_padi1 <- cor(data_var_Indonesia1$Produksi, data_var_Indonesia1$avg_rainfall)
cat ("Koefisien Korelasi Pearson Rata-rata Curah hujan dan Produksi:",kolerasi_padi1)
```
Koefisien Korelasi Pearson Produksi dan Produksi: -0.0002334779

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_padi2 <- cor(data_var_Indonesia1$Produksi, data_var_Indonesia1$Luas_Panen)
cat ("Koefisien Korelasi Pearson Luas panen dan Produksi:", kolerasi_padi2)
```
Koefisien Korelasi Pearson Luas panen dan Produksi: 0.9337694

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_padi3 <- cor(data_var_Indonesia1$Produksi, data_var_Indonesia1$Kecepatan_Angin)
cat ("Koefisien Korelasi Pearson Kecepatan Angin dan Produksi:", kolerasi_padi3)
```
Koefisien Korelasi Pearson Kecepatan Angin dan Produksi: 0.3056641

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_padi4 <- cor(data_var_Indonesia1$Produksi, data_var_Indonesia1$Kelembapan)
cat ("Koefisien Korelasi Pearson Kelembapan dan Produksi:", kolerasi_padi4)
```
Koefisien Korelasi Pearson Kelembapan dan Produksi: -0.2931288

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_padi5 <- cor(data_var_Indonesia1$Produksi, data_var_Indonesia1$Penyinaran_Matahari)
cat ("Koefisien Korelasi Pearson Penyinaran_Matahari dan Produksi:", kolerasi_padi5)
```
Koefisien Korelasi Pearson Penyinaran_Matahari dan Produksi: 0.1724071

```{r}
# Menghitung koefisien korelasi Pearson
kolerasi_padi6 <- cor(data_var_Indonesia1$Produksi, data_var_Indonesia1$Suhu)
cat ("Koefisien Korelasi Pearson Suhu dan Produksi:", kolerasi_padi6)
```
Koefisien Korelasi Pearson Suhu dan Produksi: -0.1453374

```{r}
# Melakukan uji Granger Causality
granger_test_padi <- causality(var_model_Padi, cause = "avg_rainfall")
granger_test_padi
```


## Melakukan VAR Iklim terhadap tanaman pangan pada provinsi ACEH
```{r}
#Mengambil Provinsi Aceh 
Aceh_iklim <- Iklim_clean %>%
  filter(Provinsi == "ACEH") 

Aceh_iklim
```


```{r}
#mengambil data curah hujan, tahun dan provinsi dari dataser sumatera_padi
Aceh1 <- sumatera_padi[, c("Tahun", "Provinsi", "Curah_hujan")] #subdataset yang hanya berisikan 3 kolom
Aceh1
```



```{r}
#Mengambil Curah hujan di Provinsi Aceh pada pada dataset Aceh1 karena curah hujan di datasetAceh yg di sumatera_padi bukan untuk padi saja. serta menfilter tahun hanya tahun 2006 sampai tahun 2015
hujan1_aceh <-Aceh1 %>%
  mutate(Tahun = year(Tahun)) %>%
  filter(Tahun >= 2006 & Tahun <= 2015)%>%
  filter(Provinsi == "Aceh") 
hujan1_aceh
```

```{r}
# Mengabungkan kedua dataset
merged_Aceh <- merge(hujan1_aceh, Aceh_iklim, by.x = "Tahun", by.y = "Tahun")
merged_Aceh
```


```{r}
# Merubah type variabel tahun menjadi Date
merged_Aceh$Tahun <- make_date(merged_Aceh$Tahun)
glimpse(merged_Aceh)
```
# VAR Padi

```{r}
padi_aceh <-merged_Aceh %>%
  filter(Jenis_Komoditi == "Padi") 
padi_aceh
```

## VAR iklim terhadap produksi padi Aceh
```{r}
# Pilih variabel yang akan diprediksi
# dalam pengujian ini akan dilihat apakah ada pengaruh curah hujan terhadap peningkatan produksi

Var_padi_aceh <- padi_aceh[, c("Produksi", "Curah_hujan", "Kecepatan_Angin", "Kelembapan", "Suhu", "Penyinaran_Matahari")] #subdataset yang hanya berisikan 6 kolom
Var_padi_aceh
```

Untuk mendukung prediksi dengan Model VAR, data harus dirubah kedalam format time series (ts)

```{r}
ts_padi_aceh <- ts(Var_padi_aceh, start = c(2006,1), frequency = 1)
head(ts_padi_aceh)
```

```{r}
#menetukan jumlah lag yang optimal dlm Var
best_lag_padi_aceh <- VARselect(ts_padi_aceh, lag.max = 1, type = "both")
best_lag_padi_aceh

#akan berisi hasil pemilihan model VAR terbaik berdasarkan perbandingan AIC dan BIC untuk berbagai jumlah lag
```

```{r}
# VAR Model
#var_model_padi_aceh <- VAR(ts_padi_aceh, p = best_lag_padi_aceh$selection[1], type = "both") # jumlah order dari model VAR
#summary(var_model_padi_aceh)

#Tujuan dari coding ini adalah untuk membangun model VAR yang sesuai dengan jumlah lag terbaik yang telah Anda tentukan sebelumnya dan kemudian menganalisis model tersebut dengan melihat ringkasan yang dihasilkan. 
```

Kalau dilihat dari hasil model VAR diatas, bahwa variabel yang sangat berdampak pada produksi padi adalah variabel Luas_panen, karena nilai P-Value dari 3 lag yaitu Lag1, Lag2 dan Lag4 lebih rendah dari 0,05. Sementara untuk variabel curah_hujan, kelembapan, suhu_rata_rata pada lag yang diuji tidak tampak signifikan karena nilai P-Value lebih besar dari 0,05

```{r}
# Melakukan uji Granger Causality
granger_test_padi_aceh <- causality(var_model_padi_aceh, cause = "Curah_hujan")
granger_test_padi_aceh

#Uji Granger Causality digunakan untuk menguji apakah suatu variabel dapat digunakan untuk memprediksi variabel lain dalam model VAR
```


