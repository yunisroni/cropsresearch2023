---
title: "crops_analysis"
author: "Roni Yunis"
date: "2023-08-23"
output: html_document
---

# 1. Deskripsi
Tujuan penelitian adalah menghasilkan model prediksi tanaman pangan melalui analisis big data. Temuan dari penelitian ini akan menjadi landasan penting dalam pembangunan sistem big data nasional yang difokuskan pada bidang pertanian, sehingga dapat mendukung program pemerintah dalam pengambilan keputusan untuk meningkatkan ketahanan pangan nasional. Untuk pengujian dan analisis akan menggunakan dataset tanaman pangan yang ada di wilayah Sumatera Utara. Data tanaman pangan yang akan di analisis meliputi: tanaman Jagung, Kacang Hijau, Kacang Kedelai, Kacang Tanah, Ubi Jalar, Ubi Kayu dan Padi, serta data curah hujan.

# 2. Load Library
```{r}
library(dplyr)
library(ggplot2)
library(lubridate)
library(summarytools)
library(readxl)
library(cluster)
library(scales)
library(factoextra)
library(mclust)
library(vars)
library(forecast)
```

# 3. Data Padi
## Obstain - Load Dataset
```{r}
padi_sumut <- read_excel("dataset/bps-Padi.xlsx")
padi_sumut
```
## Scrub Data
Proses Scrub yang akan dilakukan adalah merubah type data dan menghapus data yang tidak penting atau data yang kosng (not available). Berdasarkan data_sumut dapat dilihat bahwa type data dari kolom Tahun adalah double, rata-rata produksi, produksi dan luas panen bertype karakter. Maka untuk mendukung proses analisis maka type data Tahun harus dirubah ke type Date, dan data yg bertype karakter dirubah kedalam type numeric

### a. Merubah type data
```{r}
# Merubah type data karakter menjadi numeric
padi_sumut$`Rata-rata produksi` <- as.numeric(padi_sumut$`Rata-rata produksi`)
padi_sumut$Produksi <- as.numeric(padi_sumut$Produksi)
padi_sumut$`Luas Panen` <- as.numeric(padi_sumut$`Luas Panen`)
padi_sumut
```

```{r}
# Merubah type Tahun menjadi Date
padi_sumut$Tahun <- make_date(padi_sumut$Tahun)
glimpse(padi_sumut)
```
```{r}
# Merubah nama variabel Kabupaten Kota, Rata-rata Produksi dan Luas Panen
names(padi_sumut)[names(padi_sumut) == "Kabupaten Kota"] <- "Kabupaten_kota"
names(padi_sumut)[names(padi_sumut) == "Rata-rata produksi"] <- "Rata_rata_produksi"
names(padi_sumut)[names(padi_sumut) == "Luas Panen"] <- "Luas_panen"
glimpse(padi_sumut)
```
```{r}
tail(padi_sumut)
head(padi_sumut)
```
### b. Menghapus Data Kosong
```{r}
# Menampikan variabel dengan baris kosong
colSums(is.na(padi_sumut))
```
```{r}
# Menghapus data NA's
padisumut_clean <- na.omit(padi_sumut)
summary(padisumut_clean)
```
```{r}
colSums(is.na(padisumut_clean))
```
Semua data NA's sudah dihapus. Data padi di wilayah sumut mulai dari Tahun 2010 - 2020 dengan frekuensi data per Tahun. Dalam dataset padisumut_clean masih terdapat data dari provinsi Sumatera Utara keseluruhan. Agar memudahkan dalam tahap analisis selanjutnya maka data padisumut_clean yang diambil hanya berdasarkan kabupaten/kota saja. Sekarang data final yang siap dianalisis adalah sebanyak 359 baris observasi dengan 5 kolom variabel

```{r}
padisumutfilter <- padisumut_clean[padisumut_clean$Kabupaten_kota != "Sumatera Utara",]
padisumutfilter
```

## Eksplorasi Data Analisis (EDA)
### Jumlah Produksi Padi per Kabupaten/Kota
```{r}
plot_1 <- ggplot(padisumutfilter, aes(x = Tahun, y = Produksi, group = Kabupaten_kota, color = Kabupaten_kota)) +
  geom_line() +
  labs(title = "Jumlah Produksi Padi", x = "Tahun", y = "Produksi Padi (Ha)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_1

```

```{r}
# Hitung total produksi per kabupaten/kota
totproduksi <- padisumutfilter %>% 
  mutate(first_date_month = floor_date(Tahun, unit = "year")) %>% 
  group_by(Kabupaten_kota) %>% 
  summarise(jumlahproduksi = sum(Produksi)) %>% 
  arrange(jumlahproduksi)
totproduksi
```

```{r}
# Turn off dplyr summarise() warning
options(dplyr.summarise.inform = FALSE)

# Hitung total produksi per kabupaten/tahun
totproduksi <- padisumutfilter %>% 
  group_by(Tahun, Kabupaten_kota, .drop = FALSE) %>%  # Add .drop argument
  summarise(total_produksi = sum(Produksi))

totproduksi
```
### Tren Produksi Padi per Kabupaten/Kota
```{r}
# Visualisasi Tren Produksi Padi
plot_2 <- ggplot(totproduksi, aes(x = Tahun, y = total_produksi, color = Kabupaten_kota)) +
  geom_line() +
  geom_point() +
  labs(title = "Tren Produksi Padi", x = "Tahun", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "right")
plot_2
```
### Perbandingan Produksi Padi per Kabupaten/Kota
```{r}

# Hitung total produksi padi per Kabupaten/Kota
totproduksi_kabkota <- padisumutfilter %>% 
  group_by(Kabupaten_kota) %>% 
  summarise(total_produksi = sum(Produksi))

# Visualisasi dengan barplot
plot_3 <- ggplot(totproduksi_kabkota, aes(x = Kabupaten_kota, y = total_produksi, fill = Kabupaten_kota)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Produksi Padi antara Kabupaten/Kota", x = "Kabupaten/Kota", y = "Total Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_3 + theme(axis.text.x = element_text(angle = 45, hjust = 1))


```
Perbandingan produksi padi dalam kurun waktu 2010 - 2020 adalah dari Kabupaten Simalungun yang terbanyak dengan Jumlah Produksi Padi sebesar 4814941.97 Ton

### Perbandingan Rata-rata produksi Padi per Kabupaten/Kota
```{r}
# Turn off dplyr summarise() warning
options(dplyr.summarise.inform = FALSE)

# Melihat tren rata-rata produksi padi
rataproduksi <- padisumutfilter %>% 
  group_by(Tahun, Kabupaten_kota, .drop = FALSE) %>%  # Add .drop argument
  summarise(Rata_rata_produksi = sum(Rata_rata_produksi))
rataproduksi
```
```{r}

# Hitung total rata-rata produksi padi per Kabupaten/Kota
totrataproduksi_kabkota <- padisumutfilter %>% 
  group_by(Kabupaten_kota) %>% 
  summarise(total_rataproduksi = sum(Rata_rata_produksi))

# Visualisasi dengan barplot
plot_4 <- ggplot(totrataproduksi_kabkota, aes(x = Kabupaten_kota, y = total_rataproduksi, fill = Kabupaten_kota)) +
  geom_bar(stat = "identity") +
  labs(title = "Perbandingan Rata_rata Produksi Padi antara Kabupaten/Kota", x = "Kabupaten/Kota", y = "Rata_rata Produksi (Ton)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")  # hilangkan legend

# Rotasi sumbu x agar mudah dibaca
plot_4 + theme(axis.text.x = element_text(angle = 45, hjust = 1))


```
### Korelasi Luas Panen dan Produksi Padi
```{r}
# Visualisasi korelasi luas panen dan produksi padi
plot_5 <- ggplot(padisumutfilter, aes(x = Luas_panen, y = Produksi, color = Kabupaten_kota)) +
  geom_point() +
  labs(title = "Korelasi Produksi dan Luas Panen", x = "Luas Panen", y = "Produksi") +
  theme_minimal() +
  theme(legend.position = "right")
plot_5
```
```{r}
# Hitung Pearson correlation coefficient
correlation_padi <- cor(padisumutfilter$Luas_panen, padisumutfilter$Produksi)

# Nilai correlation coefficient
cat("Koefisien Korelasi Pearson Luas Panen dan Produksi:", correlation_padi)
```
Berdasarkan grafik diatas bisa lihat bahwa ada korelasi antara luas panen dan produksi. Hubungan korelasi adalah positif dengan nilai korelasi sebesar 0,99, sehingga bisa disimpulkan bahwa jika semakin banyak luas panen maka akan meningkat jumlah produksi padi.


### Perbandingan Rata-rata produksi dengan Produksi Padi
```{r}
# Create a boxplot using ggplot2
plot_6 <- ggplot(padisumutfilter, aes(x = Kabupaten_kota, y = Produksi - Rata_rata_produksi, fill = Kabupaten_kota)) +
  geom_boxplot() +
  labs(title = "Perbandingan Produksi dan Rata-rata Produksi per Kabupaten/Kota", x = "Kabupaten/Kota", y = "Selisih Produksi") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(legend.position = "none")

# Rotasi sumbu x agar mudah dibaca
plot_6 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
### Melihat pola musiman dalam data untuk produksi padi
```{r}
# Convert Tahun to Date format
padisumutfilter$Tahun <- as.Date(paste0(padisumutfilter$Tahun, "-01-01"))

# Create ACF plot
acf_plot <- acf(padisumutfilter$Produksi, main = "ACF Plot of Produksi Padi")

# Print ACF plot
print(acf_plot)

# Create periodogram
periodogram_plot <- spectrum(padisumutfilter$Produksi, main = "Periodogram of Produksi Padi")

# Print periodogram
periodogram_plot
```
Berdasarkan Periodogram Produksi Padi bisa dilihat bahwa ada fluktuasi yang berulang dalam data sehingga bisa disimpulkan adanya pola musiman. Melihat hal ini maka akan dilakukan analisis prediksi yang lebih lanjut dan komplek. 

## Model
### a. Clustering

```{r}
# Filter data produksi terbanyak berdasarkan tahun
grouped_data <- padisumutfilter %>%
  group_by(Tahun) %>%
  arrange(desc(Produksi)) %>%
  summarise(Total_Produksi = sum(Produksi))
grouped_data
            
```
Berdasarkan hasil diatas bisa dilihat jumlah total produksi terbanyak ada pada Tahun 2017, yaitu sebanyak 5136186 Ton

```{r}
# Menyiapkan data, untuk pengujian klastering data yang ambil adalah data tahun 2017 saja
datapadi2017 <- padisumutfilter %>% 
  filter(Tahun == "2017-01-01")
```

```{r}
# Memilih variabel klastering
clustering_data <- datapadi2017 %>% 
 select(Produksi, Rata_rata_produksi, Luas_panen)
```

```{r}
# Tentukan skala dari variabel
scale_data <- as.data.frame(scale(clustering_data))
```

```{r}
# Elbow method to find the optimal number of clusters
set.seed(123)
fviz_nbclust(scale_data, kmeans, method = "wss")
```
```{r}
# Silhouette method to find the optimal number of clusters
silhouette_scores <- sapply(2:10, function(k) {
  kmeans_result <- kmeans(scale_data, centers = k)
  mean_silhouette <- mean(silhouette(kmeans_result$cluster, dist(scale_data)))
  return(mean_silhouette)
})

# Plot silhouette scores
plot(2:10, silhouette_scores, type = "b", pch = 19, xlab = "Number of clusters", ylab = "Mean Silhouette Score")

# Find the optimal number of clusters based on the highest silhouette score
optimal_k <- which.max(silhouette_scores) + 1
cat("Optimal number of clusters:", optimal_k)
```



```{r}
# Klastering dengan K-Means
set.seed(123)
k <- 10 # jumlah klaster
kmeans_result <- kmeans(scale_data, centers = k)
```

```{r}
# tambahkan label ke dalam data frame
datapadi2017$Cluster <- as.factor(kmeans_result$cluster)
```

```{r}
# Create a scatter plot using ggplot2
plot_8 <- ggplot(datapadi2017, aes(x = Luas_panen, y = Produksi, color = factor(Cluster))) +
  geom_point() +
  labs(title = "Hasil Clustering Produksi Padi", x = "Luas Panen", y = "Produksi") +
  scale_color_discrete(name = "Cluster") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal()
plot_8
```
```{r}
# Menghitung jumlah klaster per kabupaten/kota

cluster_counts_per_kabupaten <- datapadi2017 %>%
  group_by(Kabupaten_kota, Cluster) %>%
  count()

cluster_counts_per_kabupaten
```
```{r}
# Hitung jumlah kabupaten setiap klaster
cluster_kabupaten_counts <- datapadi2017 %>%
  filter(Cluster %in% c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)) %>%
  group_by(Cluster) %>%
  summarise(Jumlah_Kabupaten = n())

cluster_kabupaten_counts
```

```{r}
# Create a scatter plot using ggplot2
plot_9 <- ggplot(datapadi2017, aes(x = Luas_panen, y = Produksi, label = Kabupaten_kota)) +
  geom_point(aes(color = factor(Cluster))) +
  geom_text(vjust = -0.5, hjust = 0, size = 3, show.legend = FALSE) +
  labs(title = "Hasil Clustering Produksi Padi", x = "Luas Panen", y = "Produksi") +
  scale_color_discrete(name = "Cluster") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal()
plot_9
```
```{r}
# Hitung rata-rata produksi per klaster
cluster_avg <- datapadi2017 %>%
  group_by(Cluster) %>%
  summarise(Avg_Produksi = mean(Produksi))

cluster_avg
```
```{r}
kmeans_result$centers
```
```{r}
# Definisikan kriteria klaster
low_criteria <- quantile(cluster_avg$Avg_Produksi, 0.33)
high_criteria <- quantile(cluster_avg$Avg_Produksi, 0.66)

# Berikan label untuk masing-masing klaster
cluster_avg_kriteria <- cluster_avg %>%
  mutate(Category = ifelse(Avg_Produksi < low_criteria, "Rendah",
                           ifelse(Avg_Produksi > high_criteria, "Tinggi", "Sedang")))
cluster_avg_kriteria
```

Berdasarkan hasil perhitungan nilai centroid dari klaster, maka bisa disimpulkan bahwa:
1. Klaster 1,2 dan 4: adalah klaster yang termasuk kategori rendah 
2. Klaster 6,8 dan 9: adalah klaster yang termasuk kategori sedang
3. Klaster 3,5,7 dan 10: adalah klaster yang termasuk kategori tinggi


```{r}
# Menghitung jumlah klaster per kelompok kabupaten/kota
kabupaten_per_cluster <- datapadi2017 %>%
  group_by(Cluster) %>%
  summarise(Kabupaten_kota = list(unique(Kabupaten_kota)))

# Menampilkan nama kabupaten/kota dari setiap klaster
for (i in 1:10) {
  cat(paste("Klaster", i, ":", kabupaten_per_cluster$Kabupaten_kota[[i]], "\n"))
}
```
```{r}
# Evaluasi Clustering dengan Inertia

# Jumlah klaster yang diuji
k_values <- 2:10

# Hitung nilai Inertia untuk setiap klaster
inertia_values <- sapply(k_values, function(k) {
  kmeans_result <- kmeans(clustering_data, centers = k)
  kmeans_result$tot.withinss
})

inertia_df <- data.frame(K = k_values, Inertia = inertia_values)
inertia_df
```
Berdasarkan hasil evaluasi dengan Inertia, didapatkan bahwa jumlah klaster yang tepat untuk pengujian klaster yang dilakukan adalah 10, karena nilai Inertia yang paling rendah


```{r}
akurasi_klastering <- (kmeans_result$betweenss/kmeans_result$totss)*100
akurasi_klastering
```
Akurasi klaster bisa diketahui dengan menghitung rasio dari jumlah kuadrat antar klaster dengan
jumlah kuadrat total. Sehingga nilai akurasi dari model klastering adalah 95,85

```{r}
# Membaca dataset
data <- datapadi2017[, 3:5]

# Menentukan jumlah cluster yang diinginkan
num_clusters <- 10

# Membuat model GMM
gmm_model <- Mclust(data, G = num_clusters)

# Mendapatkan hasil klastering
cluster_assignment <- gmm_model$classification

# Menampilkan hasil klastering
cat("Cluster Assignment for Each Data Point:\n")
cluster_assignment

# Plot hasil klastering
plot(data, col = cluster_assignment, pch = 19, main = "GMM Clustering")

```

Pengujian Klaster dengan Kombinasi K-Means dan GMM
```{r}
# Memilih fitur untuk klaster
features <- datapadi2017[, c("Produksi", "Luas_panen", "Rata_rata_produksi")]

# Menstardisasi fitur
scaled_features <- scale(features)

# Klaster dengan K-Means
kmeans_result <- kmeans(scaled_features, centers = 10)

# Tentukan nilai Klaster
cluster_assignment <- kmeans_result$cluster

# Tambahkan nilai klaster ke data aktual
clustered_data <- cbind(datapadi2017, Cluster = cluster_assignment)

# Performansi GMM clustering untuk setiap klaster
gmm_clusters <- list()
for (cluster_id in unique(cluster_assignment)) {
  cluster_data <- scaled_features[cluster_assignment == cluster_id, ]
  gmm_result <- Mclust(cluster_data)
  gmm_clusters[[cluster_id]] <- gmm_result$classification
}

# Tampilkan hasil klaster
for (cluster_id in unique(cluster_assignment)) {
  cat("Cluster", cluster_id, ":", gmm_clusters[[cluster_id]], "\n")
}

# Kombinasi GMM cluster dengan Dataset aktual
final_clustered_data <- clustered_data
for (cluster_id in unique(cluster_assignment)) {
  final_clustered_data$GMM_Cluster[final_clustered_data$Cluster == cluster_id] <- gmm_clusters[[cluster_id]]
}

# Tampilkan hasil final klaster
final_clustered_data
```


```{r}
# Remove duplicate columns from the dataset
final_clustered_data <- final_clustered_data[, !duplicated(names(final_clustered_data))]

# Visualize the clustered data
ggplot(final_clustered_data, aes(x = Rata_rata_produksi, y = Luas_panen, color = factor(GMM_Cluster), label = Kabupaten_kota)) +
  geom_point() +
  geom_text(check_overlap = TRUE, vjust = -0.5) +  # Add district names
  xlab("Rata-rata Produksi (Ton)") +
  ylab("Luas Panen (Hektar)") +
  ggtitle("K-Means & GMM Clustering Rata-Rata Produksi Padi") +
  theme_minimal() +
  scale_color_discrete(name = "cluster")
```
```{r}
# Hitung Silhouette Score untuk melihat seberapa baik klaster yang dilakukan
silhouette_score <- silhouette(cluster_assignment, dist(scaled_features))
silhouette_score
```
Secara keseluruhan nilai Silhouette Score yang positif dan mendekati 1 menunjukkan bahwa klastering yang dilakukan memiliki hasil yang baik dalam memisahkan objek-objek ke dalam kelompok-kelompok yang berbeda.


### b. Regresi Liner
Tujuan dari analisis ini adalah unutk mencari tahu sejauh mana perubahan dalam rata-rata produksi dan/atau luas panen dapat mempengaruhi perubahan dalam jumlah produksi padi. Adapun hipotesis yang dapat dikembangkan adalah:
1. Rata-rata produksi berpengaruh signifikan terhadap jumlah produksi padi.
2. Luas panen berpengaruh signifikan terhadap jumlah produksi padi.
3. Rata-rata produksi dan luas panen berpengaruh signifikan terhadap jumlah produksi padi.

```{r}
# Load dataset padi
head(padisumutfilter)
```
```{r}
# Pilih variabel yang akan diukur pengaruh
datapadisumut <- padisumutfilter %>% 
  select(Rata_rata_produksi, Produksi, Luas_panen)
```

Model 1: Pengaruh rata-rata produksi terhadap jumlah produksi
```{r}
model_1 <- lm(Produksi ~ Rata_rata_produksi, data = datapadisumut)
summary(model_1)
```
```{r}
# Visualisasi hasil regresi model_1
ggplot(datapadisumut, aes(x = Rata_rata_produksi, y = Produksi)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(x = "Rata-rata Produksi", y = "Jumlah Produksi") +
  ggtitle("Hubungan Antara Rata-rata Produksi dan Jumlah Produksi") +
  theme_minimal()
```


Berdasarkan hasil di atas, kita dapat menyimpulkan bahwa rata-rata produksi padi memiliki pengaruh yang signifikan terhadap jumlah produksi. Nilai R-squared yang relatif rendah menunjukkan bahwa masih ada variabilitas dalam jumlah produksi yang tidak dijelaskan oleh rata-rata produksi, dan mungkin ada faktor lain yang juga mempengaruhi hasil produksi padi.

Model 2: Pengaruh luas panen terhadap jumlah produksi
```{r}
model_2 <- lm(Produksi ~ Luas_panen, data = datapadisumut)
summary(model_2)
```
```{r}
# Visualisasi hasil regresi model_1
ggplot(datapadisumut, aes(x = Luas_panen, y = Produksi)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(x = "Luas Panen", y = "Jumlah Produksi") +
  ggtitle("Hubungan Antara Luas Panen dan Jumlah Produksi") +
  theme_minimal()
```
Berdasarkan hasil diatas, dapat disimpulkan bahwa luas panen memiliki pengaruh yang signifikan terhadap produksi padi. Nilai R-squared yang mendekati 1 (0.9861) menunjukkan bahwa model regresi ini mampu menjelaskan sekitar 98.61% variasi dalam "Produksi" berdasarkan variabel independen "Luas_panen".

Model 3: Pengaruh luas panen dan rata-rata produksi terhadap jumlah produksi
```{r}
model_3 <- lm(Produksi ~ Luas_panen + Rata_rata_produksi, data = datapadisumut)
summary(model_3)
```
```{r}
# Visualisasi Model_3
ggplot(datapadisumut, aes(x = Produksi, y = predict(model_3))) +
  geom_point() +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  labs(title = "Produksi Padi vs. Prediksi Produksi Padi",
       x = "Observed Produksi",
       y = "Predicted Produksi")
```
Berdasarkan hasil diatas dapat disimpulkan bahwa kedua variabel independen, yaitu "Luas_panen" dan "Rata_rata_produksi", memiliki pengaruh yang signifikan terhadap "Produksi". Nilai R-squared yang tinggi (0.988) menunjukkan bahwa model ini mampu menjelaskan sekitar 98.8% variasi dalam "Produksi" berdasarkan "Luas_panen" dan "Rata_rata_produksi".


Model Klaster dan Regresi untuk Mengungkap Tren Produksi Padi
```{r}
# Siapkan data set. Dataset yangd digunakan adalah data padi 2017
set.seed(123)

# K-Means Clustering
k <- 10
kmeans_result <- kmeans(datapadi2017[, c("Produksi", "Luas_panen")], centers = k)
datapadi2017$Cluster <- kmeans_result$cluster

# Visualisasi Hasil Klaster
plot_11 <- ggplot(datapadi2017, aes(x = Luas_panen, y = Produksi, label = Kabupaten_kota)) +
  geom_point(aes(color = factor(Cluster))) +
  geom_text(vjust = -0.5, hjust = 0, size = 3, show.legend = FALSE) +
  labs(title = "Hasil Clustering Produksi Beras", x = "Luas Panen", y = "Produksi") +
  scale_color_discrete(name = "Cluster") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal()

# Model Regresi Liner
lm_model <- lm(Produksi ~ Rata_rata_produksi + Luas_panen, data = datapadi2017)

# Tampilkan hasil model regresi
summary(lm_model)

# Visualisasi hasil regresi dan klaster produksi padi
plot_lm <- ggplot(datapadi2017, aes(x = Luas_panen, y = Produksi, label = Kabupaten_kota)) +
  geom_point(aes(color = factor(Cluster))) +
  geom_text(vjust = -0.5, hjust = 0, size = 3, show.legend = FALSE) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "Hubungan Luas Panen dan Produksi", x = "Luas Panen", y = "Produksi") +
  scale_color_discrete(name = "Cluster") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal()

# Tampilkan hasil visualisasi dari kedua model
plot_11
plot_lm

```

```{r}
akurasi_klastering2 <- (kmeans_result$betweenss/kmeans_result$totss)*100
akurasi_klastering2
```

### c. Model VAR
Tujuan adalah untuk mengidentifikasi apakah perubahan curah hujan dapat mempengaruhi produksi padi. Akan melakukan prediksi curah hujan dan produksi padi dimasa depan berdasarkan pola hubungan historis antara 2 variabel. Mengidentifikasi apakah perubahan dalam curah hujan dalam satu periode dapat memiliki efek jangka pendek atau panjang terhadap produksi padi.

```{r}
# Load data curah hujan
rainfall <- read.csv("dataset/climateserv-statistical.csv")
head(rainfall)
```
```{r}
# Merubah type variabel DateTime menjadi Date
rainfall$DateTime <- as.Date(rainfall$DateTime)
glimpse(rainfall)
```
```{r}
# Merubah nama variabel
names(rainfall)[names(rainfall) == "DateTime"] <- "date"
names(rainfall)[names(rainfall) == "UCSB.CHIRPS.Rainfall..avg"] <- "rainfallavg"
glimpse(rainfall)
```
```{r}
head(rainfall)
tail(rainfall)
```
```{r}
# Mengambil rata-rata curah hujan per tahun
rainfall_yearly <- rainfall %>%
  mutate(year = lubridate::year(date)) %>%
  group_by(year) %>%
  summarise(avg_rainfall = mean(rainfallavg))
rainfall_yearly  
```

```{r}
# Merubah type tahun menjadi date
rainfall_yearly$year <- make_date(rainfall_yearly$year)
rainfall_yearly
```

```{r}
# Filter data for "Sumatera Utara" kabupaten
sumut_data <- padi_sumut %>%
  filter(Kabupaten_kota == "Sumatera Utara")
sumut_data
```

```{r}
# Mengabungkan kedua dataset
merged_data <- merge(sumut_data, rainfall_yearly, by.x = "Tahun", by.y = "year")
merged_data
```

```{r}
# Pilih variabel yang akan diprediksi
# dalam pengujian ini akan dilihat apakah ada pengaruh curah hujan terhadap peningkatan rata-rata produksi
data_for_var <- merged_data[, c("Produksi", "avg_rainfall")]
```

Untuk mendukung prediksi dengan Model VAR, data harus dirubah kedalam format time series (ts)

```{r}
ts_data <- ts(data_for_var, start = c(2010,1), frequency = 1)
ts_data
```
```{r}
# VAR Model
var_model_1 <- VAR(ts_data, p = 2) # jumlah order dari model VAR
summary(var_model_1)
```
```{r}
# Membuat model regresi linier
regression_model <- lm(Produksi ~ avg_rainfall, data = data_for_var)

# Ringkasan hasil model
summary(regression_model)
```

```{r}
# Menghitung koefisien korelasi Pearson
correlation <- cor(data_for_var$Produksi, data_for_var$avg_rainfall)
correlation
```



## Interpretasi


# 4. Data Jagung
# 5. Data Kacang Hijau
# 6. Data Kacang Kedelai
# 7. Data Kacang Tanah
# 8. Data Ubi Jalar
# 9. Data Ubi Kayu

